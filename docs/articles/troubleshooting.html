<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Troubleshooting Guide • couplr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Troubleshooting Guide">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">couplr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/algorithms.html">Algorithm Details</a></li>
    <li><a class="dropdown-item" href="../articles/matching-workflows.html">Matching Workflows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison with Alternatives</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/pixel-morphing.html">Pixel Morphing &amp; Scientific Applications</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/couplr" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Troubleshooting Guide</h1>
                        <h4 data-toc-skip class="author">Gilles
Colling</h4>
            
            <h4 data-toc-skip class="date">2026-01-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gcol33/couplr/blob/HEAD/vignettes/troubleshooting.Rmd" class="external-link"><code>vignettes/troubleshooting.Rmd</code></a></small>
      <div class="d-none name"><code>troubleshooting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette provides solutions to common issues encountered when
using couplr. Each section describes a problem, explains why it occurs,
and provides step-by-step solutions.</p>
<p><strong>Quick reference:</strong></p>
<table class="table">
<colgroup>
<col width="29%">
<col width="70%">
</colgroup>
<thead><tr class="header">
<th>Issue</th>
<th>Jump to Section</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>No valid pairs found</td>
<td><a href="#infeasible-problems">Infeasible Problems</a></td>
</tr>
<tr class="even">
<td>Poor balance after matching</td>
<td><a href="#poor-balance-despite-matching">Poor Balance</a></td>
</tr>
<tr class="odd">
<td>Matching is too slow</td>
<td><a href="#performance-issues">Performance Issues</a></td>
</tr>
<tr class="even">
<td>Memory errors</td>
<td><a href="#memory-errors">Memory Errors</a></td>
</tr>
<tr class="odd">
<td>Different results with different methods</td>
<td><a href="#different-results-with-different-methods">Non-Determinism</a></td>
</tr>
<tr class="even">
<td>Unexpected NA in results</td>
<td><a href="#missing-values-in-data">Missing Values</a></td>
</tr>
<tr class="odd">
<td>C++ compilation errors</td>
<td><a href="#installation-issues">Installation Issues</a></td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="infeasible-problems">Infeasible Problems<a class="anchor" aria-label="anchor" href="#infeasible-problems"></a>
</h2>
<div class="section level3">
<h3 id="symptom">Symptom<a class="anchor" aria-label="anchor" href="#symptom"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This fails: all assignments have Inf cost</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Infeasible given forbidden edges</span></span></code></pre></div>
<p>Error message: “No feasible assignment found” or total cost is
Inf.</p>
</div>
<div class="section level3">
<h3 id="cause">Cause<a class="anchor" aria-label="anchor" href="#cause"></a>
</h3>
<p>A feasible assignment requires that every row can be assigned to at
least one column with finite cost. When rows have all-Inf or all-NA
entries, no valid assignment exists.</p>
</div>
<div class="section level3">
<h3 id="diagnosis">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for infeasible rows</span></span>
<span><span class="va">check_feasibility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">finite_per_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">infeasible_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">finite_per_row</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">infeasible_rows</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Infeasible rows (no finite costs):"</span>, <span class="va">infeasible_rows</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">finite_per_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">infeasible_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">finite_per_col</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">infeasible_cols</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Infeasible columns (no finite costs):"</span>, <span class="va">infeasible_cols</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Problem appears feasible\n"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check the problematic matrix</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">check_feasibility</span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; Infeasible rows (no finite costs): 2</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions">Solutions<a class="anchor" aria-label="anchor" href="#solutions"></a>
</h3>
<p><strong>1. Remove infeasible rows/columns:</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove rows with no valid assignments</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">valid_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span><span class="va">cost_valid</span> <span class="op">&lt;-</span> <span class="va">cost</span><span class="op">[</span><span class="va">valid_rows</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cost_valid</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_valid</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="st">"of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span>, <span class="st">"rows\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Matched 2 of 3 rows</span></span></code></pre></div>
<p><strong>2. Add fallback costs:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Replace Inf with high (but finite) penalty</span></span>
<span><span class="va">cost_with_fallback</span> <span class="op">&lt;-</span> <span class="va">cost</span></span>
<span><span class="va">cost_with_fallback</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost_with_fallback</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e6</span>  <span class="co"># Large penalty</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_with_fallback</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assignment Result</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   source target    cost</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1      1       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2      3 1<span style="text-decoration: underline;">000</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3      2       2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total cost: 1000003 </span></span>
<span><span class="co">#&gt; Method: bruteforce</span></span></code></pre></div>
<p><strong>3. For matching: check covariate overlap:</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate poor overlap scenario</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">25</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">55</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize overlap</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Left"</span><span class="op">)</span>,</span>
<span>  <span class="va">right</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Right"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Poor Covariate Overlap"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"No overlap means no good matches possible"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="troubleshooting_files/figure-html/unnamed-chunk-5-1.svg" class="r-plt" alt="Density plot showing overlap between treatment and control groups on the age variable" width="672"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="poor-balance-despite-matching">Poor Balance Despite Matching<a class="anchor" aria-label="anchor" href="#poor-balance-despite-matching"></a>
</h2>
<div class="section level3">
<h3 id="symptom-1">Symptom<a class="anchor" aria-label="anchor" href="#symptom-1"></a>
</h3>
<p>After matching, <code><a href="../reference/balance_diagnostics.html">balance_diagnostics()</a></code> shows |std_diff|
&gt; 0.25 for some variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example of poor balance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80000</span>, <span class="fl">20000</span><span class="op">)</span>  <span class="co"># Very different from right</span></span>
<span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">32</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">40000</span>, <span class="fl">10000</span><span class="op">)</span>  <span class="co"># Very different income</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>, auto_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">balance</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance Diagnostics for Matched Pairs</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matching Summary:</span></span>
<span><span class="co">#&gt;   Method: lap</span></span>
<span><span class="co">#&gt;   Matched pairs: 100</span></span>
<span><span class="co">#&gt;   Unmatched left: 0 (of 100)</span></span>
<span><span class="co">#&gt;   Unmatched right: 0 (of 100)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable-level Balance:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   Variable `Mean Left` `Mean Right` `Mean Diff` `Std Diff` `Var Ratio` `KS Stat`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> age             30.6         32.5       -<span style="color: #BB0000;">1.89</span>     -<span style="color: #BB0000;">0.386</span>        1.05      0.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> income       <span style="text-decoration: underline;">77</span>666.       <span style="text-decoration: underline;">41</span>353.     <span style="text-decoration: underline;">36</span>313.        2.40         2.15      0.81</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Balance:</span></span>
<span><span class="co">#&gt;   Mean |Std Diff|: 1.391 (Poor)</span></span>
<span><span class="co">#&gt;   Max |Std Diff|: 2.397</span></span>
<span><span class="co">#&gt;   Vars with |Std Diff| &gt; 0.25: 100.0%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance Interpretation:</span></span>
<span><span class="co">#&gt;   |Std Diff| &lt; 0.10: Excellent balance</span></span>
<span><span class="co">#&gt;   |Std Diff| 0.10-0.25: Good balance</span></span>
<span><span class="co">#&gt;   |Std Diff| 0.25-0.50: Acceptable balance</span></span>
<span><span class="co">#&gt;   |Std Diff| &gt; 0.50: Poor balance</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="causes">Causes<a class="anchor" aria-label="anchor" href="#causes"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Weak overlap</strong>: Groups are too different on key
variables</li>
<li>
<strong>Missing confounders</strong>: Important variables not
included in matching</li>
<li>
<strong>Caliper too loose</strong>: Accepting poor matches</li>
<li>
<strong>Wrong scaling</strong>: Variables not properly weighted</li>
</ol>
</div>
<div class="section level3">
<h3 id="solutions-1">Solutions<a class="anchor" aria-label="anchor" href="#solutions-1"></a>
</h3>
<p><strong>1. Add more matching variables:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Include additional relevant variables</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"region"</span><span class="op">)</span>,  <span class="co"># More variables</span></span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Tighten caliper (fewer but better matches):</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.3</span>,  <span class="co"># Stricter caliper</span></span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span><span class="co">#&gt; Error: Auction(scaled): iteration guard at eps=7885383213142811492880940678185446561903245540964986346309735611880493954648021596949837549977694598396708273161382015616428292389740290815495083885169868915380815811828883936262015287544410809252305189353561236385323861047382998003414092120491154540881183908342668085623145397342096496525312.000000, phase=19</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Original matches:"</span>, <span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Original matches: 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"With caliper:"</span>, <span class="va">result_strict</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'result_strict' not found</span></span>
<span></span>
<span><span class="va">balance_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">result_strict</span>, <span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'result_strict' not found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">balance_strict</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'balance_strict' not found</span></span></code></pre></div>
<p><strong>3. Use blocking on problematic variable:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Block on income tertiles to ensure exact balance</span></span>
<span><span class="va">left</span><span class="op">$</span><span class="va">income_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">left</span><span class="op">$</span><span class="va">income</span>, breaks <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"mid"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span><span class="op">$</span><span class="va">income_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">right</span><span class="op">$</span><span class="va">income</span>, breaks <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"mid"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, block_type <span class="op">=</span> <span class="st">"group"</span>, block_by <span class="op">=</span> <span class="st">"income_cat"</span><span class="op">)</span></span>
<span><span class="va">result_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>,  <span class="co"># Match on age within income blocks</span></span>
<span>  block_id <span class="op">=</span> <span class="st">"block_id"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Try different scaling:</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare scaling methods</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">scale_method</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"robust"</span>, <span class="st">"standardize"</span>, <span class="st">"range"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>                       auto_scale <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="va">scale_method</span><span class="op">)</span></span>
<span>  <span class="va">bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">scale_method</span>, <span class="st">"- max |std_diff|:"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">bal</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">max_abs_std_diff</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; robust - max |std_diff|: 2.397 </span></span>
<span><span class="co">#&gt; standardize - max |std_diff|: 2.397 </span></span>
<span><span class="co">#&gt; range - max |std_diff|: 2.397</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="performance-issues">Performance Issues<a class="anchor" aria-label="anchor" href="#performance-issues"></a>
</h2>
<div class="section level3">
<h3 id="symptom-2">Symptom<a class="anchor" aria-label="anchor" href="#symptom-2"></a>
</h3>
<p><code><a href="../reference/match_couples.html">match_couples()</a></code> or <code><a href="../reference/lap_solve.html">lap_solve()</a></code> takes too
long or doesn’t complete.</p>
</div>
<div class="section level3">
<h3 id="cause-1">Cause<a class="anchor" aria-label="anchor" href="#cause-1"></a>
</h3>
<p>Optimal matching has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>
complexity. For n = 5,000, this means ~125 billion operations.</p>
</div>
<div class="section level3">
<h3 id="diagnosis-1">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate runtime</span></span>
<span><span class="va">estimate_runtime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">seconds_per_billion</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ops</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">^</span><span class="fl">3</span></span>
<span>  <span class="va">time_sec</span> <span class="op">&lt;-</span> <span class="va">ops</span> <span class="op">/</span> <span class="fl">1e9</span> <span class="op">*</span> <span class="va">seconds_per_billion</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_sec</span> <span class="op">&lt;</span> <span class="fl">60</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f seconds"</span>, <span class="va">time_sec</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">time_sec</span> <span class="op">&lt;</span> <span class="fl">3600</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f minutes"</span>, <span class="va">time_sec</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f hours"</span>, <span class="va">time_sec</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated runtime for optimal matching:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated runtime for optimal matching:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">3000</span>, <span class="fl">5000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  n = %5d: %s\n"</span>, <span class="va">n</span>, <span class="fu">estimate_runtime</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   n =   100: 0.0 seconds</span></span>
<span><span class="co">#&gt;   n =   500: 0.1 seconds</span></span>
<span><span class="co">#&gt;   n =  1000: 1.0 seconds</span></span>
<span><span class="co">#&gt;   n =  3000: 27.0 seconds</span></span>
<span><span class="co">#&gt;   n =  5000: 2.1 minutes</span></span>
<span><span class="co">#&gt;   n = 10000: 16.7 minutes</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions-2">Solutions<a class="anchor" aria-label="anchor" href="#solutions-2"></a>
</h3>
<p><strong>1. Use greedy matching for large problems:</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">large_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">large_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Greedy is much faster</span></span>
<span><span class="va">time_greedy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result_greedy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span></span>
<span>    <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>    strategy <span class="op">=</span> <span class="st">"row_best"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Greedy matching (n=500):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">time_greedy</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Greedy matching (n=500): 0.24 seconds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Quality (mean distance):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_greedy</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Quality (mean distance): 0.2886</span></span></code></pre></div>
<p><strong>2. Use blocking to divide the problem:</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create clusters to match within</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span></span>
<span>  <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>  block_type <span class="op">=</span> <span class="st">"cluster"</span>,</span>
<span>  block_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  n_blocks <span class="op">=</span> <span class="fl">10</span>  <span class="co"># 10 blocks of ~200 each</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Match within blocks (10 x O(200^3) &lt;&lt; O(2000^3))</span></span>
<span><span class="va">result_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  block_id <span class="op">=</span> <span class="st">"block_id"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Choose a faster algorithm:</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For n &gt; 1000, auction algorithm often faster</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"auction"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For sparse problems (many forbidden pairs)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># Creates sparsity</span></span>
<span>  method <span class="op">=</span> <span class="st">"sap"</span>       <span class="co"># Sparse algorithm</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Pre-compute and cache distances:</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute once, reuse multiple times</span></span>
<span><span class="va">dist_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_distances.html">compute_distances</a></span><span class="op">(</span></span>
<span>  <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"robust"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fast: reuse cached distances</span></span>
<span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">dist_cache</span>, max_distance <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Auction(scaled): iteration guard at eps=7885383213142811492880940678185446561903245540964986346309735611880493954648021596949837549977694598396708273161382015616428292389740290815495083885169868915380815811828883936262015287544410809252305189353561236385323861047382998003414092120491154540881183908342668085623145397342096496525312.000000, phase=19</span></span>
<span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">dist_cache</span>, max_distance <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Auction(scaled): iteration guard at eps=7885383213142811492880940678185446561903245540964986346309735611880493954648021596949837549977694598396708273161382015616428292389740290815495083885169868915380815811828883936262015287544410809252305189353561236385323861047382998003414092120491154540881183908342668085623145397342096496525312.000000, phase=19</span></span>
<span><span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">dist_cache</span>, max_distance <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Auction(scaled): iteration guard at eps=1126483316163258824265631974034443891639823813610806420694737497815224935438897973018092081948265388931426075427056248934211070659219110229909045880244837695627342250315221262058036152573541196844030732698832451884756126289658649148196507095803136496140945309873526895910049842722193738301440.000000, phase=20</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="memory-errors">Memory Errors<a class="anchor" aria-label="anchor" href="#memory-errors"></a>
</h2>
<div class="section level3">
<h3 id="symptom-3">Symptom<a class="anchor" aria-label="anchor" href="#symptom-3"></a>
</h3>
<p>R crashes or shows: “Error: cannot allocate vector of size X GB”</p>
</div>
<div class="section level3">
<h3 id="cause-2">Cause<a class="anchor" aria-label="anchor" href="#cause-2"></a>
</h3>
<p>A full distance matrix for n×n requires 8n² bytes:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Memory requirements</span></span>
<span><span class="va">memory_needed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bytes</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="op">*</span> <span class="va">n</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">bytes</span> <span class="op">&lt;</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f KB"</span>, <span class="va">bytes</span> <span class="op">/</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">bytes</span> <span class="op">&lt;</span> <span class="fl">1e9</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f MB"</span>, <span class="va">bytes</span> <span class="op">/</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f GB"</span>, <span class="va">bytes</span> <span class="op">/</span> <span class="fl">1e9</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Memory for full distance matrix:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Memory for full distance matrix:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">5000</span>, <span class="fl">10000</span>, <span class="fl">20000</span>, <span class="fl">50000</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  n = %5d: %s\n"</span>, <span class="va">n</span>, <span class="fu">memory_needed</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   n =  1000: 8.0 MB</span></span>
<span><span class="co">#&gt;   n =  5000: 200.0 MB</span></span>
<span><span class="co">#&gt;   n = 10000: 800.0 MB</span></span>
<span><span class="co">#&gt;   n = 20000: 3.2 GB</span></span>
<span><span class="co">#&gt;   n = 50000: 20.0 GB</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions-3">Solutions<a class="anchor" aria-label="anchor" href="#solutions-3"></a>
</h3>
<p><strong>1. Use greedy matching (avoids full matrix):</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Greedy computes distances on-the-fly</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"row_best"</span>  <span class="co"># Most memory-efficient</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Use blocking to create smaller subproblems:</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Each block is much smaller</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, block_type <span class="op">=</span> <span class="st">"cluster"</span>, n_blocks <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>, vars <span class="op">=</span> <span class="va">vars</span>, block_id <span class="op">=</span> <span class="st">"block_id"</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Use caliper to create sparse matrix:</strong></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Caliper excludes distant pairs (sparse representation)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"sap"</span>  <span class="co"># Sparse-optimized algorithm</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Increase R’s memory limit (Windows):</strong></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Increase to 16 GB (if available)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/memory.size.html" class="external-link">memory.limit</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16000</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="different-results-with-different-methods">Different Results with Different Methods<a class="anchor" aria-label="anchor" href="#different-results-with-different-methods"></a>
</h2>
<div class="section level3">
<h3 id="symptom-4">Symptom<a class="anchor" aria-label="anchor" href="#symptom-4"></a>
</h3>
<p>Different algorithms return different assignments:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_jv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span>, method <span class="op">=</span> <span class="st">"jv"</span><span class="op">)</span></span>
<span><span class="va">result_hungarian</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span>, method <span class="op">=</span> <span class="st">"hungarian"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"JV assignment:       "</span>, <span class="va">result_jv</span><span class="op">$</span><span class="va">target</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; JV assignment:        1 2 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Hungarian assignment:"</span>, <span class="va">result_hungarian</span><span class="op">$</span><span class="va">target</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hungarian assignment: 1 2 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"JV total cost:       "</span>, <span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_jv</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; JV total cost:        3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Hungarian total cost:"</span>, <span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_hungarian</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hungarian total cost: 3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cause-3">Cause<a class="anchor" aria-label="anchor" href="#cause-3"></a>
</h3>
<p>When multiple optimal solutions exist (tied costs), different
algorithms may find different ones. <strong>The total cost should be the
same</strong>—if not, report a bug.</p>
</div>
<div class="section level3">
<h3 id="diagnosis-2">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis-2"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for ties</span></span>
<span><span class="va">check_ties</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span></span>
<span>  <span class="co"># Check if diagonal dominates (trivial ties)</span></span>
<span>  <span class="va">diag_costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">diag_costs</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Tied costs on diagonal - multiple optima likely\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Check cost uniqueness</span></span>
<span>  <span class="va">unique_costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">total_entries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">unique_costs</span> <span class="op">&lt;</span> <span class="va">total_entries</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Many repeated costs - ties possible\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">check_ties</span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tied costs on diagonal - multiple optima likely</span></span>
<span><span class="co">#&gt; Many repeated costs - ties possible</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions-4">Solutions<a class="anchor" aria-label="anchor" href="#solutions-4"></a>
</h3>
<p><strong>1. Verify total costs match:</strong></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Total cost should be identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_jv</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_hungarian</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Both methods found optimal solutions (same total cost)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Both methods found optimal solutions (same total cost)</span></span></code></pre></div>
<p><strong>2. Use Hungarian for deterministic tie-breaking:</strong></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hungarian has consistent tie-breaking</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span>, method <span class="op">=</span> <span class="st">"hungarian"</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Add small noise to break ties:</strong></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">cost_perturbed</span> <span class="op">&lt;-</span> <span class="va">cost</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">0</span>, <span class="fl">1e-10</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_perturbed</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="missing-values-in-data">Missing Values in Data<a class="anchor" aria-label="anchor" href="#missing-values-in-data"></a>
</h2>
<div class="section level3">
<h3 id="symptom-5">Symptom<a class="anchor" aria-label="anchor" href="#symptom-5"></a>
</h3>
<p>Matching fails or produces unexpected results due to NA values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">30</span>, <span class="cn">NA</span>, <span class="fl">35</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">32</span>, <span class="fl">33</span>, <span class="fl">36</span>, <span class="fl">42</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This may fail or give unexpected results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Missing values (NA) not allowed in matching variables</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cause-4">Cause<a class="anchor" aria-label="anchor" href="#cause-4"></a>
</h3>
<p>couplr requires complete cases for distance computation. NA values in
matching variables cause issues.</p>
</div>
<div class="section level3">
<h3 id="solutions-5">Solutions<a class="anchor" aria-label="anchor" href="#solutions-5"></a>
</h3>
<p><strong>1. Remove rows with NA (before matching):</strong></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">left_clean</span> <span class="op">&lt;-</span> <span class="va">left</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right_clean</span> <span class="op">&lt;-</span> <span class="va">right</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left_clean</span>, <span class="va">right_clean</span>, vars <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs (excluded 1 left unit with NA)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matched 4 pairs (excluded 1 left unit with NA)</span></span></code></pre></div>
<p><strong>2. Impute missing values:</strong></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simple mean imputation</span></span>
<span><span class="va">left_imputed</span> <span class="op">&lt;-</span> <span class="va">left</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left_imputed</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs (imputed 1 NA with mean)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matched 5 pairs (imputed 1 NA with mean)</span></span></code></pre></div>
<p><strong>3. Use preprocessing to diagnose:</strong></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">health</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess_matching_vars.html">preprocess_matching_vars</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="st">"age"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preprocessing Result</span></span>
<span><span class="co">#&gt; ====================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variables: 1</span></span>
<span><span class="co">#&gt; Scaling method: none</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="installation-issues">Installation Issues<a class="anchor" aria-label="anchor" href="#installation-issues"></a>
</h2>
<div class="section level3">
<h3 id="c-compilation-errors">C++ Compilation Errors<a class="anchor" aria-label="anchor" href="#c-compilation-errors"></a>
</h3>
<div class="section level4">
<h4 id="symptom-6">Symptom<a class="anchor" aria-label="anchor" href="#symptom-6"></a>
</h4>
<pre><code>Error in .Call("_couplr_assignment_impl"): object not found</code></pre>
<p>or</p>
<pre><code>Error: package 'couplr' was built under R version X.X</code></pre>
</div>
<div class="section level4">
<h4 id="cause-5">Cause<a class="anchor" aria-label="anchor" href="#cause-5"></a>
</h4>
<p>C++ code not compiled properly, or object files are stale.</p>
</div>
<div class="section level4">
<h4 id="solutions-6">Solutions<a class="anchor" aria-label="anchor" href="#solutions-6"></a>
</h4>
<p><strong>1. Clean and reinstall:</strong></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In R:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/remove.packages.html" class="external-link">remove.packages</a></span><span class="op">(</span><span class="st">"couplr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"couplr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or from GitHub:</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gcol33/couplr"</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Clean compiled files (development):</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># PowerShell</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="fu">Remove-Item</span> src\<span class="op">*.</span><span class="fu">o</span><span class="op">,</span> src\<span class="op">*.</span><span class="fu">dll</span> <span class="op">-</span>Force</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># Bash</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="fu">rm</span> src/<span class="pp">*</span>.o src/<span class="pp">*</span>.so</span></code></pre></div>
<p>Then rebuild:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://pkgbuild.r-lib.org/reference/clean_dll.html" class="external-link">clean_dll</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Check Rtools/compiler (Windows):</strong></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if Rtools is properly configured</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"make"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               make </span></span>
<span><span class="co">#&gt; "C:\\rtools45\\usr\\bin\\make.exe"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"g++"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                          g++ </span></span>
<span><span class="co">#&gt; "C:\\rtools45\\X86_64~1.POS\\bin\\G__~1.EXE"</span></span></code></pre></div>
<p>Make sure Rtools is installed and PATH is configured correctly.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="common-error-messages">Common Error Messages<a class="anchor" aria-label="anchor" href="#common-error-messages"></a>
</h2>
<div class="section level3">
<h3 id="method_used-attribute-is-null">“method_used attribute is NULL”<a class="anchor" aria-label="anchor" href="#method_used-attribute-is-null"></a>
</h3>
<p><strong>Cause</strong>: Result object wasn’t created properly.</p>
<p><strong>Solution</strong>: Use <code><a href="../reference/lap_solve.html">lap_solve()</a></code> instead of
<code><a href="../reference/assignment.html">assignment()</a></code> for the tidy interface.</p>
</div>
<div class="section level3">
<h3 id="cost-matrix-contains-non-finite-values">“Cost matrix contains non-finite values”<a class="anchor" aria-label="anchor" href="#cost-matrix-contains-non-finite-values"></a>
</h3>
<p><strong>Cause</strong>: NA or NaN values in cost matrix (not
Inf).</p>
<p><strong>Solution</strong>: Replace NA with Inf for forbidden
assignments, or remove rows/cols.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cost</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">Inf</span>  <span class="co"># Mark as forbidden</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="all-rows-assigned-to-inf-columns">“All rows assigned to Inf columns”<a class="anchor" aria-label="anchor" href="#all-rows-assigned-to-inf-columns"></a>
</h3>
<p><strong>Cause</strong>: Caliper is too strict; all potential matches
exceed threshold.</p>
<p><strong>Solution</strong>: Increase <code>max_distance</code> or
check for overlap issues.</p>
</div>
<div class="section level3">
<h3 id="subscript-out-of-bounds">“subscript out of bounds”<a class="anchor" aria-label="anchor" href="#subscript-out-of-bounds"></a>
</h3>
<p><strong>Cause</strong>: Empty left or right data frame, or ID
mismatch.</p>
<p><strong>Solution</strong>: Check data dimensions and ID column
consistency.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Always verify data before matching</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">left</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">right</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter an issue not covered here:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Check function documentation</strong>:
<code><a href="../reference/match_couples.html">?match_couples</a></code>, <code><a href="../reference/lap_solve.html">?lap_solve</a></code>
</li>
<li>
<strong>Search GitHub issues</strong>: <a href="https://github.com/gcol33/couplr/issues" class="external-link">github.com/gcol33/couplr/issues</a>
</li>
<li>
<strong>Create a minimal reproducible example</strong>:</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Minimal example template</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gcol33.github.io/couplr/">couplr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Minimal data that reproduces the issue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Code that causes the error</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Expected vs actual behavior</span></span>
<span><span class="co"># Expected: ...</span></span>
<span><span class="co"># Actual: [error message]</span></span>
<span></span>
<span><span class="co"># Session info</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Open an issue</strong> with your example at <a href="https://github.com/gcol33/couplr/issues/new" class="external-link">github.com/gcol33/couplr/issues/new</a>
</li>
</ol>
<hr>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code> - Basic usage</li>
<li>
<code><a href="../articles/matching-workflows.html">vignette("matching-workflows")</a></code> - Production matching
pipelines</li>
<li>
<code><a href="../articles/algorithms.html">vignette("algorithms")</a></code> - Algorithm selection guide</li>
<li>
<code><a href="../articles/comparison.html">vignette("comparison")</a></code> - Comparison with other
packages</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gcol33" class="external-link">Gilles Colling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
