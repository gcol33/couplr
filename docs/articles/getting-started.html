<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quick Start • couplr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Quick Start">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">couplr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/algorithms.html">Algorithm Details</a></li>
    <li><a class="dropdown-item" href="../articles/matching-workflows.html">Matching Workflows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison with Alternatives</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/pixel-morphing.html">Pixel Morphing &amp; Scientific Applications</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/couplr" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quick Start</h1>
                        <h4 data-toc-skip class="author">Gilles
Colling</h4>
            
            <h4 data-toc-skip class="date">2026-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gcol33/couplr/blob/HEAD/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-couplr-does">What couplr Does<a class="anchor" aria-label="anchor" href="#what-couplr-does"></a>
</h2>
<p>couplr creates matched pairs from two groups of observations. Given a
“left” group (e.g., treatment) and a “right” group (e.g., control), it
finds the best one-to-one pairing based on similarity across variables
you specify.</p>
<p><strong>Common use cases:</strong></p>
<ul>
<li>Matching treated patients to similar controls in observational
studies</li>
<li>Pairing survey respondents for comparison</li>
<li>Creating balanced samples for causal inference</li>
</ul>
<div class="section level3">
<h3 id="documentation-roadmap">Documentation Roadmap<a class="anchor" aria-label="anchor" href="#documentation-roadmap"></a>
</h3>
<table style="width:100%;" class="table">
<colgroup>
<col width="37%">
<col width="25%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Vignette</th>
<th>Focus</th>
<th>Audience</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<strong>Quick Start</strong> (this)</td>
<td>Basic matching with <code><a href="../reference/match_couples.html">match_couples()</a></code>
</td>
<td>Everyone</td>
</tr>
<tr class="even">
<td><a href="matching-workflows.html">Matching Workflows</a></td>
<td>Full pipeline: preprocessing, blocking, diagnostics</td>
<td>Researchers</td>
</tr>
<tr class="odd">
<td><a href="algorithms.html">Algorithms</a></td>
<td>Mathematical foundations, solver selection</td>
<td>Technical users</td>
</tr>
<tr class="even">
<td><a href="comparison.html">Comparison</a></td>
<td>vs MatchIt, optmatch, designmatch</td>
<td>Package evaluators</td>
</tr>
</tbody>
</table>
<p><strong>Start here</strong>, then proceed to whichever vignette
matches your use case.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="your-first-match">Your First Match<a class="anchor" aria-label="anchor" href="#your-first-match"></a>
</h2>
<p>The simplest workflow uses <code><a href="../reference/match_couples.html">match_couples()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gcol33.github.io/couplr/">couplr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create example data: treatment and control groups</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">45</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">55000</span>, sd <span class="op">=</span> <span class="fl">12000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">80</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">80</span>, mean <span class="op">=</span> <span class="fl">50</span>, sd <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">80</span>, mean <span class="op">=</span> <span class="fl">48000</span>, sd <span class="op">=</span> <span class="fl">15000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Match on age and income</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>  right <span class="op">=</span> <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="co"># View matched pairs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">pairs</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   left_id right_id distance .age_diff .income_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       46          0.779    -<span style="color: #BB0000;">4.23</span>        <span style="text-decoration: underline;">9</span>144. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2       11          0.257    -<span style="color: #BB0000;">0.398</span>       <span style="text-decoration: underline;">3</span>441. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3       52          0.594     1.36        <span style="text-decoration: underline;">7</span>840. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4       66          0.809    -<span style="color: #BB0000;">7.87</span>       -<span style="color: #BB0000; text-decoration: underline;">5</span><span style="color: #BB0000;">112.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5       65          0.530     1.30        <span style="text-decoration: underline;">6</span>977. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6       36          0.130    -<span style="color: #BB0000;">1.43</span>          62.2</span></span></code></pre></div>
<p><strong>What happened:</strong></p>
<ol style="list-style-type: decimal">
<li>couplr calculated how similar each treatment unit is to each control
unit</li>
<li>It found the optimal one-to-one pairing that minimizes total
distance</li>
<li>Each treatment unit gets matched to exactly one control unit</li>
</ol>
<div class="section level3">
<h3 id="understanding-the-output">Understanding the Output<a class="anchor" aria-label="anchor" href="#understanding-the-output"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick overview with summary()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matching Result Summary</span></span>
<span><span class="co">#&gt; =======================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: lap</span></span>
<span><span class="co">#&gt; Pairs matched: 50 </span></span>
<span><span class="co">#&gt; Unmatched: 0 left, 30 right</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distance Statistics:</span></span>
<span><span class="co">#&gt;   Total: 19.6423 </span></span>
<span><span class="co">#&gt;   Mean: 0.3928 </span></span>
<span><span class="co">#&gt;   Min: 0.0615 </span></span>
<span><span class="co">#&gt;   Q1: 0.1845 </span></span>
<span><span class="co">#&gt;   Median: 0.2967 </span></span>
<span><span class="co">#&gt;   Q3: 0.5039 </span></span>
<span><span class="co">#&gt;   Max: 1.2184 </span></span>
<span><span class="co">#&gt;   SD: 0.2863</span></span>
<span></span>
<span><span class="co"># Or access specific info</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span></span>
<span><span class="co">#&gt; [1] 50</span></span></code></pre></div>
<p>The <code>result$pairs</code> table contains:</p>
<ul>
<li>
<code>left_id</code>: Row number from the treatment group</li>
<li>
<code>right_id</code>: Row number from the control group</li>
<li>
<code>distance</code>: How different the matched units are (lower =
more similar)</li>
</ul>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="why-scaling-matters">Why Scaling Matters<a class="anchor" aria-label="anchor" href="#why-scaling-matters"></a>
</h2>
<p>Without scaling, variables with larger values dominate the matching.
Income (measured in thousands) would overwhelm age (measured in
decades):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BAD: Without scaling, income dominates</span></span>
<span><span class="va">result_unscaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">treatment</span>, <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GOOD: With scaling, both variables contribute equally</span></span>
<span><span class="va">result_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">treatment</span>, <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="co"># Compare mean distances</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Unscaled mean distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_unscaled</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unscaled mean distance: 2769.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Scaled mean distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_scaled</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scaled mean distance: 0.393</span></span></code></pre></div>
<p><strong>Rule of thumb:</strong> Always use
<code>auto_scale = TRUE</code> unless you have a specific reason not
to.</p>
<hr>
</div>
<div class="section level2">
<h2 id="checking-match-quality">Checking Match Quality<a class="anchor" aria-label="anchor" href="#checking-match-quality"></a>
</h2>
<p>After matching, verify that treatment and control groups are now
balanced:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the matched observations</span></span>
<span><span class="va">matched_treatment</span> <span class="op">&lt;-</span> <span class="va">treatment</span><span class="op">[</span><span class="va">result</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">left_id</span>, <span class="op">]</span></span>
<span><span class="va">matched_control</span> <span class="op">&lt;-</span> <span class="va">control</span><span class="op">[</span><span class="va">result</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">right_id</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Compare means before and after matching</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"BEFORE matching:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; BEFORE matching:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Age difference:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">control</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"years\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Age difference: -3.4 years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Income difference: $"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">$</span><span class="va">income</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">control</span><span class="op">$</span><span class="va">income</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Income difference: $ 9266</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"AFTER matching:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; AFTER matching:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Age difference:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">matched_treatment</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">matched_control</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"years\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Age difference: -1.3 years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Income difference: $"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">matched_treatment</span><span class="op">$</span><span class="va">income</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">matched_control</span><span class="op">$</span><span class="va">income</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Income difference: $ 2667</span></span></code></pre></div>
<p>For formal balance assessment, use <code><a href="../reference/balance_diagnostics.html">balance_diagnostics()</a></code>
(covered in <a href="matching-workflows.html">Matching
Workflows</a>).</p>
<div class="section level3">
<h3 id="visualizing-match-quality">Visualizing Match Quality<a class="anchor" aria-label="anchor" href="#visualizing-match-quality"></a>
</h3>
<p>Use <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to see the distribution of match
distances:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>

<div class="svg-container"><button type="button" class="btn btn-primary btn-copy-svg" title="Copy SVG to clipboard" aria-label="Copy SVG to clipboard" data-bs-toggle="tooltip" data-bs-placement="left"><i class="fa fa-copy"></i></button>
<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='432.00pt' height='288.00pt' viewBox='0 0 432.00 288.00' class="r-plt inline-svg" style="max-width:100%;width:100%;height:auto;">
<g class='svglite'>
<defs>
  <style type='text/css'><![CDATA[
    /* theme-aware-processed */
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite circle {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite > g > rect {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
      fill: #3E3F3A;
    }
    .svglite g.glyphgroup path {
      fill: inherit;
      stroke: none;
    }
  ]]></style>
</defs>
<rect width='100%' height='100%' style='stroke: none; fill: #F5F6F8;'/>
<defs>
  <clipPath id='cpMC4wMHw0MzIuMDB8MC4wMHwyODguMDA='>
    <rect x='0.00' y='0.00' width='432.00' height='288.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMC4wMHw0MzIuMDB8MC4wMHwyODguMDA=)'>
<text x='230.40' y='34.67' text-anchor='middle' style='font-size: 14.40px; font-weight: bold; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='181.95px' lengthAdjust='spacingAndGlyphs'>Matching Distances (n=50)</text>
<text x='230.40' y='269.28' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='46.69px' lengthAdjust='spacingAndGlyphs'>Distance</text>
<text transform='translate(12.96,136.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='56.69px' lengthAdjust='spacingAndGlyphs'>Frequency</text>
<line x1='71.73' y1='214.56' x2='389.07' y2='214.56' style='stroke-width: 0.75;' />
<line x1='71.73' y1='214.56' x2='71.73' y2='221.76' style='stroke-width: 0.75;' />
<line x1='117.07' y1='214.56' x2='117.07' y2='221.76' style='stroke-width: 0.75;' />
<line x1='162.40' y1='214.56' x2='162.40' y2='221.76' style='stroke-width: 0.75;' />
<line x1='207.73' y1='214.56' x2='207.73' y2='221.76' style='stroke-width: 0.75;' />
<line x1='253.07' y1='214.56' x2='253.07' y2='221.76' style='stroke-width: 0.75;' />
<line x1='298.40' y1='214.56' x2='298.40' y2='221.76' style='stroke-width: 0.75;' />
<line x1='343.73' y1='214.56' x2='343.73' y2='221.76' style='stroke-width: 0.75;' />
<line x1='389.07' y1='214.56' x2='389.07' y2='221.76' style='stroke-width: 0.75;' />
<text x='71.73' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.0</text>
<text x='117.07' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.2</text>
<text x='162.40' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.4</text>
<text x='207.73' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.6</text>
<text x='253.07' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.8</text>
<text x='298.40' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>1.0</text>
<text x='343.73' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>1.2</text>
<text x='389.07' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>1.4</text>
<line x1='59.04' y1='208.80' x2='59.04' y2='64.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='208.80' x2='51.84' y2='208.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='160.80' x2='51.84' y2='160.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='112.80' x2='51.84' y2='112.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='64.80' x2='51.84' y2='64.80' style='stroke-width: 0.75;' />
<text transform='translate(41.76,208.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>0</text>
<text transform='translate(41.76,160.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>5</text>
<text transform='translate(41.76,112.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='13.34px' lengthAdjust='spacingAndGlyphs'>10</text>
<text transform='translate(41.76,64.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='13.34px' lengthAdjust='spacingAndGlyphs'>15</text>
</g>
<defs>
  <clipPath id='cpNTkuMDR8NDAxLjc2fDU5LjA0fDIxNC41Ng=='>
    <rect x='59.04' y='59.04' width='342.72' height='155.52' />
  </clipPath>
</defs>
<g clip-path='url(#cpNTkuMDR8NDAxLjc2fDU5LjA0fDIxNC41Ng==)'>
<rect x='71.73' y='74.40' width='45.33' height='134.40' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
<rect x='117.07' y='64.80' width='45.33' height='144.00' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
<rect x='162.40' y='84.00' width='45.33' height='124.80' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
<rect x='207.73' y='180.00' width='45.33' height='28.80' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
<rect x='253.07' y='189.60' width='45.33' height='19.20' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
<rect x='298.40' y='199.20' width='45.33' height='9.60' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
<rect x='343.73' y='189.60' width='45.33' height='19.20' style='stroke-width: 0.75; stroke: #FFFFFF; fill: #4682B4;' />
</g>
</g>
</svg></div>

<p>The histogram shows how similar matched pairs are. A distribution
concentrated near zero indicates good matches.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="large-datasets-use-greedy-matching">Large Datasets: Use Greedy Matching<a class="anchor" aria-label="anchor" href="#large-datasets-use-greedy-matching"></a>
</h2>
<p>For datasets larger than a few thousand observations, optimal
matching becomes slow. Use <code><a href="../reference/greedy_couples.html">greedy_couples()</a></code> instead; it’s
10-100x faster with nearly identical results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create larger datasets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">large_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2000</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">45</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">55000</span>, <span class="fl">12000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">large_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3000</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">50</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">48000</span>, <span class="fl">15000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fast greedy matching</span></span>
<span><span class="va">result_greedy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">large_treatment</span>, <span class="va">large_control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"row_best"</span>  <span class="co"># fastest strategy</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="va">result_greedy</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matched 2000 pairs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_greedy</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean distance: 0.201</span></span></code></pre></div>
<p><strong>When to use which:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Dataset size</th>
<th>Recommended function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>&lt; 1,000 per group</td>
<td><code><a href="../reference/match_couples.html">match_couples()</a></code></td>
</tr>
<tr class="even">
<td>1,000 - 5,000</td>
<td>Either works; greedy is faster</td>
</tr>
<tr class="odd">
<td>&gt; 5,000</td>
<td><code><a href="../reference/greedy_couples.html">greedy_couples()</a></code></td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="setting-a-maximum-distance-caliper">Setting a Maximum Distance (Caliper)<a class="anchor" aria-label="anchor" href="#setting-a-maximum-distance-caliper"></a>
</h2>
<p>Sometimes you want to reject poor matches rather than force bad
pairings. Use <code>max_distance</code> to set a caliper:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Allow any match</span></span>
<span><span class="va">result_loose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">treatment</span>, <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="co"># Only allow close matches</span></span>
<span><span class="va">result_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">treatment</span>, <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.5</span>  <span class="co"># reject pairs more different than this</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Without caliper:"</span>, <span class="va">result_loose</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Without caliper: 50 pairs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"With caliper:"</span>, <span class="va">result_strict</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; With caliper: 40 pairs</span></span></code></pre></div>
<p>Stricter calipers mean fewer but better matches.</p>
<hr>
</div>
<div class="section level2">
<h2 id="matching-within-groups-blocking">Matching Within Groups (Blocking)<a class="anchor" aria-label="anchor" href="#matching-within-groups-blocking"></a>
</h2>
<p>When you have natural groups in your data (e.g., hospitals, regions,
study sites), you can match within each group separately. This ensures
exact balance on the grouping variable.</p>
<p>First, create blocks with <code><a href="../reference/matchmaker.html">matchmaker()</a></code>, then pass the
result to <code><a href="../reference/match_couples.html">match_couples()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data from multiple hospital sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span>
<span><span class="va">treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">60</span>,</span>
<span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span>, <span class="st">"Hospital C"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">55</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  severity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">controls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">90</span>,</span>
<span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span>, <span class="st">"Hospital C"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">52</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  severity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">4.5</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1: Create blocks by hospital site</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">treated</span>,</span>
<span>  right <span class="op">=</span> <span class="va">controls</span>,</span>
<span>  block_type <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  block_by <span class="op">=</span> <span class="st">"site"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Match within each block</span></span>
<span><span class="va">result_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">blocks</span><span class="op">$</span><span class="va">left</span>,</span>
<span>  right <span class="op">=</span> <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"severity"</span><span class="op">)</span>,</span>
<span>  block_id <span class="op">=</span> <span class="st">"block_id"</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="co"># Verify: matches stay within their block</span></span>
<span><span class="va">result_blocked</span><span class="op">$</span><span class="va">pairs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">block_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   block_id       n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hospital A    20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hospital B    20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Hospital C    20</span></span></code></pre></div>
<p>Blocking guarantees that Hospital A patients are only matched to
Hospital A controls, etc.</p>
<hr>
</div>
<div class="section level2">
<h2 id="complete-example">Complete Example<a class="anchor" aria-label="anchor" href="#complete-example"></a>
</h2>
<p>Here’s a realistic workflow from start to finish:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Prepare your data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">patients_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  patient_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">62</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  bmi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">28</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  smoker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">patients_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  patient_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">58</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  bmi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">26</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  smoker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">200</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Match on clinical variables</span></span>
<span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">patients_treated</span>,</span>
<span>  right <span class="op">=</span> <span class="va">patients_control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"smoker"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="co"># 3. Check how many matched</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Treated patients:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">patients_treated</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Treated patients: 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Successfully matched:"</span>, <span class="va">matched</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Successfully matched: 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Match rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">matched</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">patients_treated</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Match rate: 100 %</span></span>
<span></span>
<span><span class="co"># 4. Extract matched samples for analysis</span></span>
<span><span class="va">treated_matched</span> <span class="op">&lt;-</span> <span class="va">patients_treated</span><span class="op">[</span><span class="va">matched</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">left_id</span>, <span class="op">]</span></span>
<span><span class="va">control_matched</span> <span class="op">&lt;-</span> <span class="va">patients_control</span><span class="op">[</span><span class="va">matched</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">right_id</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># 5. Verify balance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBalance check (difference in means):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance check (difference in means):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Age:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">treated_matched</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">control_matched</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Age: NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  BMI:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">treated_matched</span><span class="op">$</span><span class="va">bmi</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">control_matched</span><span class="op">$</span><span class="va">bmi</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   BMI: NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Smoker %:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">treated_matched</span><span class="op">$</span><span class="va">smoker</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">control_matched</span><span class="op">$</span><span class="va">smoker</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Smoker %: NA</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>You now know the basics of matching with couplr. Here’s where to go
next:</p>
<p><strong>For production research workflows:</strong></p>
<ul>
<li>
<a href="matching-workflows.html">Matching Workflows</a> covers
preprocessing, blocking, formal balance diagnostics, and
publication-ready output</li>
</ul>
<p><strong>For understanding algorithm choices:</strong></p>
<ul>
<li>
<a href="algorithms.html">Algorithms</a> explains when different
solvers are faster or more appropriate</li>
</ul>
<p><strong>For comparing with other packages:</strong></p>
<ul>
<li>
<a href="comparison.html">Comparison</a> shows how couplr differs
from MatchIt, optmatch, and designmatch</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="additional-direct-assignment-problem-solving">Additional: Direct Assignment Problem Solving<a class="anchor" aria-label="anchor" href="#additional-direct-assignment-problem-solving"></a>
</h2>
<p>If you need to solve assignment problems directly (not matching
workflows), couplr also provides lower-level functions.</p>
<div class="section level3">
<h3 id="lap_solve-matrix-based-assignment">lap_solve(): Matrix-Based Assignment<a class="anchor" aria-label="anchor" href="#lap_solve-matrix-based-assignment"></a>
</h3>
<p>Given a cost matrix where entry (i,j) is the cost of assigning row i
to column j:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cost matrix: 3 workers × 3 tasks</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">5</span>,</span>
<span>  <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span>
<span>  <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">4</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assignment Result</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   source target  cost</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1      2     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2      1     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3      3     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total cost: 9 </span></span>
<span><span class="co">#&gt; Method: bruteforce</span></span></code></pre></div>
<p>Row 1 is assigned to column 2 (cost 2), row 2 to column 1 (cost 3),
row 3 to column 3 (cost 4). Total cost: 9.</p>
</div>
<div class="section level3">
<h3 id="forbidden-assignments">Forbidden Assignments<a class="anchor" aria-label="anchor" href="#forbidden-assignments"></a>
</h3>
<p>Use <code>NA</code> or <code>Inf</code> for impossible
assignments:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost_forbidden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">4</span>, <span class="fl">2</span>, <span class="cn">NA</span>,   <span class="co"># Row 1 cannot go to column 3</span></span>
<span>  <span class="cn">Inf</span>, <span class="fl">3</span>, <span class="fl">6</span>,  <span class="co"># Row 2 cannot go to column 1</span></span>
<span>  <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">4</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_forbidden</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assignment Result</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   source target  cost</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1      1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2      2     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3      3     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total cost: 11 </span></span>
<span><span class="co">#&gt; Method: bruteforce</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="maximization">Maximization<a class="anchor" aria-label="anchor" href="#maximization"></a>
</h3>
<p>For preference or profit maximization:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preferences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">8</span>, <span class="fl">5</span>, <span class="fl">3</span>,</span>
<span>  <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">6</span>,</span>
<span>  <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">9</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">preferences</span>, maximize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assignment Result</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   source target  cost</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1      1     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2      2     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3      3     9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total cost: 24 </span></span>
<span><span class="co">#&gt; Method: bruteforce</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="grouped-data">Grouped Data<a class="anchor" aria-label="anchor" href="#grouped-data"></a>
</h3>
<p>Solve multiple assignment problems at once using grouped data
frames:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Weekly nurse-shift scheduling: solve each day separately</span></span>
<span><span class="va">schedule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  nurse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>  cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">5</span>, <span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">6</span>, <span class="fl">7</span>,<span class="fl">5</span>,<span class="fl">4</span>,   <span class="co"># Monday costs</span></span>
<span>           <span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">4</span>, <span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span>, <span class="fl">6</span>,<span class="fl">4</span>,<span class="fl">3</span>,   <span class="co"># Tuesday costs</span></span>
<span>           <span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>, <span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>, <span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">4</span><span class="op">)</span>   <span class="co"># Wednesday costs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Solve all three days at once</span></span>
<span><span class="va">schedule</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">nurse</span>, <span class="va">shift</span>, <span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">#&gt;   day   source target  cost</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Mon        1      2     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Mon        2      1     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Mon        3      3     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Tue        1      2     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Tue        2      1     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Tue        3      3     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Wed        1      1     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Wed        2      2     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Wed        3      3     4</span></span></code></pre></div>
<p>This solves each day’s assignment problem independently and returns
all results in one tidy table.</p>
</div>
<div class="section level3">
<h3 id="k-best-solutions">K-Best Solutions<a class="anchor" aria-label="anchor" href="#k-best-solutions"></a>
</h3>
<p>Find multiple near-optimal solutions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kbest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve_kbest.html">lap_solve_kbest</a></span><span class="op">(</span><span class="va">cost</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">kbest</span><span class="op">)</span></span>
<span><span class="co">#&gt; K-Best Assignment Results</span></span>
<span><span class="co">#&gt; =========================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of solutions: 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Solution costs:</span></span>
<span><span class="co">#&gt;   Rank 1: 5.0000</span></span>
<span><span class="co">#&gt;   Rank 2: 7.0000</span></span>
<span><span class="co">#&gt;   Rank 3: 7.0000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Assignments:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 6</span></span></span>
<span><span class="co">#&gt;    rank solution_id source target  cost total_cost</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1           1      1      1     1          5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1           1      2      2     3          5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1           1      3      3     1          5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2           2      1      2     2          7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2           2      2      1     4          7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2           2      3      3     1          7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     3           3      1      1     1          7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     3           3      2      3     2          7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>     3           3      3      2     4          7</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../reference/match_couples.html">?match_couples</a></code> - Optimal matching function
reference</li>
<li>
<code><a href="../reference/greedy_couples.html">?greedy_couples</a></code> - Fast approximate matching</li>
<li>
<code><a href="../reference/balance_diagnostics.html">?balance_diagnostics</a></code> - Formal balance assessment</li>
<li>
<code><a href="../reference/lap_solve.html">?lap_solve</a></code> - Direct assignment problem solving</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gcol33" class="external-link">Gilles Colling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  <script>
/* SVG Copy Button Functionality - Copy as PNG Image */
(function() {
  "use strict";

  // Convert SVG to PNG and copy to clipboard
  async function copySvgAsImage(svg, btn) {
    try {
      // Get SVG dimensions
      var svgRect = svg.getBoundingClientRect();
      var width = svgRect.width;
      var height = svgRect.height;

      // Use higher resolution for better quality (2x)
      var scale = 2;
      var canvas = document.createElement("canvas");
      canvas.width = width * scale;
      canvas.height = height * scale;
      var ctx = canvas.getContext("2d");
      ctx.scale(scale, scale);

      // Clone SVG and prepare for rendering
      var clone = svg.cloneNode(true);
      clone.classList.remove("inline-svg");

      // Get computed styles and inline them for proper rendering
      var svgStyles = window.getComputedStyle(svg);

      // Serialize SVG
      var serializer = new XMLSerializer();
      var svgString = serializer.serializeToString(clone);

      // Create a blob and URL for the SVG
      var svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
      var url = URL.createObjectURL(svgBlob);

      // Create image and draw to canvas
      var img = new Image();
      img.onload = async function() {
        // Fill white background (for transparency)
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, width, height);

        // Draw the SVG
        ctx.drawImage(img, 0, 0, width, height);
        URL.revokeObjectURL(url);

        // Convert canvas to blob and copy to clipboard
        canvas.toBlob(async function(blob) {
          try {
            var item = new ClipboardItem({ "image/png": blob });
            await navigator.clipboard.write([item]);

            // Show success tooltip
            showTooltip(btn, "Copied!");
          } catch (err) {
            console.error("Failed to copy image:", err);
            showTooltip(btn, "Copy failed - try right-click");
          }
        }, "image/png");
      };

      img.onerror = function() {
        URL.revokeObjectURL(url);
        console.error("Failed to load SVG as image");
        showTooltip(btn, "Copy failed");
      };

      img.src = url;

    } catch (err) {
      console.error("Error copying SVG:", err);
      showTooltip(btn, "Copy failed");
    }
  }

  // Show tooltip message
  function showTooltip(btn, message) {
    var originalTitle = btn.getAttribute("data-bs-original-title") || btn.getAttribute("title");
    btn.setAttribute("data-bs-original-title", message);
    var tooltip = bootstrap.Tooltip.getInstance(btn);
    if (tooltip) {
      tooltip.show();
    }
    setTimeout(function() {
      btn.setAttribute("data-bs-original-title", originalTitle);
    }, 1500);
  }

  // Initialize SVG copy buttons after DOM is ready
  document.addEventListener("DOMContentLoaded", function() {
    // Check for Clipboard API support
    if (!navigator.clipboard || !navigator.clipboard.write) {
      console.warn("Clipboard API not supported - SVG copy buttons disabled");
      return;
    }

    // Add click handlers to all SVG copy buttons
    document.querySelectorAll(".btn-copy-svg").forEach(function(btn) {
      btn.addEventListener("click", function(e) {
        e.preventDefault();
        var container = btn.closest(".svg-container");
        if (!container) return;

        var svg = container.querySelector("svg");
        if (!svg) return;

        copySvgAsImage(svg, btn);
      });

      // Initialize Bootstrap tooltip
      new bootstrap.Tooltip(btn, { container: "body" });
    });
  });
})();
</script>
</body>
</html>
