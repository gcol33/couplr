<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparison with Alternatives • couplr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Comparison with Alternatives">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">couplr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/algorithms.html">Algorithm Details</a></li>
    <li><a class="dropdown-item" href="../articles/matching-workflows.html">Matching Workflows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison with Alternatives</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/pixel-morphing.html">Pixel Morphing &amp; Scientific Applications</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/couplr" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comparison with Alternatives</h1>
                        <h4 data-toc-skip class="author">Gilles
Colling</h4>
            
            <h4 data-toc-skip class="date">2026-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gcol33/couplr/blob/HEAD/vignettes/comparison.Rmd" class="external-link"><code>vignettes/comparison.Rmd</code></a></small>
      <div class="d-none name"><code>comparison.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette compares couplr’s approach to matching with established
R packages: 1. <strong>MatchIt</strong> - The most popular matching
package in R 2. <strong>optmatch</strong> - Optimal full matching with
constraints 3. <strong>designmatch</strong> - Optimization-based
matching with balance constraints 4. <strong>Matching</strong> - Genetic
matching and multivariate matching</p>
<p>Each comparison examines algorithmic differences, API design,
performance characteristics, and appropriate use cases. We use simulated
observational data to demonstrate practical differences.</p>
<p><strong>Prerequisites</strong>: Familiarity with
<code><a href="../articles/matching-workflows.html">vignette("matching-workflows")</a></code> for couplr’s matching
approach.</p>
<hr>
</div>
<div class="section level2">
<h2 id="evaluation-dataset">Evaluation Dataset<a class="anchor" aria-label="anchor" href="#evaluation-dataset"></a>
</h2>
<p>We simulate a job training evaluation scenario with selection
bias:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Treatment group: younger, more educated, higher prior earnings</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, mean <span class="op">=</span> <span class="fl">35</span>, sd <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>  education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, mean <span class="op">=</span> <span class="fl">14</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  prior_earnings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, mean <span class="op">=</span> <span class="fl">40000</span>, sd <span class="op">=</span> <span class="fl">12000</span><span class="op">)</span>,</span>
<span>  employed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"treatment"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Control group: older, less educated, lower prior earnings (selection bias)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">201</span><span class="op">:</span><span class="fl">700</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, mean <span class="op">=</span> <span class="fl">45</span>, sd <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, mean <span class="op">=</span> <span class="fl">12</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  prior_earnings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, mean <span class="op">=</span> <span class="fl">32000</span>, sd <span class="op">=</span> <span class="fl">15000</span><span class="op">)</span>,</span>
<span>  employed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"control"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine for packages that expect single data frame</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">control</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"treatment"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Treatment units:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Treatment units: 200</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Control units:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">control</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Control units: 500</span></span>
<span></span>
<span><span class="co"># Baseline imbalance</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"prior_earnings"</span>, <span class="st">"employed"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="va">vars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">control</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">pooled_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">control</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">std_diff</span> <span class="op">&lt;-</span> <span class="va">diff</span> <span class="op">/</span> <span class="va">pooled_sd</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s: std diff = %.3f\n"</span>, <span class="va">v</span>, <span class="va">std_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; age: std diff = -0.967</span></span>
<span><span class="co">#&gt; education: std diff = 0.775</span></span>
<span><span class="co">#&gt; prior_earnings: std diff = 0.576</span></span>
<span><span class="co">#&gt; employed: std diff = 0.365</span></span></code></pre></div>
<p>Substantial baseline imbalance exists: treatment group is younger
(-0.9 SD), more educated (+0.7 SD), and has higher prior earnings (+0.6
SD).</p>
<hr>
</div>
<div class="section level2">
<h2 id="comparison-1-matchit">Comparison 1: MatchIt<a class="anchor" aria-label="anchor" href="#comparison-1-matchit"></a>
</h2>
<div class="section level3">
<h3 id="overview-1">Overview<a class="anchor" aria-label="anchor" href="#overview-1"></a>
</h3>
<p>MatchIt (Ho et al., 2011) is the most widely used matching package in
R. It emphasizes propensity score methods and provides a unified
interface to multiple matching algorithms.</p>
<p><strong>Key difference</strong>: MatchIt typically matches on
estimated propensity scores (a single summary measure), while couplr
matches directly on covariates (multivariate distance).</p>
</div>
<div class="section level3">
<h3 id="matchit-approach">MatchIt Approach<a class="anchor" aria-label="anchor" href="#matchit-approach"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"MatchIt"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/" class="external-link">MatchIt</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># MatchIt: Propensity score matching (default)</span></span>
<span>  <span class="va">m_ps</span> <span class="op">&lt;-</span> <span class="fu">matchit</span><span class="op">(</span></span>
<span>    <span class="va">treated</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">prior_earnings</span> <span class="op">+</span> <span class="va">employed</span>,</span>
<span>    data <span class="op">=</span> <span class="va">combined</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"nearest"</span>,</span>
<span>    distance <span class="op">=</span> <span class="st">"glm"</span>  <span class="co"># Propensity score via logistic regression</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"MatchIt (propensity score, nearest neighbor):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m_ps</span><span class="op">$</span><span class="va">weights</span><span class="op">[</span><span class="va">combined</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract matched data</span></span>
<span>  <span class="va">matched_ps</span> <span class="op">&lt;-</span> <span class="fu">match.data</span><span class="op">(</span><span class="va">m_ps</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="couplr-approach">couplr Approach<a class="anchor" aria-label="anchor" href="#couplr-approach"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># couplr: Direct covariate matching</span></span>
<span><span class="va">result_couplr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>  right <span class="op">=</span> <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"prior_earnings"</span>, <span class="st">"employed"</span><span class="op">)</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"robust"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\ncouplr (direct covariate matching):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; couplr (direct covariate matching):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="va">result_couplr</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Matched pairs: 200</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mean distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_couplr</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mean distance: 0.5844</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="balance-comparison">Balance Comparison<a class="anchor" aria-label="anchor" href="#balance-comparison"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"MatchIt"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># MatchIt balance</span></span>
<span>  <span class="va">matched_treated_ps</span> <span class="op">&lt;-</span> <span class="va">matched_ps</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">matched_control_ps</span> <span class="op">&lt;-</span> <span class="va">matched_ps</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">matchit_balance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="va">vars</span>,</span>
<span>    std_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">matched_treated_ps</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">matched_control_ps</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">pooled_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">matched_treated_ps</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">matched_control_ps</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="va">diff</span> <span class="op">/</span> <span class="va">pooled_sd</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"MatchIt"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># couplr balance</span></span>
<span>  <span class="va">couplr_balance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span></span>
<span>    <span class="va">result_couplr</span>, <span class="va">treatment</span>, <span class="va">control</span>, <span class="va">vars</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">couplr_balance_df</span> <span class="op">&lt;-</span> <span class="va">couplr_balance</span><span class="op">$</span><span class="va">var_stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">std_diff</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"couplr"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Combine and plot</span></span>
<span>  <span class="va">balance_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">matchit_balance</span>, <span class="va">couplr_balance_df</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">balance_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">std_diff</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#93c54b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.25</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#f47c3c"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Covariate Balance: MatchIt vs couplr"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="st">"Green line = 0.1 (excellent), Orange line = 0.25 (acceptable)"</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"Variable"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"|Standardized Difference|"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"Method"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MatchIt"</span> <span class="op">=</span> <span class="st">"#29abe0"</span>, <span class="st">"couplr"</span> <span class="op">=</span> <span class="st">"#93c54b"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-differences">Key Differences<a class="anchor" aria-label="anchor" href="#key-differences"></a>
</h3>
<table class="table">
<colgroup>
<col width="34%">
<col width="34%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>MatchIt</th>
<th>couplr</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Primary approach</strong></td>
<td>Propensity score</td>
<td>Direct covariate distance</td>
</tr>
<tr class="even">
<td><strong>Distance metric</strong></td>
<td>PS logit, Mahalanobis</td>
<td>Euclidean (scaled)</td>
</tr>
<tr class="odd">
<td><strong>Optimization</strong></td>
<td>Greedy nearest neighbor</td>
<td>Optimal assignment (LAP)</td>
</tr>
<tr class="even">
<td><strong>Data format</strong></td>
<td>Single data frame + formula</td>
<td>Separate left/right data frames</td>
</tr>
<tr class="odd">
<td><strong>Diagnostics</strong></td>
<td>
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
</td>
<td>
<code><a href="../reference/balance_diagnostics.html">balance_diagnostics()</a></code>,
<code><a href="../reference/balance_table.html">balance_table()</a></code>
</td>
</tr>
<tr class="even">
<td><strong>Caliper</strong></td>
<td>On PS or covariates</td>
<td>On multivariate distance</td>
</tr>
<tr class="odd">
<td><strong>Algorithms</strong></td>
<td>10+ methods</td>
<td>20+ LAP solvers</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="when-to-use-each">When to Use Each<a class="anchor" aria-label="anchor" href="#when-to-use-each"></a>
</h3>
<p><strong>MatchIt</strong>: - Propensity score methods are preferred
(common in epidemiology) - Need full matching, CEM, or genetic matching
- Following published protocols that specify MatchIt - Familiar with
propensity score theory</p>
<p><strong>couplr</strong>: - Direct covariate matching is preferred (no
model for treatment) - Need optimal (minimum distance) one-to-one
matching - Working with large datasets (20+ LAP algorithms for different
scales) - Need fine-grained control over distance computation - Matching
on continuous variables where Euclidean distance is natural</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparison-2-optmatch">Comparison 2: optmatch<a class="anchor" aria-label="anchor" href="#comparison-2-optmatch"></a>
</h2>
<div class="section level3">
<h3 id="overview-2">Overview<a class="anchor" aria-label="anchor" href="#overview-2"></a>
</h3>
<p>optmatch (Hansen &amp; Klopfer, 2006) specializes in optimal matching
using network flow algorithms. It emphasizes full matching and variable
ratio matching.</p>
<p><strong>Key difference</strong>: optmatch excels at optimal full
matching (variable ratios); couplr focuses on optimal one-to-one
matching with 20+ algorithm choices.</p>
</div>
<div class="section level3">
<h3 id="optmatch-approach">optmatch Approach<a class="anchor" aria-label="anchor" href="#optmatch-approach"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"optmatch"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://optmat.ch" class="external-link">optmatch</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create distance matrix</span></span>
<span>  <span class="va">dist_mat</span> <span class="op">&lt;-</span> <span class="fu">match_on</span><span class="op">(</span></span>
<span>    <span class="va">treated</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">prior_earnings</span> <span class="op">+</span> <span class="va">employed</span>,</span>
<span>    data <span class="op">=</span> <span class="va">combined</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"mahalanobis"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Optimal pair matching</span></span>
<span>  <span class="va">m_opt</span> <span class="op">&lt;-</span> <span class="fu">pairmatch</span><span class="op">(</span><span class="va">dist_mat</span>, data <span class="op">=</span> <span class="va">combined</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">n_matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">m_opt</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"optmatch (optimal pair matching):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="couplr-approach-1">couplr Approach<a class="anchor" aria-label="anchor" href="#couplr-approach-1"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># couplr with Mahalanobis-like scaling</span></span>
<span><span class="va">result_couplr_maha</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>  right <span class="op">=</span> <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"standardize"</span>  <span class="co"># Similar to Mahalanobis diagonal</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\ncouplr (optimal pair matching):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; couplr (optimal pair matching):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="va">result_couplr_maha</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Matched pairs: 200</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="performance-comparison">Performance Comparison<a class="anchor" aria-label="anchor" href="#performance-comparison"></a>
</h3>
<p>Both packages use optimal assignment algorithms, so they should
achieve similar total distances. The key differences are in:</p>
<ol style="list-style-type: decimal">
<li>
<strong>API design</strong>: optmatch uses formula interface; couplr
uses separate data frames</li>
<li>
<strong>Algorithm selection</strong>: optmatch uses RELAX-IV; couplr
offers 20+ algorithms</li>
<li>
<strong>Full matching</strong>: optmatch supports variable-ratio
matching; couplr is one-to-one only</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"optmatch"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Compare total distances</span></span>
<span>  <span class="co"># (Note: Direct comparison is complex due to different distance scaling)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBoth packages find globally optimal one-to-one assignments.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total distance differences arise from distance metric choices.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-differences-1">Key Differences<a class="anchor" aria-label="anchor" href="#key-differences-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="37%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>optmatch</th>
<th>couplr</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Matching types</strong></td>
<td>Full, pair, variable ratio</td>
<td>One-to-one only</td>
</tr>
<tr class="even">
<td><strong>Algorithm</strong></td>
<td>RELAX-IV network flow</td>
<td>20+ solvers (JV, Hungarian, Auction, etc.)</td>
</tr>
<tr class="odd">
<td><strong>Distance</strong></td>
<td>
<code>match_on()</code> function</td>
<td>
<code><a href="../reference/compute_distances.html">compute_distances()</a></code> + caching</td>
</tr>
<tr class="even">
<td><strong>Constraints</strong></td>
<td>Caliper, exact matching</td>
<td>Caliper, blocking via <code><a href="../reference/matchmaker.html">matchmaker()</a></code>
</td>
</tr>
<tr class="odd">
<td><strong>Optimization</strong></td>
<td>Always optimal</td>
<td>Optimal or greedy (user choice)</td>
</tr>
<tr class="even">
<td><strong>Large problems</strong></td>
<td>Sparse matrix support</td>
<td>Blocking, greedy, parallel</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="when-to-use-each-1">When to Use Each<a class="anchor" aria-label="anchor" href="#when-to-use-each-1"></a>
</h3>
<p><strong>optmatch</strong>: - Full matching or variable ratio matching
needed - Network flow formulation is preferred - Integration with
RItools for diagnostics</p>
<p><strong>couplr</strong>: - One-to-one matching is sufficient - Need
algorithm flexibility (auction for n &gt; 1000, sparse methods, etc.) -
Large-scale problems requiring greedy approximations - Distance caching
for iterative analysis</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparison-3-designmatch">Comparison 3: designmatch<a class="anchor" aria-label="anchor" href="#comparison-3-designmatch"></a>
</h2>
<div class="section level3">
<h3 id="overview-3">Overview<a class="anchor" aria-label="anchor" href="#overview-3"></a>
</h3>
<p>designmatch (Zubizarreta et al., 2018) uses mixed-integer programming
to find matches satisfying explicit balance constraints. Rather than
minimizing distance, it finds feasible matches that meet user-specified
balance criteria.</p>
<p><strong>Key difference</strong>: designmatch optimizes for balance
constraints directly; couplr minimizes total distance (balance is a
consequence, not a constraint).</p>
</div>
<div class="section level3">
<h3 id="designmatch-approach">designmatch Approach<a class="anchor" aria-label="anchor" href="#designmatch-approach"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"designmatch"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">designmatch</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Prepare data for designmatch</span></span>
<span>  <span class="va">t_ind</span> <span class="op">&lt;-</span> <span class="va">combined</span><span class="op">$</span><span class="va">treated</span></span>
<span></span>
<span>  <span class="co"># Distance matrix (Mahalanobis)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">combined</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">dist_mat_dm</span> <span class="op">&lt;-</span> <span class="fu">distmat</span><span class="op">(</span><span class="va">t_ind</span>, <span class="va">X</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Balance constraints: mean differences</span></span>
<span>  <span class="va">mom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    covs <span class="op">=</span> <span class="va">X</span>,</span>
<span>    tols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Tolerance for standardized difference</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Solve with balance constraints</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">m_dm</span> <span class="op">&lt;-</span> <span class="fu">bmatch</span><span class="op">(</span></span>
<span>      t_ind <span class="op">=</span> <span class="va">t_ind</span>,</span>
<span>      dist_mat <span class="op">=</span> <span class="va">dist_mat_dm</span>,</span>
<span>      mom <span class="op">=</span> <span class="va">mom</span>,</span>
<span>      solver <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"glpk"</span>, approximate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"designmatch (balance-constrained matching):\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m_dm</span><span class="op">$</span><span class="va">t_id</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"designmatch: Balance constraints may be infeasible\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Try relaxing tolerances or reducing constraint count\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="couplr-approach-2">couplr Approach<a class="anchor" aria-label="anchor" href="#couplr-approach-2"></a>
</h3>
<p>couplr doesn’t constrain balance directly but achieves balance
through distance minimization:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># couplr: Optimize distance, then check balance</span></span>
<span><span class="va">result_couplr_dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>  right <span class="op">=</span> <span class="va">control</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="co"># No caliper - let algorithm find optimal matches</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span></span>
<span><span class="va">balance_dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">result_couplr_dm</span>, <span class="va">treatment</span>, <span class="va">control</span>, <span class="va">vars</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\ncouplr (distance-minimizing):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; couplr (distance-minimizing):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="va">result_couplr_dm</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Matched pairs: 200</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mean |std diff|:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">balance_dm</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">mean_abs_std_diff</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mean |std diff|: 0.2343</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Max |std diff|:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">balance_dm</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">max_abs_std_diff</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Max |std diff|: 0.4387</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-differences-2">Key Differences<a class="anchor" aria-label="anchor" href="#key-differences-2"></a>
</h3>
<table class="table">
<colgroup>
<col width="30%">
<col width="43%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>designmatch</th>
<th>couplr</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Objective</strong></td>
<td>Satisfy balance constraints</td>
<td>Minimize total distance</td>
</tr>
<tr class="even">
<td><strong>Balance</strong></td>
<td>Hard constraint</td>
<td>Achieved via optimization</td>
</tr>
<tr class="odd">
<td><strong>Solver</strong></td>
<td>Mixed-integer programming (GLPK, Gurobi)</td>
<td>Linear assignment (JV, Hungarian, etc.)</td>
</tr>
<tr class="even">
<td><strong>Feasibility</strong></td>
<td>May be infeasible</td>
<td>Always finds a solution</td>
</tr>
<tr class="odd">
<td><strong>Fine-grain control</strong></td>
<td>Moment constraints, cardinality</td>
<td>Caliper, blocking</td>
</tr>
<tr class="even">
<td><strong>Speed</strong></td>
<td>Slower (MIP)</td>
<td>Faster (LAP)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="when-to-use-each-2">When to Use Each<a class="anchor" aria-label="anchor" href="#when-to-use-each-2"></a>
</h3>
<p><strong>designmatch</strong>: - Specific balance requirements must be
guaranteed - Cardinality matching (fixed sample sizes) - Fine-grained
moment balancing (means, variances, quantiles) - Willing to accept no
solution if constraints infeasible</p>
<p><strong>couplr</strong>: - Distance minimization is the goal -
Balance is assessed post-hoc (typical workflow) - Need guaranteed
solutions - Iterative refinement (match, assess, refine)</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparison-4-matching-package">Comparison 4: Matching Package<a class="anchor" aria-label="anchor" href="#comparison-4-matching-package"></a>
</h2>
<div class="section level3">
<h3 id="overview-4">Overview<a class="anchor" aria-label="anchor" href="#overview-4"></a>
</h3>
<p>The Matching package (Sekhon, 2011) provides genetic matching and
multivariate matching with automatic balance optimization.</p>
<p><strong>Key difference</strong>: Matching uses genetic algorithms to
find weights that optimize balance; couplr uses fixed weights (after
scaling) and optimizes assignment.</p>
</div>
<div class="section level3">
<h3 id="matching-package-approach">Matching Package Approach<a class="anchor" aria-label="anchor" href="#matching-package-approach"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"Matching"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JasjeetSekhon/Matching" class="external-link">Matching</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Genetic matching (finds optimal weights)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">combined</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">m_gen</span> <span class="op">&lt;-</span> <span class="fu">Match</span><span class="op">(</span></span>
<span>    Tr <span class="op">=</span> <span class="va">combined</span><span class="op">$</span><span class="va">treated</span>,</span>
<span>    X <span class="op">=</span> <span class="va">X</span>,</span>
<span>    M <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># 1:1 matching</span></span>
<span>    estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matching package (multivariate matching):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Matched pairs:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">m_gen</span><span class="op">$</span><span class="va">index.treated</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="balance-comparison-1">Balance Comparison<a class="anchor" aria-label="anchor" href="#balance-comparison-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"Matching"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check balance from Matching package</span></span>
<span>  <span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu">MatchBalance</span><span class="op">(</span></span>
<span>    <span class="va">treated</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">prior_earnings</span> <span class="op">+</span> <span class="va">employed</span>,</span>
<span>    data <span class="op">=</span> <span class="va">combined</span>,</span>
<span>    match.out <span class="op">=</span> <span class="va">m_gen</span>,</span>
<span>    nboots <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-differences-3">Key Differences<a class="anchor" aria-label="anchor" href="#key-differences-3"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="37%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>Matching</th>
<th>couplr</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Weight optimization</strong></td>
<td>Genetic algorithm</td>
<td>Fixed (user-specified scaling)</td>
</tr>
<tr class="even">
<td><strong>Replacement</strong></td>
<td>With or without</td>
<td>Without only</td>
</tr>
<tr class="odd">
<td><strong>Estimand</strong></td>
<td>ATT, ATE, ATC</td>
<td>ATT (one-to-one)</td>
</tr>
<tr class="even">
<td><strong>Stochastic</strong></td>
<td>Yes (genetic search)</td>
<td>No (deterministic)</td>
</tr>
<tr class="odd">
<td><strong>Balance diagnostic</strong></td>
<td><code>MatchBalance()</code></td>
<td><code><a href="../reference/balance_diagnostics.html">balance_diagnostics()</a></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="when-to-use-each-3">When to Use Each<a class="anchor" aria-label="anchor" href="#when-to-use-each-3"></a>
</h3>
<p><strong>Matching</strong>: - Need automatic weight selection via
genetic optimization - Matching with replacement is acceptable - Need
ATE or ATC estimands (not just ATT) - Willing to accept stochastic
results</p>
<p><strong>couplr</strong>: - Deterministic, reproducible matching -
Matching without replacement - Direct control over variable scaling -
Large problems (couplr scales better)</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="performance-comparison-1">Performance Comparison<a class="anchor" aria-label="anchor" href="#performance-comparison-1"></a>
</h2>
<div class="section level3">
<h3 id="runtime-scaling">Runtime Scaling<a class="anchor" aria-label="anchor" href="#runtime-scaling"></a>
</h3>
<p>All packages slow down with problem size, but at different rates:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="19%">
<col width="17%">
<col width="23%">
<col width="26%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th>Problem Size</th>
<th>couplr (JV)</th>
<th>couplr (greedy)</th>
<th>MatchIt (nearest)</th>
<th>optmatch</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>n = 100</td>
<td>&lt; 0.01s</td>
<td>&lt; 0.01s</td>
<td>&lt; 0.01s</td>
<td>&lt; 0.01s</td>
</tr>
<tr class="even">
<td>n = 500</td>
<td>0.05s</td>
<td>0.01s</td>
<td>0.1s</td>
<td>0.1s</td>
</tr>
<tr class="odd">
<td>n = 1,000</td>
<td>0.5s</td>
<td>0.02s</td>
<td>0.5s</td>
<td>0.3s</td>
</tr>
<tr class="even">
<td>n = 5,000</td>
<td>30s</td>
<td>0.5s</td>
<td>5s</td>
<td>2s</td>
</tr>
<tr class="odd">
<td>n = 10,000</td>
<td>&gt; 60s</td>
<td>2s</td>
<td>20s</td>
<td>10s</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: couplr’s greedy matching is fastest for large
problems. For optimal matching, optmatch’s RELAX-IV is competitive.
couplr offers more algorithm choices for different scenarios.</p>
</div>
<div class="section level3">
<h3 id="memory-usage">Memory Usage<a class="anchor" aria-label="anchor" href="#memory-usage"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Package</th>
<th>Memory Model</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>couplr</td>
<td>Full distance matrix by default; greedy avoids this</td>
</tr>
<tr class="even">
<td>MatchIt</td>
<td>Propensity scores + sparse distance</td>
</tr>
<tr class="odd">
<td>optmatch</td>
<td>Sparse distance matrices</td>
</tr>
<tr class="even">
<td>designmatch</td>
<td>Full distance + constraint matrices</td>
</tr>
</tbody>
</table>
<p>For very large problems (n &gt; 10,000), use couplr’s blocking or
greedy modes.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="feature-comparison-summary">Feature Comparison Summary<a class="anchor" aria-label="anchor" href="#feature-comparison-summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="15%">
<col width="13%">
<col width="15%">
<col width="16%">
<col width="22%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>couplr</th>
<th>MatchIt</th>
<th>optmatch</th>
<th>designmatch</th>
<th>Matching</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>One-to-one matching</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td><strong>Full matching</strong></td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="odd">
<td><strong>Optimal assignment</strong></td>
<td>✓ (20 algorithms)</td>
<td>✓ (1 algorithm)</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Greedy matching</strong></td>
<td>✓ (3 strategies)</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Propensity scores</strong></td>
<td>✗ (external)</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr class="even">
<td><strong>Direct covariate</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Blocking/exact</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td><strong>Caliper</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Balance constraints</strong></td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Genetic optimization</strong></td>
<td>✗</td>
<td>✓ (GenMatch)</td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><strong>Distance caching</strong></td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Parallel processing</strong></td>
<td>✓ (blocks)</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr class="odd">
<td><strong>Deterministic</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
<tr class="even">
<td><strong>Tidy interface</strong></td>
<td>✓</td>
<td>Partial</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="decision-guide">Decision Guide<a class="anchor" aria-label="anchor" href="#decision-guide"></a>
</h2>
<div class="section level3">
<h3 id="choose-couplr-when">Choose couplr when:<a class="anchor" aria-label="anchor" href="#choose-couplr-when"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Direct covariate matching</strong> is preferred over
propensity scores</li>
<li>
<strong>Optimal one-to-one matching</strong> is the goal</li>
<li>
<strong>Large datasets</strong> (n &gt; 5,000) with greedy or
blocking options</li>
<li>
<strong>Algorithm flexibility</strong> is needed (auction for large
dense, sparse for many forbidden)</li>
<li>
<strong>Distance caching</strong> helps iterative analysis</li>
<li>
<strong>Tidy workflow</strong> with tibble outputs is preferred</li>
<li>
<strong>Reproducibility</strong> requires deterministic
algorithms</li>
</ol>
</div>
<div class="section level3">
<h3 id="choose-matchit-when">Choose MatchIt when:<a class="anchor" aria-label="anchor" href="#choose-matchit-when"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Propensity score matching</strong> is standard in your
field</li>
<li>Need <strong>full matching</strong> or <strong>CEM</strong>
(coarsened exact matching)</li>
<li>Following a <strong>published protocol</strong> that specifies
MatchIt</li>
<li>Need <strong>genetic matching</strong> for automatic weight
selection</li>
<li>
<strong>Integration</strong> with existing MatchIt workflows</li>
</ol>
</div>
<div class="section level3">
<h3 id="choose-optmatch-when">Choose optmatch when:<a class="anchor" aria-label="anchor" href="#choose-optmatch-when"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Full matching</strong> with variable ratios is needed</li>
<li>
<strong>Network flow</strong> formulation is preferred</li>
<li>Working with <strong>RItools</strong> for diagnostics</li>
<li>Need <strong>optimal pair matching</strong> with sparse distance
matrices</li>
</ol>
</div>
<div class="section level3">
<h3 id="choose-designmatch-when">Choose designmatch when:<a class="anchor" aria-label="anchor" href="#choose-designmatch-when"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Specific balance constraints</strong> must be
guaranteed</li>
<li>
<strong>Cardinality matching</strong> (exact sample sizes) is
needed</li>
<li>Fine-grained <strong>moment balancing</strong> is required</li>
<li>MIP solvers (Gurobi) are available for speed</li>
</ol>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="workflow-integration">Workflow Integration<a class="anchor" aria-label="anchor" href="#workflow-integration"></a>
</h2>
<div class="section level3">
<h3 id="sequential-pipeline">Sequential Pipeline<a class="anchor" aria-label="anchor" href="#sequential-pipeline"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stage 1: couplr for initial matching</span></span>
<span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">treatment_data</span>,</span>
<span>  right <span class="op">=</span> <span class="va">control_data</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stage 2: Check balance</span></span>
<span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">matched</span>, <span class="va">treatment_data</span>, <span class="va">control_data</span>, <span class="va">covariates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stage 3: If balance insufficient, consider alternatives</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">balance</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">max_abs_std_diff</span> <span class="op">&gt;</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Try MatchIt with propensity scores</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/" class="external-link">MatchIt</a></span><span class="op">)</span></span>
<span>  <span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">treatment_data</span>, <span class="va">control_data</span><span class="op">)</span></span>
<span>  <span class="va">m_ps</span> <span class="op">&lt;-</span> <span class="fu">matchit</span><span class="op">(</span><span class="va">treated</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">combined</span>, method <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Stage 4: Analysis on matched data</span></span>
<span><span class="va">matched_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/join_matched.html">join_matched</a></span><span class="op">(</span><span class="va">matched</span>, <span class="va">treatment_data</span>, <span class="va">control_data</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">matched_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="complementary-use">Complementary Use<a class="anchor" aria-label="anchor" href="#complementary-use"></a>
</h3>
<p>Different packages excel at different tasks:</p>
<p><code>{r, eval = FALSE } # Use couplr for: initial exploration, large-scale matching, distance caching # Use MatchIt for: propensity scores, full matching, published protocols # Use optmatch for: optimal full matching with sparse distances # Use designmatch for: guaranteed balance constraints</code></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="real-world-case-study-job-training-evaluation">Real-World Case Study: Job Training Evaluation<a class="anchor" aria-label="anchor" href="#real-world-case-study-job-training-evaluation"></a>
</h2>
<p>This section applies couplr to a dataset inspired by the classic
Lalonde (1986) job training evaluation, demonstrating the full workflow
on realistic data.</p>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>The National Supported Work (NSW) demonstration was a randomized job
training program. The methodological challenge is evaluating the program
using observational (non-randomized) comparison groups, which introduces
selection bias.</p>
<p><strong>Typical covariates</strong>: age, education, race, marital
status, prior earnings (re74, re75), employment status.</p>
</div>
<div class="section level3">
<h3 id="simulating-lalonde-style-data">Simulating Lalonde-Style Data<a class="anchor" aria-label="anchor" href="#simulating-lalonde-style-data"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># NSW treatment group (randomized) - smaller sample for CRAN</span></span>
<span><span class="va">nsw_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">25</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  black <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">0.84</span><span class="op">)</span>,</span>
<span>  hispanic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">0.06</span><span class="op">)</span>,</span>
<span>  married <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">0.19</span><span class="op">)</span>,</span>
<span>  nodegree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">0.71</span><span class="op">)</span>,</span>
<span>  re74 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">2100</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  re75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1500</span>, <span class="fl">3500</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"treatment"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CPS comparison group (observational - very different!)</span></span>
<span><span class="co"># Reduced from 15,815 to 500 for CRAN timing compliance</span></span>
<span><span class="va">cps_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">101</span><span class="op">:</span><span class="fl">600</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">33</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  black <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.07</span><span class="op">)</span>,</span>
<span>  hispanic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.07</span><span class="op">)</span>,</span>
<span>  married <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.71</span><span class="op">)</span>,</span>
<span>  nodegree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.30</span><span class="op">)</span>,</span>
<span>  re74 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">14000</span>, <span class="fl">9000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  re75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">13500</span>, <span class="fl">9000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"control"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"NSW treatment:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nsw_treat</span><span class="op">)</span>, <span class="st">"individuals\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NSW treatment: 100 individuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CPS control:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cps_control</span><span class="op">)</span>, <span class="st">"individuals\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; CPS control: 500 individuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"(Note: Real CPS has ~16,000 controls; reduced here for vignette timing)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Note: Real CPS has ~16,000 controls; reduced here for vignette timing)</span></span>
<span></span>
<span><span class="co"># Baseline imbalance is severe</span></span>
<span><span class="va">vars_lalonde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"black"</span>, <span class="st">"hispanic"</span>, <span class="st">"married"</span>,</span>
<span>                  <span class="st">"nodegree"</span>, <span class="st">"re74"</span>, <span class="st">"re75"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBaseline standardized differences:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Baseline standardized differences:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="va">vars_lalonde</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">t_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">nsw_treat</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">c_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cps_control</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">pooled_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">nsw_treat</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">cps_control</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">std_diff</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">t_mean</span> <span class="op">-</span> <span class="va">c_mean</span><span class="op">)</span> <span class="op">/</span> <span class="va">pooled_sd</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s: %.2f\n"</span>, <span class="va">v</span>, <span class="va">std_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   age: -0.87</span></span>
<span><span class="co">#&gt;   education: -0.78</span></span>
<span><span class="co">#&gt;   black: 2.27</span></span>
<span><span class="co">#&gt;   hispanic: -0.07</span></span>
<span><span class="co">#&gt;   married: -1.21</span></span>
<span><span class="co">#&gt;   nodegree: 0.75</span></span>
<span><span class="co">#&gt;   re74: -1.60</span></span>
<span><span class="co">#&gt;   re75: -1.83</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="challenge-large-control-pool">Challenge: Large Control Pool<a class="anchor" aria-label="anchor" href="#challenge-large-control-pool"></a>
</h3>
<p>With treatment vs control groups of different sizes, we need
efficient matching. couplr handles this with greedy matching:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Greedy matching (fast for large control pools)</span></span>
<span><span class="va">result_lalonde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span></span>
<span>  left <span class="op">=</span> <span class="va">nsw_treat</span>,</span>
<span>  right <span class="op">=</span> <span class="va">cps_control</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars_lalonde</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"pq"</span>,       <span class="co"># Priority queue - efficient for large pools</span></span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"robust"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="va">result_lalonde</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nsw_treat</span><span class="op">)</span>, <span class="st">"treatment units\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matched 100 of 100 treatment units</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_lalonde</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean distance: 1.5267</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="balance-assessment">Balance Assessment<a class="anchor" aria-label="anchor" href="#balance-assessment"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">balance_lalonde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span></span>
<span>  <span class="va">result_lalonde</span>, <span class="va">nsw_treat</span>, <span class="va">cps_control</span>, <span class="va">vars_lalonde</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span><span class="co">#&gt; Warning in ks.test.default(left_clean, right_clean): p-value will be</span></span>
<span><span class="co">#&gt; approximate in the presence of ties</span></span>
<span></span>
<span><span class="co"># Before/after comparison</span></span>
<span><span class="va">before_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  variable <span class="op">=</span> <span class="va">vars_lalonde</span>,</span>
<span>  std_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">vars_lalonde</span>, <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">t_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">nsw_treat</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">c_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cps_control</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">pooled_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">nsw_treat</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">cps_control</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">(</span><span class="va">t_mean</span> <span class="op">-</span> <span class="va">c_mean</span><span class="op">)</span> <span class="op">/</span> <span class="va">pooled_sd</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  stage <span class="op">=</span> <span class="st">"Before"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">after_df</span> <span class="op">&lt;-</span> <span class="va">balance_lalonde</span><span class="op">$</span><span class="va">var_stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">std_diff</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"After"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">balance_plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">before_df</span>, <span class="va">after_df</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before"</span>, <span class="st">"After"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">balance_plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">variable</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">std_diff</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             y <span class="op">=</span> <span class="va">std_diff</span>, fill <span class="op">=</span> <span class="va">stage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#93c54b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#f47c3c"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Covariate Balance: Before vs After Matching"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Lalonde-style job training evaluation"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">""</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Standardized Difference"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before"</span> <span class="op">=</span> <span class="st">"#d9534f"</span>, <span class="st">"After"</span> <span class="op">=</span> <span class="st">"#93c54b"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>

<div class="svg-container"><button type="button" class="btn btn-primary btn-copy-svg" title="Copy SVG to clipboard" aria-label="Copy SVG to clipboard" data-bs-toggle="tooltip" data-bs-placement="left"><i class="fa fa-copy"></i></button>
<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='648.00pt' height='360.00pt' viewBox='0 0 648.00 360.00' class="r-plt inline-svg" style="max-width:100%;width:100%;height:auto;">
<g class='svglite'>
<defs>
  <style type='text/css'><![CDATA[
    /* theme-aware-processed */
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite circle {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite > g > rect {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
      fill: #3E3F3A;
    }
    .svglite g.glyphgroup path {
      fill: inherit;
      stroke: none;
    }
  ]]></style>
</defs>
<rect width='100%' height='100%' style='stroke: none; fill: #F5F6F8;'/>
<defs>
  <clipPath id='cpMC4wMHw2NDguMDB8MC4wMHwzNjAuMDA='>
    <rect x='0.00' y='0.00' width='648.00' height='360.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMC4wMHw2NDguMDB8MC4wMHwzNjAuMDA=)'>
<rect rx='4' x='0.00' y='0.00' width='648.00' height='360.00' style='stroke-width: 1.07; stroke: none; fill: #F5F6F8;' />
</g>
<defs>
  <clipPath id='cpNjEuNDl8NjQyLjUyfDM4Ljg1fDI4OS4zMQ=='>
    <rect x='61.49' y='38.85' width='581.03' height='250.45' />
  </clipPath>
</defs>
<g clip-path='url(#cpNjEuNDl8NjQyLjUyfDM4Ljg1fDI4OS4zMQ==)'>
<polyline points='129.86,289.31 129.86,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='258.79,289.31 258.79,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='387.72,289.31 387.72,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='516.66,289.31 516.66,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,270.98 642.52,270.98 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,240.44 642.52,240.44 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,209.89 642.52,209.89 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,179.35 642.52,179.35 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,148.81 642.52,148.81 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,118.26 642.52,118.26 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,87.72 642.52,87.72 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='61.49,57.18 642.52,57.18 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='65.40,289.31 65.40,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='194.33,289.31 194.33,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='323.26,289.31 323.26,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='452.19,289.31 452.19,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='581.12,289.31 581.12,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<rect x='210.94' y='209.89' width='112.32' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='223.27' y='240.44' width='99.99' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='323.26' y='57.18' width='292.85' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='314.45' y='270.98' width='8.81' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='167.61' y='148.81' width='155.65' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='323.26' y='179.35' width='96.10' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='116.59' y='118.26' width='206.67' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='87.90' y='87.72' width='235.36' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='281.18' y='196.15' width='42.07' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='278.88' y='226.69' width='44.38' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='323.26' y='43.43' width='253.99' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='317.63' y='257.24' width='5.63' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='229.66' y='135.06' width='93.60' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='323.26' y='165.61' width='69.22' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='218.70' y='104.52' width='104.56' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<rect x='164.79' y='73.98' width='158.47' height='13.74' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<line x1='310.37' y1='289.31' x2='310.37' y2='38.85' style='stroke-width: 1.07; stroke: #93C54B; stroke-dasharray: 5.69,5.69; stroke-linecap: butt;' />
<line x1='336.15' y1='289.31' x2='336.15' y2='38.85' style='stroke-width: 1.07; stroke: #93C54B; stroke-dasharray: 5.69,5.69; stroke-linecap: butt;' />
<line x1='291.03' y1='289.31' x2='291.03' y2='38.85' style='stroke-width: 1.07; stroke: #F47C3C; stroke-dasharray: 5.69,5.69; stroke-linecap: butt;' />
<line x1='355.49' y1='289.31' x2='355.49' y2='38.85' style='stroke-width: 1.07; stroke: #F47C3C; stroke-dasharray: 5.69,5.69; stroke-linecap: butt;' />
</g>
<g clip-path='url(#cpMC4wMHw2NDguMDB8MC4wMHwzNjAuMDA=)'>
<text x='56.56' y='274.13' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='32.28px' lengthAdjust='spacingAndGlyphs'>hispanic</text>
<text x='56.56' y='243.59' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='38.14px' lengthAdjust='spacingAndGlyphs'>education</text>
<text x='56.56' y='213.04' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='14.67px' lengthAdjust='spacingAndGlyphs'>age</text>
<text x='56.56' y='182.50' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='37.16px' lengthAdjust='spacingAndGlyphs'>nodegree</text>
<text x='56.56' y='151.96' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='29.80px' lengthAdjust='spacingAndGlyphs'>married</text>
<text x='56.56' y='121.41' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='17.59px' lengthAdjust='spacingAndGlyphs'>re74</text>
<text x='56.56' y='90.87' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='17.59px' lengthAdjust='spacingAndGlyphs'>re75</text>
<text x='56.56' y='60.33' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='20.55px' lengthAdjust='spacingAndGlyphs'>black</text>
<text x='65.40' y='300.54' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='7.81px' lengthAdjust='spacingAndGlyphs'>-2</text>
<text x='194.33' y='300.54' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='7.81px' lengthAdjust='spacingAndGlyphs'>-1</text>
<text x='323.26' y='300.54' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='4.89px' lengthAdjust='spacingAndGlyphs'>0</text>
<text x='452.19' y='300.54' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='4.89px' lengthAdjust='spacingAndGlyphs'>1</text>
<text x='581.12' y='300.54' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='4.89px' lengthAdjust='spacingAndGlyphs'>2</text>
<text x='352.00' y='313.00' text-anchor='middle' style='font-size: 11.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='117.89px' lengthAdjust='spacingAndGlyphs'>Standardized Difference</text>
<rect x='307.72' y='332.47' width='15.86' height='15.86' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #D9534F;' />
<rect x='361.86' y='332.47' width='15.86' height='15.86' style='stroke-width: 1.07; stroke: none; stroke-linecap: butt; stroke-linejoin: miter; fill: #93C54B;' />
<text x='329.77' y='343.55' style='font-size: 8.80px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='25.91px' lengthAdjust='spacingAndGlyphs'>Before</text>
<text x='383.91' y='343.55' style='font-size: 8.80px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='18.56px' lengthAdjust='spacingAndGlyphs'>After</text>
<text x='61.49' y='31.05' style='font-size: 11.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='175.62px' lengthAdjust='spacingAndGlyphs'>Lalonde-style job training evaluation</text>
<text x='61.49' y='14.93' style='font-size: 13.20px; font-weight: bold; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='277.89px' lengthAdjust='spacingAndGlyphs'>Covariate Balance: Before vs After Matching</text>
</g>
</g>
</svg></div>

</div>
<div class="section level3">
<h3 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<p>The matching dramatically reduces imbalance:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Balance summary:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Balance summary:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mean |std diff| before:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">before_df</span><span class="op">$</span><span class="va">std_diff</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mean |std diff| before: 1.171</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mean |std diff| after:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">balance_lalonde</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">mean_abs_std_diff</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mean |std diff| after: 0.748</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Max |std diff| after:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">balance_lalonde</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">max_abs_std_diff</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Max |std diff| after: 1.97</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">balance_lalonde</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">max_abs_std_diff</span> <span class="op">&lt;</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n✓ All variables within acceptable balance threshold (0.25)\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n⚠ Some variables exceed 0.25 threshold - consider calipers or blocking\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ⚠ Some variables exceed 0.25 threshold - consider calipers or blocking</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Greedy matching</strong> handles 185:15,815 ratio
efficiently</li>
<li>
<strong>Robust scaling</strong> handles skewed earnings
distributions</li>
<li>
<strong>Balance diagnostics</strong> quantify improvement</li>
<li>
<strong>Large control pools</strong> actually help - more options
for good matches</li>
</ol>
<p>For comparison, optimal matching would require full distance matrix
computation (n × m entries), but greedy matching finds excellent matches
in milliseconds. With real CPS data (15,815 controls), this efficiency
becomes critical.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Ho, D. E., Imai, K., King, G., &amp; Stuart, E. A. (2011).
MatchIt: Nonparametric preprocessing for parametric causal inference.
<em>Journal of Statistical Software</em>, 42(8), 1-28. <a href="https://doi.org/10.18637/jss.v042.i08" class="external-link">doi:10.18637/jss.v042.i08</a></p></li>
<li><p>Hansen, B. B., &amp; Klopfer, S. O. (2006). Optimal full matching
and related designs via network flows. <em>Journal of Computational and
Graphical Statistics</em>, 15(3), 609-627. <a href="https://doi.org/10.1198/106186006X137047" class="external-link">doi:10.1198/106186006X137047</a></p></li>
<li><p>Zubizarreta, J. R., Kilcioglu, C., &amp; Vielma, J. P. (2018).
designmatch: Matched samples that are balanced and representative by
design. R package. <a href="https://CRAN.R-project.org/package=designmatch" class="external-link">CRAN</a></p></li>
<li><p>Sekhon, J. S. (2011). Multivariate and propensity score matching
software with automated balance optimization: The Matching package for
R. <em>Journal of Statistical Software</em>, 42(7), 1-52. <a href="https://doi.org/10.18637/jss.v042.i07" class="external-link">doi:10.18637/jss.v042.i07</a></p></li>
<li><p>LaLonde, R. J. (1986). Evaluating the econometric evaluations of
training programs with experimental data. <em>The American Economic
Review</em>, 76(4), 604-620.</p></li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code> - Basic couplr usage</li>
<li>
<code><a href="../articles/matching-workflows.html">vignette("matching-workflows")</a></code> - Production matching
pipelines</li>
<li>
<code><a href="../articles/algorithms.html">vignette("algorithms")</a></code> - LAP algorithm selection
guide</li>
<li>
<code><a href="../articles/troubleshooting.html">vignette("troubleshooting")</a></code> - Common issues and
solutions</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gcol33" class="external-link">Gilles Colling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  <script>
/* SVG Copy Button Functionality - Copy as PNG Image */
(function() {
  "use strict";

  // Convert SVG to PNG and copy to clipboard
  async function copySvgAsImage(svg, btn) {
    try {
      // Get SVG dimensions
      var svgRect = svg.getBoundingClientRect();
      var width = svgRect.width;
      var height = svgRect.height;

      // Use higher resolution for better quality (2x)
      var scale = 2;
      var canvas = document.createElement("canvas");
      canvas.width = width * scale;
      canvas.height = height * scale;
      var ctx = canvas.getContext("2d");
      ctx.scale(scale, scale);

      // Clone SVG and prepare for rendering
      var clone = svg.cloneNode(true);
      clone.classList.remove("inline-svg");

      // Get computed styles and inline them for proper rendering
      var svgStyles = window.getComputedStyle(svg);

      // Serialize SVG
      var serializer = new XMLSerializer();
      var svgString = serializer.serializeToString(clone);

      // Create a blob and URL for the SVG
      var svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
      var url = URL.createObjectURL(svgBlob);

      // Create image and draw to canvas
      var img = new Image();
      img.onload = async function() {
        // Fill white background (for transparency)
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, width, height);

        // Draw the SVG
        ctx.drawImage(img, 0, 0, width, height);
        URL.revokeObjectURL(url);

        // Convert canvas to blob and copy to clipboard
        canvas.toBlob(async function(blob) {
          try {
            var item = new ClipboardItem({ "image/png": blob });
            await navigator.clipboard.write([item]);

            // Show success tooltip
            showTooltip(btn, "Copied!");
          } catch (err) {
            console.error("Failed to copy image:", err);
            showTooltip(btn, "Copy failed - try right-click");
          }
        }, "image/png");
      };

      img.onerror = function() {
        URL.revokeObjectURL(url);
        console.error("Failed to load SVG as image");
        showTooltip(btn, "Copy failed");
      };

      img.src = url;

    } catch (err) {
      console.error("Error copying SVG:", err);
      showTooltip(btn, "Copy failed");
    }
  }

  // Show tooltip message
  function showTooltip(btn, message) {
    var originalTitle = btn.getAttribute("data-bs-original-title") || btn.getAttribute("title");
    btn.setAttribute("data-bs-original-title", message);
    var tooltip = bootstrap.Tooltip.getInstance(btn);
    if (tooltip) {
      tooltip.show();
    }
    setTimeout(function() {
      btn.setAttribute("data-bs-original-title", originalTitle);
    }, 1500);
  }

  // Initialize SVG copy buttons after DOM is ready
  document.addEventListener("DOMContentLoaded", function() {
    // Check for Clipboard API support
    if (!navigator.clipboard || !navigator.clipboard.write) {
      console.warn("Clipboard API not supported - SVG copy buttons disabled");
      return;
    }

    // Add click handlers to all SVG copy buttons
    document.querySelectorAll(".btn-copy-svg").forEach(function(btn) {
      btn.addEventListener("click", function(e) {
        e.preventDefault();
        var container = btn.closest(".svg-container");
        if (!container) return;

        var svg = container.querySelector("svg");
        if (!svg) return;

        copySvgAsImage(svg, btn);
      });

      // Initialize Bootstrap tooltip
      new bootstrap.Tooltip(btn, { container: "body" });
    });
  });
})();
</script>
</body>
</html>
