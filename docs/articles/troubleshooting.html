<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Troubleshooting Guide • couplr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Troubleshooting Guide">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">couplr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/algorithms.html">Algorithm Details</a></li>
    <li><a class="dropdown-item" href="../articles/matching-workflows.html">Matching Workflows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison with Alternatives</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/pixel-morphing.html">Pixel Morphing &amp; Scientific Applications</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/couplr" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Troubleshooting Guide</h1>
                        <h4 data-toc-skip class="author">Gilles
Colling</h4>
            
            <h4 data-toc-skip class="date">2026-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gcol33/couplr/blob/HEAD/vignettes/troubleshooting.Rmd" class="external-link"><code>vignettes/troubleshooting.Rmd</code></a></small>
      <div class="d-none name"><code>troubleshooting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette provides solutions to common issues encountered when
using couplr. Each section describes a problem, explains why it occurs,
and provides step-by-step solutions.</p>
<p><strong>Quick reference:</strong></p>
<table class="table">
<colgroup>
<col width="29%">
<col width="70%">
</colgroup>
<thead><tr class="header">
<th>Issue</th>
<th>Jump to Section</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>No valid pairs found</td>
<td><a href="#infeasible-problems">Infeasible Problems</a></td>
</tr>
<tr class="even">
<td>Poor balance after matching</td>
<td><a href="#poor-balance-despite-matching">Poor Balance</a></td>
</tr>
<tr class="odd">
<td>Matching is too slow</td>
<td><a href="#performance-issues">Performance Issues</a></td>
</tr>
<tr class="even">
<td>Memory errors</td>
<td><a href="#memory-errors">Memory Errors</a></td>
</tr>
<tr class="odd">
<td>Different results with different methods</td>
<td><a href="#different-results-with-different-methods">Non-Determinism</a></td>
</tr>
<tr class="even">
<td>Unexpected NA in results</td>
<td><a href="#missing-values-in-data">Missing Values</a></td>
</tr>
<tr class="odd">
<td>C++ compilation errors</td>
<td><a href="#installation-issues">Installation Issues</a></td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="infeasible-problems">Infeasible Problems<a class="anchor" aria-label="anchor" href="#infeasible-problems"></a>
</h2>
<div class="section level3">
<h3 id="symptom">Symptom<a class="anchor" aria-label="anchor" href="#symptom"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This fails: all assignments have Inf cost</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in lap_solve_bruteforce(work, maximize): Infeasible given forbidden edges</span></span></code></pre></div>
<p>Error message: “No feasible assignment found” or total cost is
Inf.</p>
</div>
<div class="section level3">
<h3 id="cause">Cause<a class="anchor" aria-label="anchor" href="#cause"></a>
</h3>
<p>A feasible assignment requires that every row can be assigned to at
least one column with finite cost. When rows have all-Inf or all-NA
entries, no valid assignment exists.</p>
</div>
<div class="section level3">
<h3 id="diagnosis">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for infeasible rows</span></span>
<span><span class="va">check_feasibility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">finite_per_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">infeasible_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">finite_per_row</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">infeasible_rows</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Infeasible rows (no finite costs):"</span>, <span class="va">infeasible_rows</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">finite_per_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">infeasible_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">finite_per_col</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">infeasible_cols</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Infeasible columns (no finite costs):"</span>, <span class="va">infeasible_cols</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Problem appears feasible\n"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check the problematic matrix</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">check_feasibility</span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; Infeasible rows (no finite costs): 2</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions">Solutions<a class="anchor" aria-label="anchor" href="#solutions"></a>
</h3>
<p><strong>1. Remove infeasible rows/columns:</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove rows with no valid assignments</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">valid_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span><span class="va">cost_valid</span> <span class="op">&lt;-</span> <span class="va">cost</span><span class="op">[</span><span class="va">valid_rows</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cost_valid</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_valid</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="st">"of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span>, <span class="st">"rows\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Matched 2 of 3 rows</span></span></code></pre></div>
<p><strong>2. Add fallback costs:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Replace Inf with high (but finite) penalty</span></span>
<span><span class="va">cost_with_fallback</span> <span class="op">&lt;-</span> <span class="va">cost</span></span>
<span><span class="va">cost_with_fallback</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">cost_with_fallback</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e6</span>  <span class="co"># Large penalty</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_with_fallback</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assignment Result</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   source target    cost</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1      1       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2      3 1<span style="text-decoration: underline;">000</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3      2       2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total cost: 1000003 </span></span>
<span><span class="co">#&gt; Method: bruteforce</span></span></code></pre></div>
<p><strong>3. For matching: check covariate overlap:</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate poor overlap scenario</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">25</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">55</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize overlap</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Left"</span><span class="op">)</span>,</span>
<span>  <span class="va">right</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Right"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Poor Covariate Overlap"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"No overlap means no good matches possible"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<div class="svg-container"><button type="button" class="btn btn-primary btn-copy-svg" title="Copy SVG to clipboard" aria-label="Copy SVG to clipboard" data-bs-toggle="tooltip" data-bs-placement="left"><i class="fa fa-copy"></i></button>
<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='504.00pt' height='288.00pt' viewBox='0 0 504.00 288.00' class="r-plt inline-svg" style="max-width:100%;width:100%;height:auto;">
<g class='svglite'>
<defs>
  <style type='text/css'><![CDATA[
    /* theme-aware-processed */
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite circle {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite > g > rect {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
      fill: #3E3F3A;
    }
    .svglite g.glyphgroup path {
      fill: inherit;
      stroke: none;
    }
  ]]></style>
</defs>
<rect width='100%' height='100%' style='stroke: none; fill: #F5F6F8;'/>
<defs>
  <clipPath id='cpMC4wMHw1MDQuMDB8MC4wMHwyODguMDA='>
    <rect x='0.00' y='0.00' width='504.00' height='288.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMC4wMHw1MDQuMDB8MC4wMHwyODguMDA=)'>
<rect x='0.00' y='0.00' width='504.00' height='288.00' style='stroke-width: 1.07; stroke: none;' /> fill: #F5F6F8;' />
</g>
<defs>
  <clipPath id='cpNDAuNDZ8NDMzLjMxfDM4Ljg1fDI1Ni41MA=='>
    <rect x='40.46' y='38.85' width='392.86' height='217.65' />
  </clipPath>
</defs>
<g clip-path='url(#cpNDAuNDZ8NDMzLjMxfDM4Ljg1fDI1Ni41MA==)'>
<rect x='40.46' y='38.85' width='392.86' height='217.65' style='stroke-width: 1.07; stroke: none;' /> fill: #F5F6F8;' />
<polyline points='40.46,214.49 433.31,214.49 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='40.46,150.26 433.31,150.26 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='40.46,86.03 433.31,86.03 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='107.94,256.50 107.94,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='192.04,256.50 192.04,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='276.15,256.50 276.15,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='360.26,256.50 360.26,38.85 ' style='stroke-width: 0.53; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='40.46,246.61 433.31,246.61 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='40.46,182.38 433.31,182.38 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='40.46,118.15 433.31,118.15 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='40.46,53.92 433.31,53.92 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='65.88,256.50 65.88,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='149.99,256.50 149.99,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='234.10,256.50 234.10,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='318.21,256.50 318.21,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polyline points='402.32,256.50 402.32,38.85 ' style='stroke-width: 1.07; stroke: #3E3F3A; stroke-linecap: butt;' />
<polygon points='58.31,224.73 59.01,223.43 59.71,222.09 60.41,220.68 61.11,219.22 61.81,217.70 62.51,216.12 63.20,214.48 63.90,212.75 64.60,210.94 65.30,209.05 66.00,207.08 66.70,205.03 67.40,202.89 68.10,200.65 68.80,198.33 69.49,195.92 70.19,193.43 70.89,190.87 71.59,188.22 72.29,185.48 72.99,182.68 73.69,179.82 74.39,176.89 75.09,173.91 75.79,170.86 76.48,167.76 77.18,164.61 77.88,161.41 78.58,158.17 79.28,154.88 79.98,151.54 80.68,148.16 81.38,144.73 82.08,141.27 82.77,137.77 83.47,134.24 84.17,130.67 84.87,127.09 85.57,123.50 86.27,119.92 86.97,116.34 87.67,112.79 88.37,109.30 89.06,105.87 89.76,102.52 90.46,99.27 91.16,96.15 91.86,93.21 92.56,90.43 93.26,87.85 93.96,85.46 94.66,83.29 95.35,81.40 96.05,79.78 96.75,78.41 97.45,77.31 98.15,76.46 98.85,75.88 99.55,75.62 100.25,75.60 100.95,75.82 101.64,76.25 102.34,76.89 103.04,77.73 103.74,78.74 104.44,79.90 105.14,81.16 105.84,82.50 106.54,83.92 107.24,85.39 107.93,86.87 108.63,88.35 109.33,89.82 110.03,91.25 110.73,92.64 111.43,93.96 112.13,95.22 112.83,96.41 113.53,97.54 114.23,98.61 114.92,99.62 115.62,100.57 116.32,101.48 117.02,102.37 117.72,103.24 118.42,104.10 119.12,104.99 119.82,105.91 120.52,106.87 121.21,107.90 121.91,108.99 122.61,110.18 123.31,111.48 124.01,112.90 124.71,114.42 125.41,116.07 126.11,117.84 126.81,119.75 127.50,121.79 128.20,123.96 128.90,126.23 129.60,128.62 130.30,131.10 131.00,133.68 131.70,136.34 132.40,139.06 133.10,141.82 133.79,144.62 134.49,147.44 135.19,150.27 135.89,153.08 136.59,155.88 137.29,158.64 137.99,161.37 138.69,164.03 139.39,166.63 140.08,169.16 140.78,171.63 141.48,174.02 142.18,176.34 142.88,178.56 143.58,180.70 144.28,182.78 144.98,184.78 145.68,186.72 146.37,188.59 147.07,190.39 147.77,192.14 148.47,193.84 149.17,195.51 149.87,197.14 150.57,198.73 151.27,200.29 151.97,201.83 152.67,203.36 153.36,204.87 154.06,206.36 154.76,207.85 155.46,209.32 156.16,210.79 156.86,212.25 157.56,213.70 158.26,215.14 158.96,216.57 159.65,217.99 160.35,219.39 161.05,220.78 161.75,222.15 162.45,223.50 163.15,224.82 163.85,226.11 164.55,227.38 165.25,228.62 165.94,229.82 166.64,230.98 167.34,232.10 168.04,233.18 168.74,234.22 169.44,235.22 170.14,236.17 170.84,237.06 171.54,237.91 172.23,238.72 172.93,239.47 173.63,240.18 174.33,240.84 175.03,241.44 175.73,242.01 176.43,242.52 177.13,243.00 177.83,243.44 178.52,243.83 179.22,244.18 179.92,244.50 180.62,244.78 181.32,245.04 182.02,245.26 182.72,245.46 183.42,245.63 184.12,245.78 184.81,245.91 185.51,246.03 186.21,246.12 186.91,246.21 187.61,246.28 188.31,246.34 189.01,246.39 189.71,246.43 190.41,246.46 191.11,246.49 191.80,246.51 192.50,246.53 193.20,246.55 193.90,246.56 194.60,246.57 195.30,246.58 196.00,246.59 196.70,246.59 197.40,246.60 198.09,246.60 198.79,246.60 199.49,246.60 200.19,246.61 200.89,246.61 201.59,246.61 202.29,246.61 202.99,246.61 203.69,246.61 204.38,246.61 205.08,246.61 205.78,246.61 206.48,246.61 207.18,246.61 207.88,246.61 208.58,246.61 209.28,246.61 209.98,246.61 210.67,246.61 211.37,246.61 212.07,246.61 212.77,246.61 213.47,246.61 214.17,246.61 214.87,246.61 215.57,246.61 216.27,246.61 216.96,246.61 217.66,246.61 218.36,246.61 219.06,246.61 219.76,246.61 220.46,246.61 221.16,246.61 221.86,246.61 222.56,246.61 223.25,246.61 223.95,246.61 224.65,246.61 225.35,246.61 226.05,246.61 226.75,246.61 227.45,246.61 228.15,246.61 228.85,246.61 229.55,246.61 230.24,246.61 230.94,246.61 231.64,246.61 232.34,246.61 233.04,246.61 233.74,246.61 234.44,246.61 235.14,246.61 235.84,246.61 236.53,246.61 237.23,246.61 237.93,246.61 238.63,246.61 239.33,246.61 240.03,246.61 240.73,246.61 241.43,246.61 242.13,246.61 242.82,246.61 243.52,246.61 244.22,246.61 244.92,246.61 245.62,246.61 246.32,246.61 247.02,246.61 247.72,246.61 248.42,246.61 249.11,246.61 249.81,246.61 250.51,246.61 251.21,246.61 251.91,246.61 252.61,246.61 253.31,246.61 254.01,246.61 254.71,246.61 255.40,246.61 256.10,246.61 256.80,246.61 257.50,246.61 258.20,246.61 258.90,246.61 259.60,246.61 260.30,246.61 261.00,246.61 261.69,246.61 262.39,246.61 263.09,246.61 263.79,246.61 264.49,246.61 265.19,246.61 265.89,246.61 266.59,246.61 267.29,246.61 267.99,246.61 268.68,246.61 269.38,246.61 270.08,246.61 270.78,246.61 271.48,246.61 272.18,246.61 272.88,246.61 273.58,246.61 274.28,246.61 274.97,246.61 275.67,246.61 276.37,246.61 277.07,246.61 277.77,246.61 278.47,246.61 279.17,246.61 279.87,246.61 280.57,246.61 281.26,246.61 281.96,246.61 282.66,246.61 283.36,246.61 284.06,246.61 284.76,246.61 285.46,246.61 286.16,246.61 286.86,246.61 287.55,246.61 288.25,246.61 288.95,246.61 289.65,246.61 290.35,246.61 291.05,246.61 291.75,246.61 292.45,246.61 293.15,246.61 293.84,246.61 294.54,246.61 295.24,246.61 295.94,246.61 296.64,246.61 297.34,246.61 298.04,246.61 298.74,246.61 299.44,246.61 300.13,246.61 300.83,246.61 301.53,246.61 302.23,246.61 302.93,246.61 303.63,246.61 304.33,246.61 305.03,246.61 305.73,246.61 306.43,246.61 307.12,246.61 307.82,246.61 308.52,246.61 309.22,246.61 309.92,246.61 310.62,246.61 311.32,246.61 312.02,246.61 312.72,246.61 313.41,246.61 314.11,246.61 314.81,246.61 315.51,246.61 316.21,246.61 316.91,246.61 317.61,246.61 318.31,246.61 319.01,246.61 319.70,246.61 320.40,246.61 321.10,246.61 321.80,246.61 322.50,246.61 323.20,246.61 323.90,246.61 324.60,246.61 325.30,246.61 325.99,246.61 326.69,246.61 327.39,246.61 328.09,246.61 328.79,246.61 329.49,246.61 330.19,246.61 330.89,246.61 331.59,246.61 332.28,246.61 332.98,246.61 333.68,246.61 334.38,246.61 335.08,246.61 335.78,246.61 336.48,246.61 337.18,246.61 337.88,246.61 338.57,246.61 339.27,246.61 339.97,246.61 340.67,246.61 341.37,246.61 342.07,246.61 342.77,246.61 343.47,246.61 344.17,246.61 344.87,246.61 345.56,246.61 346.26,246.61 346.96,246.61 347.66,246.61 348.36,246.61 349.06,246.61 349.76,246.61 350.46,246.61 351.16,246.61 351.85,246.61 352.55,246.61 353.25,246.61 353.95,246.61 354.65,246.61 355.35,246.61 356.05,246.61 356.75,246.61 357.45,246.61 358.14,246.61 358.84,246.61 359.54,246.61 360.24,246.61 360.94,246.61 361.64,246.61 362.34,246.61 363.04,246.61 363.74,246.61 364.43,246.61 365.13,246.61 365.83,246.61 366.53,246.61 367.23,246.61 367.93,246.61 368.63,246.61 369.33,246.61 370.03,246.61 370.72,246.61 371.42,246.61 372.12,246.61 372.82,246.61 373.52,246.61 374.22,246.61 374.92,246.61 375.62,246.61 376.32,246.61 377.01,246.61 377.71,246.61 378.41,246.61 379.11,246.61 379.81,246.61 380.51,246.61 381.21,246.61 381.91,246.61 382.61,246.61 383.31,246.61 384.00,246.61 384.70,246.61 385.40,246.61 386.10,246.61 386.80,246.61 387.50,246.61 388.20,246.61 388.90,246.61 389.60,246.61 390.29,246.61 390.99,246.61 391.69,246.61 392.39,246.61 393.09,246.61 393.79,246.61 394.49,246.61 395.19,246.61 395.89,246.61 396.58,246.61 397.28,246.61 397.98,246.61 398.68,246.61 399.38,246.61 400.08,246.61 400.78,246.61 401.48,246.61 402.18,246.61 402.87,246.61 403.57,246.61 404.27,246.61 404.97,246.61 405.67,246.61 406.37,246.61 407.07,246.61 407.77,246.61 408.47,246.61 409.16,246.61 409.86,246.61 410.56,246.61 411.26,246.61 411.96,246.61 412.66,246.61 413.36,246.61 414.06,246.61 414.76,246.61 415.45,246.61 415.45,246.61 414.76,246.61 414.06,246.61 413.36,246.61 412.66,246.61 411.96,246.61 411.26,246.61 410.56,246.61 409.86,246.61 409.16,246.61 408.47,246.61 407.77,246.61 407.07,246.61 406.37,246.61 405.67,246.61 404.97,246.61 404.27,246.61 403.57,246.61 402.87,246.61 402.18,246.61 401.48,246.61 400.78,246.61 400.08,246.61 399.38,246.61 398.68,246.61 397.98,246.61 397.28,246.61 396.58,246.61 395.89,246.61 395.19,246.61 394.49,246.61 393.79,246.61 393.09,246.61 392.39,246.61 391.69,246.61 390.99,246.61 390.29,246.61 389.60,246.61 388.90,246.61 388.20,246.61 387.50,246.61 386.80,246.61 386.10,246.61 385.40,246.61 384.70,246.61 384.00,246.61 383.31,246.61 382.61,246.61 381.91,246.61 381.21,246.61 380.51,246.61 379.81,246.61 379.11,246.61 378.41,246.61 377.71,246.61 377.01,246.61 376.32,246.61 375.62,246.61 374.92,246.61 374.22,246.61 373.52,246.61 372.82,246.61 372.12,246.61 371.42,246.61 370.72,246.61 370.03,246.61 369.33,246.61 368.63,246.61 367.93,246.61 367.23,246.61 366.53,246.61 365.83,246.61 365.13,246.61 364.43,246.61 363.74,246.61 363.04,246.61 362.34,246.61 361.64,246.61 360.94,246.61 360.24,246.61 359.54,246.61 358.84,246.61 358.14,246.61 357.45,246.61 356.75,246.61 356.05,246.61 355.35,246.61 354.65,246.61 353.95,246.61 353.25,246.61 352.55,246.61 351.85,246.61 351.16,246.61 350.46,246.61 349.76,246.61 349.06,246.61 348.36,246.61 347.66,246.61 346.96,246.61 346.26,246.61 345.56,246.61 344.87,246.61 344.17,246.61 343.47,246.61 342.77,246.61 342.07,246.61 341.37,246.61 340.67,246.61 339.97,246.61 339.27,246.61 338.57,246.61 337.88,246.61 337.18,246.61 336.48,246.61 335.78,246.61 335.08,246.61 334.38,246.61 333.68,246.61 332.98,246.61 332.28,246.61 331.59,246.61 330.89,246.61 330.19,246.61 329.49,246.61 328.79,246.61 328.09,246.61 327.39,246.61 326.69,246.61 325.99,246.61 325.30,246.61 324.60,246.61 323.90,246.61 323.20,246.61 322.50,246.61 321.80,246.61 321.10,246.61 320.40,246.61 319.70,246.61 319.01,246.61 318.31,246.61 317.61,246.61 316.91,246.61 316.21,246.61 315.51,246.61 314.81,246.61 314.11,246.61 313.41,246.61 312.72,246.61 312.02,246.61 311.32,246.61 310.62,246.61 309.92,246.61 309.22,246.61 308.52,246.61 307.82,246.61 307.12,246.61 306.43,246.61 305.73,246.61 305.03,246.61 304.33,246.61 303.63,246.61 302.93,246.61 302.23,246.61 301.53,246.61 300.83,246.61 300.13,246.61 299.44,246.61 298.74,246.61 298.04,246.61 297.34,246.61 296.64,246.61 295.94,246.61 295.24,246.61 294.54,246.61 293.84,246.61 293.15,246.61 292.45,246.61 291.75,246.61 291.05,246.61 290.35,246.61 289.65,246.61 288.95,246.61 288.25,246.61 287.55,246.61 286.86,246.61 286.16,246.61 285.46,246.61 284.76,246.61 284.06,246.61 283.36,246.61 282.66,246.61 281.96,246.61 281.26,246.61 280.57,246.61 279.87,246.61 279.17,246.61 278.47,246.61 277.77,246.61 277.07,246.61 276.37,246.61 275.67,246.61 274.97,246.61 274.28,246.61 273.58,246.61 272.88,246.61 272.18,246.61 271.48,246.61 270.78,246.61 270.08,246.61 269.38,246.61 268.68,246.61 267.99,246.61 267.29,246.61 266.59,246.61 265.89,246.61 265.19,246.61 264.49,246.61 263.79,246.61 263.09,246.61 262.39,246.61 261.69,246.61 261.00,246.61 260.30,246.61 259.60,246.61 258.90,246.61 258.20,246.61 257.50,246.61 256.80,246.61 256.10,246.61 255.40,246.61 254.71,246.61 254.01,246.61 253.31,246.61 252.61,246.61 251.91,246.61 251.21,246.61 250.51,246.61 249.81,246.61 249.11,246.61 248.42,246.61 247.72,246.61 247.02,246.61 246.32,246.61 245.62,246.61 244.92,246.61 244.22,246.61 243.52,246.61 242.82,246.61 242.13,246.61 241.43,246.61 240.73,246.61 240.03,246.61 239.33,246.61 238.63,246.61 237.93,246.61 237.23,246.61 236.53,246.61 235.84,246.61 235.14,246.61 234.44,246.61 233.74,246.61 233.04,246.61 232.34,246.61 231.64,246.61 230.94,246.61 230.24,246.61 229.55,246.61 228.85,246.61 228.15,246.61 227.45,246.61 226.75,246.61 226.05,246.61 225.35,246.61 224.65,246.61 223.95,246.61 223.25,246.61 222.56,246.61 221.86,246.61 221.16,246.61 220.46,246.61 219.76,246.61 219.06,246.61 218.36,246.61 217.66,246.61 216.96,246.61 216.27,246.61 215.57,246.61 214.87,246.61 214.17,246.61 213.47,246.61 212.77,246.61 212.07,246.61 211.37,246.61 210.67,246.61 209.98,246.61 209.28,246.61 208.58,246.61 207.88,246.61 207.18,246.61 206.48,246.61 205.78,246.61 205.08,246.61 204.38,246.61 203.69,246.61 202.99,246.61 202.29,246.61 201.59,246.61 200.89,246.61 200.19,246.61 199.49,246.61 198.79,246.61 198.09,246.61 197.40,246.61 196.70,246.61 196.00,246.61 195.30,246.61 194.60,246.61 193.90,246.61 193.20,246.61 192.50,246.61 191.80,246.61 191.11,246.61 190.41,246.61 189.71,246.61 189.01,246.61 188.31,246.61 187.61,246.61 186.91,246.61 186.21,246.61 185.51,246.61 184.81,246.61 184.12,246.61 183.42,246.61 182.72,246.61 182.02,246.61 181.32,246.61 180.62,246.61 179.92,246.61 179.22,246.61 178.52,246.61 177.83,246.61 177.13,246.61 176.43,246.61 175.73,246.61 175.03,246.61 174.33,246.61 173.63,246.61 172.93,246.61 172.23,246.61 171.54,246.61 170.84,246.61 170.14,246.61 169.44,246.61 168.74,246.61 168.04,246.61 167.34,246.61 166.64,246.61 165.94,246.61 165.25,246.61 164.55,246.61 163.85,246.61 163.15,246.61 162.45,246.61 161.75,246.61 161.05,246.61 160.35,246.61 159.65,246.61 158.96,246.61 158.26,246.61 157.56,246.61 156.86,246.61 156.16,246.61 155.46,246.61 154.76,246.61 154.06,246.61 153.36,246.61 152.67,246.61 151.97,246.61 151.27,246.61 150.57,246.61 149.87,246.61 149.17,246.61 148.47,246.61 147.77,246.61 147.07,246.61 146.37,246.61 145.68,246.61 144.98,246.61 144.28,246.61 143.58,246.61 142.88,246.61 142.18,246.61 141.48,246.61 140.78,246.61 140.08,246.61 139.39,246.61 138.69,246.61 137.99,246.61 137.29,246.61 136.59,246.61 135.89,246.61 135.19,246.61 134.49,246.61 133.79,246.61 133.10,246.61 132.40,246.61 131.70,246.61 131.00,246.61 130.30,246.61 129.60,246.61 128.90,246.61 128.20,246.61 127.50,246.61 126.81,246.61 126.11,246.61 125.41,246.61 124.71,246.61 124.01,246.61 123.31,246.61 122.61,246.61 121.91,246.61 121.21,246.61 120.52,246.61 119.82,246.61 119.12,246.61 118.42,246.61 117.72,246.61 117.02,246.61 116.32,246.61 115.62,246.61 114.92,246.61 114.23,246.61 113.53,246.61 112.83,246.61 112.13,246.61 111.43,246.61 110.73,246.61 110.03,246.61 109.33,246.61 108.63,246.61 107.93,246.61 107.24,246.61 106.54,246.61 105.84,246.61 105.14,246.61 104.44,246.61 103.74,246.61 103.04,246.61 102.34,246.61 101.64,246.61 100.95,246.61 100.25,246.61 99.55,246.61 98.85,246.61 98.15,246.61 97.45,246.61 96.75,246.61 96.05,246.61 95.35,246.61 94.66,246.61 93.96,246.61 93.26,246.61 92.56,246.61 91.86,246.61 91.16,246.61 90.46,246.61 89.76,246.61 89.06,246.61 88.37,246.61 87.67,246.61 86.97,246.61 86.27,246.61 85.57,246.61 84.87,246.61 84.17,246.61 83.47,246.61 82.77,246.61 82.08,246.61 81.38,246.61 80.68,246.61 79.98,246.61 79.28,246.61 78.58,246.61 77.88,246.61 77.18,246.61 76.48,246.61 75.79,246.61 75.09,246.61 74.39,246.61 73.69,246.61 72.99,246.61 72.29,246.61 71.59,246.61 70.89,246.61 70.19,246.61 69.49,246.61 68.80,246.61 68.10,246.61 67.40,246.61 66.70,246.61 66.00,246.61 65.30,246.61 64.60,246.61 63.90,246.61 63.20,246.61 62.51,246.61 61.81,246.61 61.11,246.61 60.41,246.61 59.71,246.61 59.01,246.61 58.31,246.61 ' style='stroke-width: 0.00; stroke: none; stroke-linecap: butt; fill: #F8766D; fill-opacity: 0.50;' />
<polyline points='58.31,224.73 59.01,223.43 59.71,222.09 60.41,220.68 61.11,219.22 61.81,217.70 62.51,216.12 63.20,214.48 63.90,212.75 64.60,210.94 65.30,209.05 66.00,207.08 66.70,205.03 67.40,202.89 68.10,200.65 68.80,198.33 69.49,195.92 70.19,193.43 70.89,190.87 71.59,188.22 72.29,185.48 72.99,182.68 73.69,179.82 74.39,176.89 75.09,173.91 75.79,170.86 76.48,167.76 77.18,164.61 77.88,161.41 78.58,158.17 79.28,154.88 79.98,151.54 80.68,148.16 81.38,144.73 82.08,141.27 82.77,137.77 83.47,134.24 84.17,130.67 84.87,127.09 85.57,123.50 86.27,119.92 86.97,116.34 87.67,112.79 88.37,109.30 89.06,105.87 89.76,102.52 90.46,99.27 91.16,96.15 91.86,93.21 92.56,90.43 93.26,87.85 93.96,85.46 94.66,83.29 95.35,81.40 96.05,79.78 96.75,78.41 97.45,77.31 98.15,76.46 98.85,75.88 99.55,75.62 100.25,75.60 100.95,75.82 101.64,76.25 102.34,76.89 103.04,77.73 103.74,78.74 104.44,79.90 105.14,81.16 105.84,82.50 106.54,83.92 107.24,85.39 107.93,86.87 108.63,88.35 109.33,89.82 110.03,91.25 110.73,92.64 111.43,93.96 112.13,95.22 112.83,96.41 113.53,97.54 114.23,98.61 114.92,99.62 115.62,100.57 116.32,101.48 117.02,102.37 117.72,103.24 118.42,104.10 119.12,104.99 119.82,105.91 120.52,106.87 121.21,107.90 121.91,108.99 122.61,110.18 123.31,111.48 124.01,112.90 124.71,114.42 125.41,116.07 126.11,117.84 126.81,119.75 127.50,121.79 128.20,123.96 128.90,126.23 129.60,128.62 130.30,131.10 131.00,133.68 131.70,136.34 132.40,139.06 133.10,141.82 133.79,144.62 134.49,147.44 135.19,150.27 135.89,153.08 136.59,155.88 137.29,158.64 137.99,161.37 138.69,164.03 139.39,166.63 140.08,169.16 140.78,171.63 141.48,174.02 142.18,176.34 142.88,178.56 143.58,180.70 144.28,182.78 144.98,184.78 145.68,186.72 146.37,188.59 147.07,190.39 147.77,192.14 148.47,193.84 149.17,195.51 149.87,197.14 150.57,198.73 151.27,200.29 151.97,201.83 152.67,203.36 153.36,204.87 154.06,206.36 154.76,207.85 155.46,209.32 156.16,210.79 156.86,212.25 157.56,213.70 158.26,215.14 158.96,216.57 159.65,217.99 160.35,219.39 161.05,220.78 161.75,222.15 162.45,223.50 163.15,224.82 163.85,226.11 164.55,227.38 165.25,228.62 165.94,229.82 166.64,230.98 167.34,232.10 168.04,233.18 168.74,234.22 169.44,235.22 170.14,236.17 170.84,237.06 171.54,237.91 172.23,238.72 172.93,239.47 173.63,240.18 174.33,240.84 175.03,241.44 175.73,242.01 176.43,242.52 177.13,243.00 177.83,243.44 178.52,243.83 179.22,244.18 179.92,244.50 180.62,244.78 181.32,245.04 182.02,245.26 182.72,245.46 183.42,245.63 184.12,245.78 184.81,245.91 185.51,246.03 186.21,246.12 186.91,246.21 187.61,246.28 188.31,246.34 189.01,246.39 189.71,246.43 190.41,246.46 191.11,246.49 191.80,246.51 192.50,246.53 193.20,246.55 193.90,246.56 194.60,246.57 195.30,246.58 196.00,246.59 196.70,246.59 197.40,246.60 198.09,246.60 198.79,246.60 199.49,246.60 200.19,246.61 200.89,246.61 201.59,246.61 202.29,246.61 202.99,246.61 203.69,246.61 204.38,246.61 205.08,246.61 205.78,246.61 206.48,246.61 207.18,246.61 207.88,246.61 208.58,246.61 209.28,246.61 209.98,246.61 210.67,246.61 211.37,246.61 212.07,246.61 212.77,246.61 213.47,246.61 214.17,246.61 214.87,246.61 215.57,246.61 216.27,246.61 216.96,246.61 217.66,246.61 218.36,246.61 219.06,246.61 219.76,246.61 220.46,246.61 221.16,246.61 221.86,246.61 222.56,246.61 223.25,246.61 223.95,246.61 224.65,246.61 225.35,246.61 226.05,246.61 226.75,246.61 227.45,246.61 228.15,246.61 228.85,246.61 229.55,246.61 230.24,246.61 230.94,246.61 231.64,246.61 232.34,246.61 233.04,246.61 233.74,246.61 234.44,246.61 235.14,246.61 235.84,246.61 236.53,246.61 237.23,246.61 237.93,246.61 238.63,246.61 239.33,246.61 240.03,246.61 240.73,246.61 241.43,246.61 242.13,246.61 242.82,246.61 243.52,246.61 244.22,246.61 244.92,246.61 245.62,246.61 246.32,246.61 247.02,246.61 247.72,246.61 248.42,246.61 249.11,246.61 249.81,246.61 250.51,246.61 251.21,246.61 251.91,246.61 252.61,246.61 253.31,246.61 254.01,246.61 254.71,246.61 255.40,246.61 256.10,246.61 256.80,246.61 257.50,246.61 258.20,246.61 258.90,246.61 259.60,246.61 260.30,246.61 261.00,246.61 261.69,246.61 262.39,246.61 263.09,246.61 263.79,246.61 264.49,246.61 265.19,246.61 265.89,246.61 266.59,246.61 267.29,246.61 267.99,246.61 268.68,246.61 269.38,246.61 270.08,246.61 270.78,246.61 271.48,246.61 272.18,246.61 272.88,246.61 273.58,246.61 274.28,246.61 274.97,246.61 275.67,246.61 276.37,246.61 277.07,246.61 277.77,246.61 278.47,246.61 279.17,246.61 279.87,246.61 280.57,246.61 281.26,246.61 281.96,246.61 282.66,246.61 283.36,246.61 284.06,246.61 284.76,246.61 285.46,246.61 286.16,246.61 286.86,246.61 287.55,246.61 288.25,246.61 288.95,246.61 289.65,246.61 290.35,246.61 291.05,246.61 291.75,246.61 292.45,246.61 293.15,246.61 293.84,246.61 294.54,246.61 295.24,246.61 295.94,246.61 296.64,246.61 297.34,246.61 298.04,246.61 298.74,246.61 299.44,246.61 300.13,246.61 300.83,246.61 301.53,246.61 302.23,246.61 302.93,246.61 303.63,246.61 304.33,246.61 305.03,246.61 305.73,246.61 306.43,246.61 307.12,246.61 307.82,246.61 308.52,246.61 309.22,246.61 309.92,246.61 310.62,246.61 311.32,246.61 312.02,246.61 312.72,246.61 313.41,246.61 314.11,246.61 314.81,246.61 315.51,246.61 316.21,246.61 316.91,246.61 317.61,246.61 318.31,246.61 319.01,246.61 319.70,246.61 320.40,246.61 321.10,246.61 321.80,246.61 322.50,246.61 323.20,246.61 323.90,246.61 324.60,246.61 325.30,246.61 325.99,246.61 326.69,246.61 327.39,246.61 328.09,246.61 328.79,246.61 329.49,246.61 330.19,246.61 330.89,246.61 331.59,246.61 332.28,246.61 332.98,246.61 333.68,246.61 334.38,246.61 335.08,246.61 335.78,246.61 336.48,246.61 337.18,246.61 337.88,246.61 338.57,246.61 339.27,246.61 339.97,246.61 340.67,246.61 341.37,246.61 342.07,246.61 342.77,246.61 343.47,246.61 344.17,246.61 344.87,246.61 345.56,246.61 346.26,246.61 346.96,246.61 347.66,246.61 348.36,246.61 349.06,246.61 349.76,246.61 350.46,246.61 351.16,246.61 351.85,246.61 352.55,246.61 353.25,246.61 353.95,246.61 354.65,246.61 355.35,246.61 356.05,246.61 356.75,246.61 357.45,246.61 358.14,246.61 358.84,246.61 359.54,246.61 360.24,246.61 360.94,246.61 361.64,246.61 362.34,246.61 363.04,246.61 363.74,246.61 364.43,246.61 365.13,246.61 365.83,246.61 366.53,246.61 367.23,246.61 367.93,246.61 368.63,246.61 369.33,246.61 370.03,246.61 370.72,246.61 371.42,246.61 372.12,246.61 372.82,246.61 373.52,246.61 374.22,246.61 374.92,246.61 375.62,246.61 376.32,246.61 377.01,246.61 377.71,246.61 378.41,246.61 379.11,246.61 379.81,246.61 380.51,246.61 381.21,246.61 381.91,246.61 382.61,246.61 383.31,246.61 384.00,246.61 384.70,246.61 385.40,246.61 386.10,246.61 386.80,246.61 387.50,246.61 388.20,246.61 388.90,246.61 389.60,246.61 390.29,246.61 390.99,246.61 391.69,246.61 392.39,246.61 393.09,246.61 393.79,246.61 394.49,246.61 395.19,246.61 395.89,246.61 396.58,246.61 397.28,246.61 397.98,246.61 398.68,246.61 399.38,246.61 400.08,246.61 400.78,246.61 401.48,246.61 402.18,246.61 402.87,246.61 403.57,246.61 404.27,246.61 404.97,246.61 405.67,246.61 406.37,246.61 407.07,246.61 407.77,246.61 408.47,246.61 409.16,246.61 409.86,246.61 410.56,246.61 411.26,246.61 411.96,246.61 412.66,246.61 413.36,246.61 414.06,246.61 414.76,246.61 415.45,246.61 ' style='stroke-width: 1.07; stroke-linecap: butt;' />
<polygon points='58.31,246.61 59.01,246.61 59.71,246.61 60.41,246.61 61.11,246.61 61.81,246.61 62.51,246.61 63.20,246.61 63.90,246.61 64.60,246.61 65.30,246.61 66.00,246.61 66.70,246.61 67.40,246.61 68.10,246.61 68.80,246.61 69.49,246.61 70.19,246.61 70.89,246.61 71.59,246.61 72.29,246.61 72.99,246.61 73.69,246.61 74.39,246.61 75.09,246.61 75.79,246.61 76.48,246.61 77.18,246.61 77.88,246.61 78.58,246.61 79.28,246.61 79.98,246.61 80.68,246.61 81.38,246.61 82.08,246.61 82.77,246.61 83.47,246.61 84.17,246.61 84.87,246.61 85.57,246.61 86.27,246.61 86.97,246.61 87.67,246.61 88.37,246.61 89.06,246.61 89.76,246.61 90.46,246.61 91.16,246.61 91.86,246.61 92.56,246.61 93.26,246.61 93.96,246.61 94.66,246.61 95.35,246.61 96.05,246.61 96.75,246.61 97.45,246.61 98.15,246.61 98.85,246.61 99.55,246.61 100.25,246.61 100.95,246.61 101.64,246.61 102.34,246.61 103.04,246.61 103.74,246.61 104.44,246.61 105.14,246.61 105.84,246.61 106.54,246.61 107.24,246.61 107.93,246.61 108.63,246.61 109.33,246.61 110.03,246.61 110.73,246.61 111.43,246.61 112.13,246.61 112.83,246.61 113.53,246.61 114.23,246.61 114.92,246.61 115.62,246.61 116.32,246.61 117.02,246.61 117.72,246.61 118.42,246.61 119.12,246.61 119.82,246.61 120.52,246.61 121.21,246.61 121.91,246.61 122.61,246.61 123.31,246.61 124.01,246.61 124.71,246.61 125.41,246.61 126.11,246.61 126.81,246.61 127.50,246.61 128.20,246.61 128.90,246.61 129.60,246.61 130.30,246.61 131.00,246.61 131.70,246.61 132.40,246.61 133.10,246.61 133.79,246.61 134.49,246.61 135.19,246.61 135.89,246.61 136.59,246.61 137.29,246.61 137.99,246.61 138.69,246.61 139.39,246.61 140.08,246.61 140.78,246.61 141.48,246.61 142.18,246.61 142.88,246.61 143.58,246.61 144.28,246.61 144.98,246.61 145.68,246.61 146.37,246.61 147.07,246.61 147.77,246.61 148.47,246.61 149.17,246.61 149.87,246.61 150.57,246.61 151.27,246.61 151.97,246.61 152.67,246.61 153.36,246.61 154.06,246.61 154.76,246.61 155.46,246.61 156.16,246.61 156.86,246.61 157.56,246.61 158.26,246.61 158.96,246.61 159.65,246.61 160.35,246.61 161.05,246.61 161.75,246.61 162.45,246.61 163.15,246.61 163.85,246.61 164.55,246.61 165.25,246.61 165.94,246.61 166.64,246.61 167.34,246.61 168.04,246.61 168.74,246.61 169.44,246.61 170.14,246.61 170.84,246.61 171.54,246.61 172.23,246.61 172.93,246.61 173.63,246.61 174.33,246.61 175.03,246.61 175.73,246.61 176.43,246.61 177.13,246.61 177.83,246.61 178.52,246.61 179.22,246.61 179.92,246.61 180.62,246.61 181.32,246.61 182.02,246.61 182.72,246.61 183.42,246.61 184.12,246.61 184.81,246.61 185.51,246.61 186.21,246.61 186.91,246.61 187.61,246.61 188.31,246.61 189.01,246.61 189.71,246.61 190.41,246.61 191.11,246.61 191.80,246.61 192.50,246.61 193.20,246.61 193.90,246.61 194.60,246.61 195.30,246.61 196.00,246.61 196.70,246.61 197.40,246.61 198.09,246.61 198.79,246.61 199.49,246.61 200.19,246.61 200.89,246.61 201.59,246.61 202.29,246.61 202.99,246.61 203.69,246.61 204.38,246.61 205.08,246.61 205.78,246.61 206.48,246.61 207.18,246.61 207.88,246.61 208.58,246.61 209.28,246.61 209.98,246.61 210.67,246.61 211.37,246.61 212.07,246.61 212.77,246.61 213.47,246.61 214.17,246.61 214.87,246.61 215.57,246.61 216.27,246.61 216.96,246.61 217.66,246.61 218.36,246.61 219.06,246.61 219.76,246.61 220.46,246.61 221.16,246.61 221.86,246.61 222.56,246.61 223.25,246.61 223.95,246.61 224.65,246.61 225.35,246.61 226.05,246.61 226.75,246.61 227.45,246.61 228.15,246.61 228.85,246.61 229.55,246.61 230.24,246.61 230.94,246.61 231.64,246.61 232.34,246.61 233.04,246.61 233.74,246.61 234.44,246.61 235.14,246.61 235.84,246.61 236.53,246.61 237.23,246.61 237.93,246.61 238.63,246.61 239.33,246.61 240.03,246.61 240.73,246.61 241.43,246.61 242.13,246.61 242.82,246.61 243.52,246.61 244.22,246.61 244.92,246.61 245.62,246.61 246.32,246.61 247.02,246.61 247.72,246.61 248.42,246.61 249.11,246.61 249.81,246.61 250.51,246.61 251.21,246.61 251.91,246.61 252.61,246.61 253.31,246.61 254.01,246.61 254.71,246.61 255.40,246.61 256.10,246.61 256.80,246.61 257.50,246.61 258.20,246.61 258.90,246.61 259.60,246.61 260.30,246.61 261.00,246.61 261.69,246.61 262.39,246.61 263.09,246.61 263.79,246.61 264.49,246.61 265.19,246.61 265.89,246.61 266.59,246.61 267.29,246.61 267.99,246.61 268.68,246.61 269.38,246.61 270.08,246.61 270.78,246.61 271.48,246.61 272.18,246.60 272.88,246.60 273.58,246.60 274.28,246.59 274.97,246.59 275.67,246.58 276.37,246.57 277.07,246.55 277.77,246.53 278.47,246.51 279.17,246.47 279.87,246.43 280.57,246.38 281.26,246.31 281.96,246.23 282.66,246.14 283.36,246.02 284.06,245.88 284.76,245.71 285.46,245.50 286.16,245.27 286.86,245.00 287.55,244.69 288.25,244.34 288.95,243.95 289.65,243.52 290.35,243.05 291.05,242.54 291.75,241.99 292.45,241.41 293.15,240.82 293.84,240.20 294.54,239.57 295.24,238.95 295.94,238.33 296.64,237.74 297.34,237.18 298.04,236.66 298.74,236.19 299.44,235.78 300.13,235.44 300.83,235.17 301.53,234.97 302.23,234.83 302.93,234.76 303.63,234.75 304.33,234.81 305.03,234.90 305.73,235.01 306.43,235.15 307.12,235.28 307.82,235.39 308.52,235.48 309.22,235.51 309.92,235.47 310.62,235.36 311.32,235.16 312.02,234.86 312.72,234.46 313.41,233.93 314.11,233.27 314.81,232.48 315.51,231.57 316.21,230.53 316.91,229.37 317.61,228.08 318.31,226.66 319.01,225.10 319.70,223.43 320.40,221.65 321.10,219.76 321.80,217.76 322.50,215.67 323.20,213.46 323.90,211.17 324.60,208.79 325.30,206.34 325.99,203.82 326.69,201.24 327.39,198.61 328.09,195.93 328.79,193.20 329.49,190.44 330.19,187.64 330.89,184.81 331.59,181.95 332.28,179.05 332.98,176.09 333.68,173.08 334.38,170.01 335.08,166.87 335.78,163.64 336.48,160.31 337.18,156.87 337.88,153.30 338.57,149.60 339.27,145.77 339.97,141.81 340.67,137.73 341.37,133.54 342.07,129.22 342.77,124.82 343.47,120.35 344.17,115.85 344.87,111.33 345.56,106.82 346.26,102.35 346.96,97.96 347.66,93.68 348.36,89.54 349.06,85.55 349.76,81.73 350.46,78.10 351.16,74.67 351.85,71.49 352.55,68.54 353.25,65.81 353.95,63.29 354.65,60.98 355.35,58.87 356.05,56.98 356.75,55.30 357.45,53.81 358.14,52.50 358.84,51.37 359.54,50.42 360.24,49.66 360.94,49.11 361.64,48.81 362.34,48.75 363.04,48.93 363.74,49.40 364.43,50.16 365.13,51.24 365.83,52.69 366.53,54.53 367.23,56.73 367.93,59.29 368.63,62.21 369.33,65.46 370.03,69.04 370.72,72.93 371.42,77.08 372.12,81.41 372.82,85.88 373.52,90.43 374.22,95.00 374.92,99.54 375.62,103.97 376.32,108.23 377.01,112.29 377.71,116.12 378.41,119.68 379.11,122.95 379.81,125.92 380.51,128.53 381.21,130.86 381.91,132.93 382.61,134.76 383.31,136.39 384.00,137.84 384.70,139.16 385.40,140.38 386.10,141.57 386.80,142.77 387.50,144.01 388.20,145.32 388.90,146.72 389.60,148.27 390.29,149.97 390.99,151.83 391.69,153.85 392.39,156.03 393.09,158.38 393.79,160.87 394.49,163.53 395.19,166.32 395.89,169.21 396.58,172.19 397.28,175.23 397.98,178.30 398.68,181.39 399.38,184.46 400.08,187.49 400.78,190.43 401.48,193.29 402.18,196.02 402.87,198.62 403.57,201.07 404.27,203.32 404.97,205.40 405.67,207.30 406.37,209.02 407.07,210.58 407.77,211.98 408.47,213.24 409.16,214.35 409.86,215.36 410.56,216.30 411.26,217.19 411.96,218.04 412.66,218.88 413.36,219.73 414.06,220.62 414.76,221.54 415.45,222.51 415.45,246.61 414.76,246.61 414.06,246.61 413.36,246.61 412.66,246.61 411.96,246.61 411.26,246.61 410.56,246.61 409.86,246.61 409.16,246.61 408.47,246.61 407.77,246.61 407.07,246.61 406.37,246.61 405.67,246.61 404.97,246.61 404.27,246.61 403.57,246.61 402.87,246.61 402.18,246.61 401.48,246.61 400.78,246.61 400.08,246.61 399.38,246.61 398.68,246.61 397.98,246.61 397.28,246.61 396.58,246.61 395.89,246.61 395.19,246.61 394.49,246.61 393.79,246.61 393.09,246.61 392.39,246.61 391.69,246.61 390.99,246.61 390.29,246.61 389.60,246.61 388.90,246.61 388.20,246.61 387.50,246.61 386.80,246.61 386.10,246.61 385.40,246.61 384.70,246.61 384.00,246.61 383.31,246.61 382.61,246.61 381.91,246.61 381.21,246.61 380.51,246.61 379.81,246.61 379.11,246.61 378.41,246.61 377.71,246.61 377.01,246.61 376.32,246.61 375.62,246.61 374.92,246.61 374.22,246.61 373.52,246.61 372.82,246.61 372.12,246.61 371.42,246.61 370.72,246.61 370.03,246.61 369.33,246.61 368.63,246.61 367.93,246.61 367.23,246.61 366.53,246.61 365.83,246.61 365.13,246.61 364.43,246.61 363.74,246.61 363.04,246.61 362.34,246.61 361.64,246.61 360.94,246.61 360.24,246.61 359.54,246.61 358.84,246.61 358.14,246.61 357.45,246.61 356.75,246.61 356.05,246.61 355.35,246.61 354.65,246.61 353.95,246.61 353.25,246.61 352.55,246.61 351.85,246.61 351.16,246.61 350.46,246.61 349.76,246.61 349.06,246.61 348.36,246.61 347.66,246.61 346.96,246.61 346.26,246.61 345.56,246.61 344.87,246.61 344.17,246.61 343.47,246.61 342.77,246.61 342.07,246.61 341.37,246.61 340.67,246.61 339.97,246.61 339.27,246.61 338.57,246.61 337.88,246.61 337.18,246.61 336.48,246.61 335.78,246.61 335.08,246.61 334.38,246.61 333.68,246.61 332.98,246.61 332.28,246.61 331.59,246.61 330.89,246.61 330.19,246.61 329.49,246.61 328.79,246.61 328.09,246.61 327.39,246.61 326.69,246.61 325.99,246.61 325.30,246.61 324.60,246.61 323.90,246.61 323.20,246.61 322.50,246.61 321.80,246.61 321.10,246.61 320.40,246.61 319.70,246.61 319.01,246.61 318.31,246.61 317.61,246.61 316.91,246.61 316.21,246.61 315.51,246.61 314.81,246.61 314.11,246.61 313.41,246.61 312.72,246.61 312.02,246.61 311.32,246.61 310.62,246.61 309.92,246.61 309.22,246.61 308.52,246.61 307.82,246.61 307.12,246.61 306.43,246.61 305.73,246.61 305.03,246.61 304.33,246.61 303.63,246.61 302.93,246.61 302.23,246.61 301.53,246.61 300.83,246.61 300.13,246.61 299.44,246.61 298.74,246.61 298.04,246.61 297.34,246.61 296.64,246.61 295.94,246.61 295.24,246.61 294.54,246.61 293.84,246.61 293.15,246.61 292.45,246.61 291.75,246.61 291.05,246.61 290.35,246.61 289.65,246.61 288.95,246.61 288.25,246.61 287.55,246.61 286.86,246.61 286.16,246.61 285.46,246.61 284.76,246.61 284.06,246.61 283.36,246.61 282.66,246.61 281.96,246.61 281.26,246.61 280.57,246.61 279.87,246.61 279.17,246.61 278.47,246.61 277.77,246.61 277.07,246.61 276.37,246.61 275.67,246.61 274.97,246.61 274.28,246.61 273.58,246.61 272.88,246.61 272.18,246.61 271.48,246.61 270.78,246.61 270.08,246.61 269.38,246.61 268.68,246.61 267.99,246.61 267.29,246.61 266.59,246.61 265.89,246.61 265.19,246.61 264.49,246.61 263.79,246.61 263.09,246.61 262.39,246.61 261.69,246.61 261.00,246.61 260.30,246.61 259.60,246.61 258.90,246.61 258.20,246.61 257.50,246.61 256.80,246.61 256.10,246.61 255.40,246.61 254.71,246.61 254.01,246.61 253.31,246.61 252.61,246.61 251.91,246.61 251.21,246.61 250.51,246.61 249.81,246.61 249.11,246.61 248.42,246.61 247.72,246.61 247.02,246.61 246.32,246.61 245.62,246.61 244.92,246.61 244.22,246.61 243.52,246.61 242.82,246.61 242.13,246.61 241.43,246.61 240.73,246.61 240.03,246.61 239.33,246.61 238.63,246.61 237.93,246.61 237.23,246.61 236.53,246.61 235.84,246.61 235.14,246.61 234.44,246.61 233.74,246.61 233.04,246.61 232.34,246.61 231.64,246.61 230.94,246.61 230.24,246.61 229.55,246.61 228.85,246.61 228.15,246.61 227.45,246.61 226.75,246.61 226.05,246.61 225.35,246.61 224.65,246.61 223.95,246.61 223.25,246.61 222.56,246.61 221.86,246.61 221.16,246.61 220.46,246.61 219.76,246.61 219.06,246.61 218.36,246.61 217.66,246.61 216.96,246.61 216.27,246.61 215.57,246.61 214.87,246.61 214.17,246.61 213.47,246.61 212.77,246.61 212.07,246.61 211.37,246.61 210.67,246.61 209.98,246.61 209.28,246.61 208.58,246.61 207.88,246.61 207.18,246.61 206.48,246.61 205.78,246.61 205.08,246.61 204.38,246.61 203.69,246.61 202.99,246.61 202.29,246.61 201.59,246.61 200.89,246.61 200.19,246.61 199.49,246.61 198.79,246.61 198.09,246.61 197.40,246.61 196.70,246.61 196.00,246.61 195.30,246.61 194.60,246.61 193.90,246.61 193.20,246.61 192.50,246.61 191.80,246.61 191.11,246.61 190.41,246.61 189.71,246.61 189.01,246.61 188.31,246.61 187.61,246.61 186.91,246.61 186.21,246.61 185.51,246.61 184.81,246.61 184.12,246.61 183.42,246.61 182.72,246.61 182.02,246.61 181.32,246.61 180.62,246.61 179.92,246.61 179.22,246.61 178.52,246.61 177.83,246.61 177.13,246.61 176.43,246.61 175.73,246.61 175.03,246.61 174.33,246.61 173.63,246.61 172.93,246.61 172.23,246.61 171.54,246.61 170.84,246.61 170.14,246.61 169.44,246.61 168.74,246.61 168.04,246.61 167.34,246.61 166.64,246.61 165.94,246.61 165.25,246.61 164.55,246.61 163.85,246.61 163.15,246.61 162.45,246.61 161.75,246.61 161.05,246.61 160.35,246.61 159.65,246.61 158.96,246.61 158.26,246.61 157.56,246.61 156.86,246.61 156.16,246.61 155.46,246.61 154.76,246.61 154.06,246.61 153.36,246.61 152.67,246.61 151.97,246.61 151.27,246.61 150.57,246.61 149.87,246.61 149.17,246.61 148.47,246.61 147.77,246.61 147.07,246.61 146.37,246.61 145.68,246.61 144.98,246.61 144.28,246.61 143.58,246.61 142.88,246.61 142.18,246.61 141.48,246.61 140.78,246.61 140.08,246.61 139.39,246.61 138.69,246.61 137.99,246.61 137.29,246.61 136.59,246.61 135.89,246.61 135.19,246.61 134.49,246.61 133.79,246.61 133.10,246.61 132.40,246.61 131.70,246.61 131.00,246.61 130.30,246.61 129.60,246.61 128.90,246.61 128.20,246.61 127.50,246.61 126.81,246.61 126.11,246.61 125.41,246.61 124.71,246.61 124.01,246.61 123.31,246.61 122.61,246.61 121.91,246.61 121.21,246.61 120.52,246.61 119.82,246.61 119.12,246.61 118.42,246.61 117.72,246.61 117.02,246.61 116.32,246.61 115.62,246.61 114.92,246.61 114.23,246.61 113.53,246.61 112.83,246.61 112.13,246.61 111.43,246.61 110.73,246.61 110.03,246.61 109.33,246.61 108.63,246.61 107.93,246.61 107.24,246.61 106.54,246.61 105.84,246.61 105.14,246.61 104.44,246.61 103.74,246.61 103.04,246.61 102.34,246.61 101.64,246.61 100.95,246.61 100.25,246.61 99.55,246.61 98.85,246.61 98.15,246.61 97.45,246.61 96.75,246.61 96.05,246.61 95.35,246.61 94.66,246.61 93.96,246.61 93.26,246.61 92.56,246.61 91.86,246.61 91.16,246.61 90.46,246.61 89.76,246.61 89.06,246.61 88.37,246.61 87.67,246.61 86.97,246.61 86.27,246.61 85.57,246.61 84.87,246.61 84.17,246.61 83.47,246.61 82.77,246.61 82.08,246.61 81.38,246.61 80.68,246.61 79.98,246.61 79.28,246.61 78.58,246.61 77.88,246.61 77.18,246.61 76.48,246.61 75.79,246.61 75.09,246.61 74.39,246.61 73.69,246.61 72.99,246.61 72.29,246.61 71.59,246.61 70.89,246.61 70.19,246.61 69.49,246.61 68.80,246.61 68.10,246.61 67.40,246.61 66.70,246.61 66.00,246.61 65.30,246.61 64.60,246.61 63.90,246.61 63.20,246.61 62.51,246.61 61.81,246.61 61.11,246.61 60.41,246.61 59.71,246.61 59.01,246.61 58.31,246.61 ' style='stroke-width: 0.00; stroke: none; stroke-linecap: butt; fill: #00BFC4; fill-opacity: 0.50;' />
<polyline points='58.31,246.61 59.01,246.61 59.71,246.61 60.41,246.61 61.11,246.61 61.81,246.61 62.51,246.61 63.20,246.61 63.90,246.61 64.60,246.61 65.30,246.61 66.00,246.61 66.70,246.61 67.40,246.61 68.10,246.61 68.80,246.61 69.49,246.61 70.19,246.61 70.89,246.61 71.59,246.61 72.29,246.61 72.99,246.61 73.69,246.61 74.39,246.61 75.09,246.61 75.79,246.61 76.48,246.61 77.18,246.61 77.88,246.61 78.58,246.61 79.28,246.61 79.98,246.61 80.68,246.61 81.38,246.61 82.08,246.61 82.77,246.61 83.47,246.61 84.17,246.61 84.87,246.61 85.57,246.61 86.27,246.61 86.97,246.61 87.67,246.61 88.37,246.61 89.06,246.61 89.76,246.61 90.46,246.61 91.16,246.61 91.86,246.61 92.56,246.61 93.26,246.61 93.96,246.61 94.66,246.61 95.35,246.61 96.05,246.61 96.75,246.61 97.45,246.61 98.15,246.61 98.85,246.61 99.55,246.61 100.25,246.61 100.95,246.61 101.64,246.61 102.34,246.61 103.04,246.61 103.74,246.61 104.44,246.61 105.14,246.61 105.84,246.61 106.54,246.61 107.24,246.61 107.93,246.61 108.63,246.61 109.33,246.61 110.03,246.61 110.73,246.61 111.43,246.61 112.13,246.61 112.83,246.61 113.53,246.61 114.23,246.61 114.92,246.61 115.62,246.61 116.32,246.61 117.02,246.61 117.72,246.61 118.42,246.61 119.12,246.61 119.82,246.61 120.52,246.61 121.21,246.61 121.91,246.61 122.61,246.61 123.31,246.61 124.01,246.61 124.71,246.61 125.41,246.61 126.11,246.61 126.81,246.61 127.50,246.61 128.20,246.61 128.90,246.61 129.60,246.61 130.30,246.61 131.00,246.61 131.70,246.61 132.40,246.61 133.10,246.61 133.79,246.61 134.49,246.61 135.19,246.61 135.89,246.61 136.59,246.61 137.29,246.61 137.99,246.61 138.69,246.61 139.39,246.61 140.08,246.61 140.78,246.61 141.48,246.61 142.18,246.61 142.88,246.61 143.58,246.61 144.28,246.61 144.98,246.61 145.68,246.61 146.37,246.61 147.07,246.61 147.77,246.61 148.47,246.61 149.17,246.61 149.87,246.61 150.57,246.61 151.27,246.61 151.97,246.61 152.67,246.61 153.36,246.61 154.06,246.61 154.76,246.61 155.46,246.61 156.16,246.61 156.86,246.61 157.56,246.61 158.26,246.61 158.96,246.61 159.65,246.61 160.35,246.61 161.05,246.61 161.75,246.61 162.45,246.61 163.15,246.61 163.85,246.61 164.55,246.61 165.25,246.61 165.94,246.61 166.64,246.61 167.34,246.61 168.04,246.61 168.74,246.61 169.44,246.61 170.14,246.61 170.84,246.61 171.54,246.61 172.23,246.61 172.93,246.61 173.63,246.61 174.33,246.61 175.03,246.61 175.73,246.61 176.43,246.61 177.13,246.61 177.83,246.61 178.52,246.61 179.22,246.61 179.92,246.61 180.62,246.61 181.32,246.61 182.02,246.61 182.72,246.61 183.42,246.61 184.12,246.61 184.81,246.61 185.51,246.61 186.21,246.61 186.91,246.61 187.61,246.61 188.31,246.61 189.01,246.61 189.71,246.61 190.41,246.61 191.11,246.61 191.80,246.61 192.50,246.61 193.20,246.61 193.90,246.61 194.60,246.61 195.30,246.61 196.00,246.61 196.70,246.61 197.40,246.61 198.09,246.61 198.79,246.61 199.49,246.61 200.19,246.61 200.89,246.61 201.59,246.61 202.29,246.61 202.99,246.61 203.69,246.61 204.38,246.61 205.08,246.61 205.78,246.61 206.48,246.61 207.18,246.61 207.88,246.61 208.58,246.61 209.28,246.61 209.98,246.61 210.67,246.61 211.37,246.61 212.07,246.61 212.77,246.61 213.47,246.61 214.17,246.61 214.87,246.61 215.57,246.61 216.27,246.61 216.96,246.61 217.66,246.61 218.36,246.61 219.06,246.61 219.76,246.61 220.46,246.61 221.16,246.61 221.86,246.61 222.56,246.61 223.25,246.61 223.95,246.61 224.65,246.61 225.35,246.61 226.05,246.61 226.75,246.61 227.45,246.61 228.15,246.61 228.85,246.61 229.55,246.61 230.24,246.61 230.94,246.61 231.64,246.61 232.34,246.61 233.04,246.61 233.74,246.61 234.44,246.61 235.14,246.61 235.84,246.61 236.53,246.61 237.23,246.61 237.93,246.61 238.63,246.61 239.33,246.61 240.03,246.61 240.73,246.61 241.43,246.61 242.13,246.61 242.82,246.61 243.52,246.61 244.22,246.61 244.92,246.61 245.62,246.61 246.32,246.61 247.02,246.61 247.72,246.61 248.42,246.61 249.11,246.61 249.81,246.61 250.51,246.61 251.21,246.61 251.91,246.61 252.61,246.61 253.31,246.61 254.01,246.61 254.71,246.61 255.40,246.61 256.10,246.61 256.80,246.61 257.50,246.61 258.20,246.61 258.90,246.61 259.60,246.61 260.30,246.61 261.00,246.61 261.69,246.61 262.39,246.61 263.09,246.61 263.79,246.61 264.49,246.61 265.19,246.61 265.89,246.61 266.59,246.61 267.29,246.61 267.99,246.61 268.68,246.61 269.38,246.61 270.08,246.61 270.78,246.61 271.48,246.61 272.18,246.60 272.88,246.60 273.58,246.60 274.28,246.59 274.97,246.59 275.67,246.58 276.37,246.57 277.07,246.55 277.77,246.53 278.47,246.51 279.17,246.47 279.87,246.43 280.57,246.38 281.26,246.31 281.96,246.23 282.66,246.14 283.36,246.02 284.06,245.88 284.76,245.71 285.46,245.50 286.16,245.27 286.86,245.00 287.55,244.69 288.25,244.34 288.95,243.95 289.65,243.52 290.35,243.05 291.05,242.54 291.75,241.99 292.45,241.41 293.15,240.82 293.84,240.20 294.54,239.57 295.24,238.95 295.94,238.33 296.64,237.74 297.34,237.18 298.04,236.66 298.74,236.19 299.44,235.78 300.13,235.44 300.83,235.17 301.53,234.97 302.23,234.83 302.93,234.76 303.63,234.75 304.33,234.81 305.03,234.90 305.73,235.01 306.43,235.15 307.12,235.28 307.82,235.39 308.52,235.48 309.22,235.51 309.92,235.47 310.62,235.36 311.32,235.16 312.02,234.86 312.72,234.46 313.41,233.93 314.11,233.27 314.81,232.48 315.51,231.57 316.21,230.53 316.91,229.37 317.61,228.08 318.31,226.66 319.01,225.10 319.70,223.43 320.40,221.65 321.10,219.76 321.80,217.76 322.50,215.67 323.20,213.46 323.90,211.17 324.60,208.79 325.30,206.34 325.99,203.82 326.69,201.24 327.39,198.61 328.09,195.93 328.79,193.20 329.49,190.44 330.19,187.64 330.89,184.81 331.59,181.95 332.28,179.05 332.98,176.09 333.68,173.08 334.38,170.01 335.08,166.87 335.78,163.64 336.48,160.31 337.18,156.87 337.88,153.30 338.57,149.60 339.27,145.77 339.97,141.81 340.67,137.73 341.37,133.54 342.07,129.22 342.77,124.82 343.47,120.35 344.17,115.85 344.87,111.33 345.56,106.82 346.26,102.35 346.96,97.96 347.66,93.68 348.36,89.54 349.06,85.55 349.76,81.73 350.46,78.10 351.16,74.67 351.85,71.49 352.55,68.54 353.25,65.81 353.95,63.29 354.65,60.98 355.35,58.87 356.05,56.98 356.75,55.30 357.45,53.81 358.14,52.50 358.84,51.37 359.54,50.42 360.24,49.66 360.94,49.11 361.64,48.81 362.34,48.75 363.04,48.93 363.74,49.40 364.43,50.16 365.13,51.24 365.83,52.69 366.53,54.53 367.23,56.73 367.93,59.29 368.63,62.21 369.33,65.46 370.03,69.04 370.72,72.93 371.42,77.08 372.12,81.41 372.82,85.88 373.52,90.43 374.22,95.00 374.92,99.54 375.62,103.97 376.32,108.23 377.01,112.29 377.71,116.12 378.41,119.68 379.11,122.95 379.81,125.92 380.51,128.53 381.21,130.86 381.91,132.93 382.61,134.76 383.31,136.39 384.00,137.84 384.70,139.16 385.40,140.38 386.10,141.57 386.80,142.77 387.50,144.01 388.20,145.32 388.90,146.72 389.60,148.27 390.29,149.97 390.99,151.83 391.69,153.85 392.39,156.03 393.09,158.38 393.79,160.87 394.49,163.53 395.19,166.32 395.89,169.21 396.58,172.19 397.28,175.23 397.98,178.30 398.68,181.39 399.38,184.46 400.08,187.49 400.78,190.43 401.48,193.29 402.18,196.02 402.87,198.62 403.57,201.07 404.27,203.32 404.97,205.40 405.67,207.30 406.37,209.02 407.07,210.58 407.77,211.98 408.47,213.24 409.16,214.35 409.86,215.36 410.56,216.30 411.26,217.19 411.96,218.04 412.66,218.88 413.36,219.73 414.06,220.62 414.76,221.54 415.45,222.51 ' style='stroke-width: 1.07; stroke-linecap: butt;' />
</g>
<g clip-path='url(#cpMC4wMHw1MDQuMDB8MC4wMHwyODguMDA=)'>
<text x='35.52' y='249.76' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='17.11px' lengthAdjust='spacingAndGlyphs'>0.00</text>
<text x='35.52' y='185.53' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='17.11px' lengthAdjust='spacingAndGlyphs'>0.05</text>
<text x='35.52' y='121.30' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='17.11px' lengthAdjust='spacingAndGlyphs'>0.10</text>
<text x='35.52' y='57.07' text-anchor='end' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='17.11px' lengthAdjust='spacingAndGlyphs'>0.15</text>
<text x='65.88' y='267.74' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='9.78px' lengthAdjust='spacingAndGlyphs'>20</text>
<text x='149.99' y='267.74' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='9.78px' lengthAdjust='spacingAndGlyphs'>30</text>
<text x='234.10' y='267.74' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='9.78px' lengthAdjust='spacingAndGlyphs'>40</text>
<text x='318.21' y='267.74' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='9.78px' lengthAdjust='spacingAndGlyphs'>50</text>
<text x='402.32' y='267.74' text-anchor='middle' style='font-size: 8.80px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='9.78px' lengthAdjust='spacingAndGlyphs'>60</text>
<text x='236.88' y='280.20' text-anchor='middle' style='font-size: 11.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='18.38px' lengthAdjust='spacingAndGlyphs'>age</text>
<text transform='translate(13.36,147.68) rotate(-90)' text-anchor='middle' style='font-size: 11.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='34.88px' lengthAdjust='spacingAndGlyphs'>density</text>
<text x='449.75' y='131.60' style='font-size: 11.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='28.16px' lengthAdjust='spacingAndGlyphs'>group</text>
<rect x='450.46' y='138.94' width='15.86' height='15.86' style='stroke-width: 1.07; stroke-linecap: butt; fill: #F8766D; fill-opacity: 0.50;' />
<rect x='450.46' y='156.22' width='15.86' height='15.86' style='stroke-width: 1.07; stroke-linecap: butt; fill: #00BFC4; fill-opacity: 0.50;' />
<text x='472.51' y='150.03' style='font-size: 8.80px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='14.66px' lengthAdjust='spacingAndGlyphs'>Left</text>
<text x='472.51' y='167.31' style='font-size: 8.80px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='20.53px' lengthAdjust='spacingAndGlyphs'>Right</text>
<text x='40.46' y='31.05' style='font-size: 11.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='220.28px' lengthAdjust='spacingAndGlyphs'>No overlap means no good matches possible</text>
<text x='40.46' y='14.93' style='font-size: 13.20px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='137.73px' lengthAdjust='spacingAndGlyphs'>Poor Covariate Overlap</text>
</g>
</g>
</svg></div>

<hr>
</div>
</div>
<div class="section level2">
<h2 id="poor-balance-despite-matching">Poor Balance Despite Matching<a class="anchor" aria-label="anchor" href="#poor-balance-despite-matching"></a>
</h2>
<div class="section level3">
<h3 id="symptom-1">Symptom<a class="anchor" aria-label="anchor" href="#symptom-1"></a>
</h3>
<p>After matching, <code><a href="../reference/balance_diagnostics.html">balance_diagnostics()</a></code> shows |std_diff|
&gt; 0.25 for some variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example of poor balance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80000</span>, <span class="fl">20000</span><span class="op">)</span>  <span class="co"># Very different from right</span></span>
<span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">32</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">40000</span>, <span class="fl">10000</span><span class="op">)</span>  <span class="co"># Very different income</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>, auto_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">balance</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance Diagnostics for Matched Pairs</span></span>
<span><span class="co">#&gt; ======================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matching Summary:</span></span>
<span><span class="co">#&gt;   Method: lap</span></span>
<span><span class="co">#&gt;   Matched pairs: 100</span></span>
<span><span class="co">#&gt;   Unmatched left: 0 (of 100)</span></span>
<span><span class="co">#&gt;   Unmatched right: 0 (of 100)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable-level Balance:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   Variable `Mean Left` `Mean Right` `Mean Diff` `Std Diff` `Var Ratio` `KS Stat`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> age             30.6         32.5       -<span style="color: #BB0000;">1.89</span>     -<span style="color: #BB0000;">0.386</span>        1.05      0.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> income       <span style="text-decoration: underline;">77</span>666.       <span style="text-decoration: underline;">41</span>353.     <span style="text-decoration: underline;">36</span>313.        2.40         2.15      0.81</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Balance:</span></span>
<span><span class="co">#&gt;   Mean |Std Diff|: 1.391 (Poor)</span></span>
<span><span class="co">#&gt;   Max |Std Diff|: 2.397</span></span>
<span><span class="co">#&gt;   Vars with |Std Diff| &gt; 0.25: 100.0%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance Interpretation:</span></span>
<span><span class="co">#&gt;   |Std Diff| &lt; 0.10: Excellent balance</span></span>
<span><span class="co">#&gt;   |Std Diff| 0.10-0.25: Good balance</span></span>
<span><span class="co">#&gt;   |Std Diff| 0.25-0.50: Acceptable balance</span></span>
<span><span class="co">#&gt;   |Std Diff| &gt; 0.50: Poor balance</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="causes">Causes<a class="anchor" aria-label="anchor" href="#causes"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Weak overlap</strong>: Groups are too different on key
variables</li>
<li>
<strong>Missing confounders</strong>: Important variables not
included in matching</li>
<li>
<strong>Caliper too loose</strong>: Accepting poor matches</li>
<li>
<strong>Wrong scaling</strong>: Variables not properly weighted</li>
</ol>
</div>
<div class="section level3">
<h3 id="solutions-1">Solutions<a class="anchor" aria-label="anchor" href="#solutions-1"></a>
</h3>
<p><strong>1. Add more matching variables:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Include additional relevant variables</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"region"</span><span class="op">)</span>,  <span class="co"># More variables</span></span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Tighten caliper (fewer but better matches):</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.3</span>,  <span class="co"># Stricter caliper</span></span>
<span>  auto_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto-selected scaling method: standardize</span></span>
<span><span class="co">#&gt; Error in lap_solve_auction_scaled(work, maximize): Auction(scaled): iteration guard at eps=7885383213142811494408480082840444688844086424042268422604802684204020084804602286084062426808668246202024044680060000888826240426666820268808860060886662888880668826624624282408686624866884640486622460688806226620844868208208262004280626244240268286668462608648088464686088602226464888282882.000000, phase=19</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Original matches:"</span>, <span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Original matches: 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"With caliper:"</span>, <span class="va">result_strict</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'result_strict' not found</span></span>
<span></span>
<span><span class="va">balance_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">result_strict</span>, <span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'result_strict' not found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">balance_strict</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'balance_strict' not found</span></span></code></pre></div>
<p><strong>3. Use blocking on problematic variable:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Block on income tertiles to ensure exact balance</span></span>
<span><span class="va">left</span><span class="op">$</span><span class="va">income_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">left</span><span class="op">$</span><span class="va">income</span>, breaks <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"mid"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span><span class="op">$</span><span class="va">income_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">right</span><span class="op">$</span><span class="va">income</span>, breaks <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"mid"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, block_type <span class="op">=</span> <span class="st">"group"</span>, block_by <span class="op">=</span> <span class="st">"income_cat"</span><span class="op">)</span></span>
<span><span class="va">result_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>,  <span class="co"># Match on age within income blocks</span></span>
<span>  block_id <span class="op">=</span> <span class="st">"block_id"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Try different scaling:</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare scaling methods</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">scale_method</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"robust"</span>, <span class="st">"standardize"</span>, <span class="st">"range"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>                       auto_scale <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="va">scale_method</span><span class="op">)</span></span>
<span>  <span class="va">bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_diagnostics.html">balance_diagnostics</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">scale_method</span>, <span class="st">"- max |std_diff|:"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">bal</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">max_abs_std_diff</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; robust - max |std_diff|: 2.397 </span></span>
<span><span class="co">#&gt; standardize - max |std_diff|: 2.397 </span></span>
<span><span class="co">#&gt; range - max |std_diff|: 2.397</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="performance-issues">Performance Issues<a class="anchor" aria-label="anchor" href="#performance-issues"></a>
</h2>
<div class="section level3">
<h3 id="symptom-2">Symptom<a class="anchor" aria-label="anchor" href="#symptom-2"></a>
</h3>
<p><code><a href="../reference/match_couples.html">match_couples()</a></code> or <code><a href="../reference/lap_solve.html">lap_solve()</a></code> takes too
long or doesn’t complete.</p>
</div>
<div class="section level3">
<h3 id="cause-1">Cause<a class="anchor" aria-label="anchor" href="#cause-1"></a>
</h3>
<p>Optimal matching has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>
complexity. For n = 5,000, this means ~125 billion operations.</p>
</div>
<div class="section level3">
<h3 id="diagnosis-1">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate runtime</span></span>
<span><span class="va">estimate_runtime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">seconds_per_billion</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ops</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">^</span><span class="fl">3</span></span>
<span>  <span class="va">time_sec</span> <span class="op">&lt;-</span> <span class="va">ops</span> <span class="op">/</span> <span class="fl">1e9</span> <span class="op">*</span> <span class="va">seconds_per_billion</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_sec</span> <span class="op">&lt;</span> <span class="fl">60</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f seconds"</span>, <span class="va">time_sec</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">time_sec</span> <span class="op">&lt;</span> <span class="fl">3600</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f minutes"</span>, <span class="va">time_sec</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f hours"</span>, <span class="va">time_sec</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated runtime for optimal matching:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated runtime for optimal matching:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">3000</span>, <span class="fl">5000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  n = %5d: %s\n"</span>, <span class="va">n</span>, <span class="fu">estimate_runtime</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   n =   100: 0.0 seconds</span></span>
<span><span class="co">#&gt;   n =   500: 0.1 seconds</span></span>
<span><span class="co">#&gt;   n =  1000: 1.0 seconds</span></span>
<span><span class="co">#&gt;   n =  3000: 27.0 seconds</span></span>
<span><span class="co">#&gt;   n =  5000: 2.1 minutes</span></span>
<span><span class="co">#&gt;   n = 10000: 16.7 minutes</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions-2">Solutions<a class="anchor" aria-label="anchor" href="#solutions-2"></a>
</h3>
<p><strong>1. Use greedy matching for large problems:</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">large_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">large_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Greedy is much faster</span></span>
<span><span class="va">time_greedy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result_greedy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span></span>
<span>    <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>    strategy <span class="op">=</span> <span class="st">"row_best"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Greedy matching (n=500):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">time_greedy</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Greedy matching (n=500): 0.24 seconds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Quality (mean distance):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_greedy</span><span class="op">$</span><span class="va">pairs</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Quality (mean distance): 0.2886</span></span></code></pre></div>
<p><strong>2. Use blocking to divide the problem:</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create clusters to match within</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span></span>
<span>  <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>  block_type <span class="op">=</span> <span class="st">"cluster"</span>,</span>
<span>  block_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  n_blocks <span class="op">=</span> <span class="fl">10</span>  <span class="co"># 10 blocks of ~200 each</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Match within blocks (10 x O(200^3) &lt;&lt; O(2000^3))</span></span>
<span><span class="va">result_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  block_id <span class="op">=</span> <span class="st">"block_id"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Choose a faster algorithm:</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For n &gt; 1000, auction algorithm often faster</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"auction"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For sparse problems (many forbidden pairs)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># Creates sparsity</span></span>
<span>  method <span class="op">=</span> <span class="st">"sap"</span>       <span class="co"># Sparse algorithm</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Pre-compute and cache distances:</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute once, reuse multiple times</span></span>
<span><span class="va">dist_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_distances.html">compute_distances</a></span><span class="op">(</span></span>
<span>  <span class="va">large_left</span>, <span class="va">large_right</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"robust"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fast: reuse cached distances</span></span>
<span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">dist_cache</span>, max_distance <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in lap_solve_auction_scaled(work, maximize): Auction(scaled): iteration guard at eps=7885383213142811494408480082840444688844086424042268422604802684204020084804602286084062426808668246202024044680060000888826240426666820268808860060886662888880668826624624282408686624866884640486622460688806226620844868208208262004280626244240268286668462608648088464686088602226464888282882.000000, phase=19</span></span>
<span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">dist_cache</span>, max_distance <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in lap_solve_auction_scaled(work, maximize): Auction(scaled): iteration guard at eps=7885383213142811494408480082840444688844086424042268422604802684204020084804602286084062426808668246202024044680060000888826240426666820268808860060886662888880668826624624282408686624866884640486622460688806226620844868208208262004280626244240268286668462608648088464686088602226464888282882.000000, phase=19</span></span>
<span><span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">dist_cache</span>, max_distance <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in lap_solve_auction_scaled(work, maximize): Auction(scaled): iteration guard at eps=1126483316163258824588840464686822002040606866822442644006464204284244600860220408644206628884660088462204820084486686828448800068422244884462088864286246088448668606428686082644420022446608028628488602664280848840444608420828066682648826868226802866640024264200844882840648848844628646628040.000000, phase=20</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="memory-errors">Memory Errors<a class="anchor" aria-label="anchor" href="#memory-errors"></a>
</h2>
<div class="section level3">
<h3 id="symptom-3">Symptom<a class="anchor" aria-label="anchor" href="#symptom-3"></a>
</h3>
<p>R crashes or shows: “Error: cannot allocate vector of size X GB”</p>
</div>
<div class="section level3">
<h3 id="cause-2">Cause<a class="anchor" aria-label="anchor" href="#cause-2"></a>
</h3>
<p>A full distance matrix for n×n requires 8n² bytes:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Memory requirements</span></span>
<span><span class="va">memory_needed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bytes</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="op">*</span> <span class="va">n</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">bytes</span> <span class="op">&lt;</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f KB"</span>, <span class="va">bytes</span> <span class="op">/</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">bytes</span> <span class="op">&lt;</span> <span class="fl">1e9</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f MB"</span>, <span class="va">bytes</span> <span class="op">/</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f GB"</span>, <span class="va">bytes</span> <span class="op">/</span> <span class="fl">1e9</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Memory for full distance matrix:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Memory for full distance matrix:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">5000</span>, <span class="fl">10000</span>, <span class="fl">20000</span>, <span class="fl">50000</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  n = %5d: %s\n"</span>, <span class="va">n</span>, <span class="fu">memory_needed</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   n =  1000: 8.0 MB</span></span>
<span><span class="co">#&gt;   n =  5000: 200.0 MB</span></span>
<span><span class="co">#&gt;   n = 10000: 800.0 MB</span></span>
<span><span class="co">#&gt;   n = 20000: 3.2 GB</span></span>
<span><span class="co">#&gt;   n = 50000: 20.0 GB</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions-3">Solutions<a class="anchor" aria-label="anchor" href="#solutions-3"></a>
</h3>
<p><strong>1. Use greedy matching (avoids full matrix):</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Greedy computes distances on-the-fly</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"row_best"</span>  <span class="co"># Most memory-efficient</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Use blocking to create smaller subproblems:</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Each block is much smaller</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, block_type <span class="op">=</span> <span class="st">"cluster"</span>, n_blocks <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>, vars <span class="op">=</span> <span class="va">vars</span>, block_id <span class="op">=</span> <span class="st">"block_id"</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Use caliper to create sparse matrix:</strong></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Caliper excludes distant pairs (sparse representation)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>  max_distance <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"sap"</span>  <span class="co"># Sparse-optimized algorithm</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Increase R’s memory limit (Windows):</strong></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Increase to 16 GB (if available)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/memory.size.html" class="external-link">memory.limit</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16000</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="different-results-with-different-methods">Different Results with Different Methods<a class="anchor" aria-label="anchor" href="#different-results-with-different-methods"></a>
</h2>
<div class="section level3">
<h3 id="symptom-4">Symptom<a class="anchor" aria-label="anchor" href="#symptom-4"></a>
</h3>
<p>Different algorithms return different assignments:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_jv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span>, method <span class="op">=</span> <span class="st">"jv"</span><span class="op">)</span></span>
<span><span class="va">result_hungarian</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span>, method <span class="op">=</span> <span class="st">"hungarian"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"JV assignment:       "</span>, <span class="va">result_jv</span><span class="op">$</span><span class="va">target</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; JV assignment:        1 2 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Hungarian assignment:"</span>, <span class="va">result_hungarian</span><span class="op">$</span><span class="va">target</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hungarian assignment: 1 2 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"JV total cost:       "</span>, <span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_jv</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; JV total cost:        3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Hungarian total cost:"</span>, <span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_hungarian</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hungarian total cost: 3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cause-3">Cause<a class="anchor" aria-label="anchor" href="#cause-3"></a>
</h3>
<p>When multiple optimal solutions exist (tied costs), different
algorithms may find different ones. <strong>The total cost should be the
same</strong>; if not, report a bug.</p>
</div>
<div class="section level3">
<h3 id="diagnosis-2">Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis-2"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for ties</span></span>
<span><span class="va">check_ties</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span></span>
<span>  <span class="co"># Check if diagonal dominates (trivial ties)</span></span>
<span>  <span class="va">diag_costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">diag_costs</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Tied costs on diagonal - multiple optima likely\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Check cost uniqueness</span></span>
<span>  <span class="va">unique_costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">total_entries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cost_matrix</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">unique_costs</span> <span class="op">&lt;</span> <span class="va">total_entries</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Many repeated costs - ties possible\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">check_ties</span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tied costs on diagonal - multiple optima likely</span></span>
<span><span class="co">#&gt; Many repeated costs - ties possible</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solutions-4">Solutions<a class="anchor" aria-label="anchor" href="#solutions-4"></a>
</h3>
<p><strong>1. Verify total costs match:</strong></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Total cost should be identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_jv</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_total_cost.html">get_total_cost</a></span><span class="op">(</span><span class="va">result_hungarian</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Both methods found optimal solutions (same total cost)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Both methods found optimal solutions (same total cost)</span></span></code></pre></div>
<p><strong>2. Use Hungarian for deterministic tie-breaking:</strong></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hungarian has consistent tie-breaking</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span>, method <span class="op">=</span> <span class="st">"hungarian"</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Add small noise to break ties:</strong></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">cost_perturbed</span> <span class="op">&lt;-</span> <span class="va">cost</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">0</span>, <span class="fl">1e-10</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost_perturbed</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="missing-values-in-data">Missing Values in Data<a class="anchor" aria-label="anchor" href="#missing-values-in-data"></a>
</h2>
<div class="section level3">
<h3 id="symptom-5">Symptom<a class="anchor" aria-label="anchor" href="#symptom-5"></a>
</h3>
<p>Matching fails or produces unexpected results due to NA values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">30</span>, <span class="cn">NA</span>, <span class="fl">35</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">32</span>, <span class="fl">33</span>, <span class="fl">36</span>, <span class="fl">42</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This may fail or give unexpected results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Missing values (NA) not allowed in matching variables</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cause-4">Cause<a class="anchor" aria-label="anchor" href="#cause-4"></a>
</h3>
<p>couplr requires complete cases for distance computation. NA values in
matching variables cause issues.</p>
</div>
<div class="section level3">
<h3 id="solutions-5">Solutions<a class="anchor" aria-label="anchor" href="#solutions-5"></a>
</h3>
<p><strong>1. Remove rows with NA (before matching):</strong></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">left_clean</span> <span class="op">&lt;-</span> <span class="va">left</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right_clean</span> <span class="op">&lt;-</span> <span class="va">right</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left_clean</span>, <span class="va">right_clean</span>, vars <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs (excluded 1 left unit with NA)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matched 4 pairs (excluded 1 left unit with NA)</span></span></code></pre></div>
<p><strong>2. Impute missing values:</strong></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simple mean imputation</span></span>
<span><span class="va">left_imputed</span> <span class="op">&lt;-</span> <span class="va">left</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left_imputed</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matched"</span>, <span class="va">result</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_matched</span>, <span class="st">"pairs (imputed 1 NA with mean)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matched 5 pairs (imputed 1 NA with mean)</span></span></code></pre></div>
<p><strong>3. Use preprocessing to diagnose:</strong></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">health</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess_matching_vars.html">preprocess_matching_vars</a></span><span class="op">(</span></span>
<span>  <span class="va">left</span>, <span class="va">right</span>,</span>
<span>  vars <span class="op">=</span> <span class="st">"age"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preprocessing Result</span></span>
<span><span class="co">#&gt; ====================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variables: 1</span></span>
<span><span class="co">#&gt; Scaling method: none</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="installation-issues">Installation Issues<a class="anchor" aria-label="anchor" href="#installation-issues"></a>
</h2>
<div class="section level3">
<h3 id="c-compilation-errors">C++ Compilation Errors<a class="anchor" aria-label="anchor" href="#c-compilation-errors"></a>
</h3>
<div class="section level4">
<h4 id="symptom-6">Symptom<a class="anchor" aria-label="anchor" href="#symptom-6"></a>
</h4>
<pre><code>Error in .Call("_couplr_assignment_impl"): object not found</code></pre>
<p>or</p>
<pre><code>Error: package 'couplr' was built under R version X.X</code></pre>
</div>
<div class="section level4">
<h4 id="cause-5">Cause<a class="anchor" aria-label="anchor" href="#cause-5"></a>
</h4>
<p>C++ code not compiled properly, or object files are stale.</p>
</div>
<div class="section level4">
<h4 id="solutions-6">Solutions<a class="anchor" aria-label="anchor" href="#solutions-6"></a>
</h4>
<p><strong>1. Clean and reinstall:</strong></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In R:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/remove.packages.html" class="external-link">remove.packages</a></span><span class="op">(</span><span class="st">"couplr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"couplr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or from GitHub:</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gcol33/couplr"</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Clean compiled files (development):</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># PowerShell</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="fu">Remove-Item</span> src\<span class="op">*.</span><span class="fu">o</span><span class="op">,</span> src\<span class="op">*.</span><span class="fu">dll</span> <span class="op">-</span>Force</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># Bash</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="fu">rm</span> src/<span class="pp">*</span>.o src/<span class="pp">*</span>.so</span></code></pre></div>
<p>Then rebuild:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://pkgbuild.r-lib.org/reference/clean_dll.html" class="external-link">clean_dll</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Check Rtools/compiler (Windows):</strong></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if Rtools is properly configured</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"make"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               make </span></span>
<span><span class="co">#&gt; "C:\\rtools45\\usr\\bin\\make.exe"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"g++"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                          g++ </span></span>
<span><span class="co">#&gt; "C:\\rtools45\\X86_64~1.POS\\bin\\G__~1.EXE"</span></span></code></pre></div>
<p>Make sure Rtools is installed and PATH is configured correctly.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="common-error-messages">Common Error Messages<a class="anchor" aria-label="anchor" href="#common-error-messages"></a>
</h2>
<div class="section level3">
<h3 id="method_used-attribute-is-null">“method_used attribute is NULL”<a class="anchor" aria-label="anchor" href="#method_used-attribute-is-null"></a>
</h3>
<p><strong>Cause</strong>: Result object wasn’t created properly.</p>
<p><strong>Solution</strong>: Use <code><a href="../reference/lap_solve.html">lap_solve()</a></code> instead of
<code><a href="../reference/assignment.html">assignment()</a></code> for the tidy interface.</p>
</div>
<div class="section level3">
<h3 id="cost-matrix-contains-non-finite-values">“Cost matrix contains non-finite values”<a class="anchor" aria-label="anchor" href="#cost-matrix-contains-non-finite-values"></a>
</h3>
<p><strong>Cause</strong>: NA or NaN values in cost matrix (not
Inf).</p>
<p><strong>Solution</strong>: Replace NA with Inf for forbidden
assignments, or remove rows/cols.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cost</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">Inf</span>  <span class="co"># Mark as forbidden</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="all-rows-assigned-to-inf-columns">“All rows assigned to Inf columns”<a class="anchor" aria-label="anchor" href="#all-rows-assigned-to-inf-columns"></a>
</h3>
<p><strong>Cause</strong>: Caliper is too strict; all potential matches
exceed threshold.</p>
<p><strong>Solution</strong>: Increase <code>max_distance</code> or
check for overlap issues.</p>
</div>
<div class="section level3">
<h3 id="subscript-out-of-bounds">“subscript out of bounds”<a class="anchor" aria-label="anchor" href="#subscript-out-of-bounds"></a>
</h3>
<p><strong>Cause</strong>: Empty left or right data frame, or ID
mismatch.</p>
<p><strong>Solution</strong>: Check data dimensions and ID column
consistency.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Always verify data before matching</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">left</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">right</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter an issue not covered here:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Check function documentation</strong>:
<code><a href="../reference/match_couples.html">?match_couples</a></code>, <code><a href="../reference/lap_solve.html">?lap_solve</a></code>
</li>
<li>
<strong>Search GitHub issues</strong>: <a href="https://github.com/gcol33/couplr/issues" class="external-link">github.com/gcol33/couplr/issues</a>
</li>
<li>
<strong>Create a minimal reproducible example</strong>:</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Minimal example template</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gillescolling.com/couplr/">couplr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Minimal data that reproduces the issue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Code that causes the error</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Expected vs actual behavior</span></span>
<span><span class="co"># Expected: ...</span></span>
<span><span class="co"># Actual: [error message]</span></span>
<span></span>
<span><span class="co"># Session info</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Open an issue</strong> with your example at <a href="https://github.com/gcol33/couplr/issues/new" class="external-link">github.com/gcol33/couplr/issues/new</a>
</li>
</ol>
<hr>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code> - Basic usage</li>
<li>
<code><a href="../articles/matching-workflows.html">vignette("matching-workflows")</a></code> - Production matching
pipelines</li>
<li>
<code><a href="../articles/algorithms.html">vignette("algorithms")</a></code> - Algorithm selection guide</li>
<li>
<code><a href="../articles/comparison.html">vignette("comparison")</a></code> - Comparison with other
packages</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gcol33" class="external-link">Gilles Colling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  <script>
/* SVG Copy Button Functionality - Copy as PNG Image */
(function() {
  "use strict";

  // Convert SVG to PNG and copy to clipboard
  async function copySvgAsImage(svg, btn) {
    try {
      // Get SVG dimensions
      var svgRect = svg.getBoundingClientRect();
      var width = svgRect.width;
      var height = svgRect.height;

      // Use higher resolution for better quality (2x)
      var scale = 2;
      var canvas = document.createElement("canvas");
      canvas.width = width * scale;
      canvas.height = height * scale;
      var ctx = canvas.getContext("2d");
      ctx.scale(scale, scale);

      // Clone SVG and prepare for rendering
      var clone = svg.cloneNode(true);
      clone.classList.remove("inline-svg");

      // Get computed styles and inline them for proper rendering
      var svgStyles = window.getComputedStyle(svg);

      // Serialize SVG
      var serializer = new XMLSerializer();
      var svgString = serializer.serializeToString(clone);

      // Create a blob and URL for the SVG
      var svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
      var url = URL.createObjectURL(svgBlob);

      // Create image and draw to canvas
      var img = new Image();
      img.onload = async function() {
        // Fill white background (for transparency)
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, width, height);

        // Draw the SVG
        ctx.drawImage(img, 0, 0, width, height);
        URL.revokeObjectURL(url);

        // Convert canvas to blob and copy to clipboard
        canvas.toBlob(async function(blob) {
          try {
            var item = new ClipboardItem({ "image/png": blob });
            await navigator.clipboard.write([item]);

            // Show success tooltip
            showTooltip(btn, "Copied!");
          } catch (err) {
            console.error("Failed to copy image:", err);
            showTooltip(btn, "Copy failed - try right-click");
          }
        }, "image/png");
      };

      img.onerror = function() {
        URL.revokeObjectURL(url);
        console.error("Failed to load SVG as image");
        showTooltip(btn, "Copy failed");
      };

      img.src = url;

    } catch (err) {
      console.error("Error copying SVG:", err);
      showTooltip(btn, "Copy failed");
    }
  }

  // Show tooltip message
  function showTooltip(btn, message) {
    var originalTitle = btn.getAttribute("data-bs-original-title") || btn.getAttribute("title");
    btn.setAttribute("data-bs-original-title", message);
    var tooltip = bootstrap.Tooltip.getInstance(btn);
    if (tooltip) {
      tooltip.show();
    }
    setTimeout(function() {
      btn.setAttribute("data-bs-original-title", originalTitle);
    }, 1500);
  }

  // Initialize SVG copy buttons after DOM is ready
  document.addEventListener("DOMContentLoaded", function() {
    // Check for Clipboard API support
    if (!navigator.clipboard || !navigator.clipboard.write) {
      console.warn("Clipboard API not supported - SVG copy buttons disabled");
      return;
    }

    // Add click handlers to all SVG copy buttons
    document.querySelectorAll(".btn-copy-svg").forEach(function(btn) {
      btn.addEventListener("click", function(e) {
        e.preventDefault();
        var container = btn.closest(".svg-container");
        if (!container) return;

        var svg = container.querySelector("svg");
        if (!svg) return;

        copySvgAsImage(svg, btn);
      });

      // Initialize Bootstrap tooltip
      new bootstrap.Tooltip(btn, { container: "body" });
    });
  });
})();
</script>
</body>
</html>
