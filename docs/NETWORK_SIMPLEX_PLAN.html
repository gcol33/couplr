<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Network Simplex Implementation Plan • couplr</title><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="Network Simplex Implementation Plan"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">couplr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="articles/algorithms.html">Algorithm Details</a></li>
    <li><a class="dropdown-item" href="articles/matching-workflows.html">Matching Workflows</a></li>
    <li><a class="dropdown-item" href="articles/pixel-morphing.html">Pixel Morphing &amp; Scientific Applications</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="news/index.html">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/couplr" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Network Simplex Implementation Plan</h1>
      <small class="dont-index">Source: <a href="https://github.com/gcol33/couplr/blob/HEAD/NETWORK_SIMPLEX_PLAN.md" class="external-link"><code>NETWORK_SIMPLEX_PLAN.md</code></a></small>
    </div>

<div id="network-simplex-implementation-plan" class="section level1">

<div class="section level2">
<h2 id="algorithm-overview">Algorithm Overview<a class="anchor" aria-label="anchor" href="#algorithm-overview"></a></h2>
<p>The Network Simplex algorithm solves the minimum-cost flow problem, specialized for assignment: - Model n×m assignment as bipartite network flow - Basis = spanning tree (not matrix) - Dual variables = node potentials - 200-300x faster than general simplex on networks</p>
<p><strong>Complexity:</strong> O(VE log V log(VC)) polynomial; O(n³) typical in practice</p>
</div>
<div class="section level2">
<h2 id="network-structure-for-assignment">Network Structure for Assignment<a class="anchor" aria-label="anchor" href="#network-structure-for-assignment"></a></h2>
<pre><code>         source (node 0, supply = n)
            |
    +-------+-------+
    |       |       |
   row₀   row₁ ... row_{n-1}   (nodes 1..n, transshipment)
    |\      |\      |
    | \     | \     |
   col₀  col₁ ... col_{m-1}    (nodes n+1..n+m, transshipment)
    |       |       |
    +-------+-------+
            |
         sink (node n+m+1, demand = n)</code></pre>
<p><strong>Arcs:</strong> - source → row_i: cost=0, cap=1, lower=1 (n arcs) - row_i → col_j: cost=C[i,j], cap=1, lower=0 (n×m arcs) - col_j → sink: cost=0, cap=1, lower=0 (m arcs)</p>
<p>Total: 2n + m + n×m arcs, n + m + 2 nodes</p>
</div>
<div class="section level2">
<h2 id="file-structure">File Structure<a class="anchor" aria-label="anchor" href="#file-structure"></a></h2>
<pre><code>src/solvers/network_simplex/
├── ns_types.h                    # Data structures, constants
├── ns_graph.h                    # Build assignment network
├── ns_init.h                     # Big-M initialization
├── ns_pivot.h                    # Pivot operations (all-in-one)
└── solve_network_simplex.cpp     # Main algorithm loop</code></pre>
</div>
<div class="section level2">
<h2 id="implementation-parts">Implementation Parts<a class="anchor" aria-label="anchor" href="#implementation-parts"></a></h2>
<div class="section level3">
<h3 id="part-1-ns_typesh">Part 1: ns_types.h<a class="anchor" aria-label="anchor" href="#part-1-ns_typesh"></a></h3>
<p><strong>State structure:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">struct</span> NSState <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="co">// Problem size</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="dt">int</span> n_rows<span class="op">,</span> n_cols<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="dt">int</span> num_nodes<span class="op">;</span>           <span class="co">// n + m + 2</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="dt">int</span> num_arcs<span class="op">;</span>            <span class="co">// 2n + m + n*m</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="co">// Arc data (indexed 0..num_arcs-1)</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> arc_source<span class="op">;</span>    <span class="co">// Source node of arc</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> arc_target<span class="op">;</span>    <span class="co">// Target node of arc</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> arc_cost<span class="op">;</span>   <span class="co">// Cost of arc</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> arc_flow<span class="op">;</span>      <span class="co">// Current flow (0 or 1)</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="co">// Arc state: 0=LOWER, 1=TREE, 2=UPPER</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> arc_state<span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="co">// Spanning tree (threaded representation)</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> parent<span class="op">;</span>        <span class="co">// Parent node (-1 for root)</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> parent_arc<span class="op">;</span>    <span class="co">// Arc connecting to parent</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> thread<span class="op">;</span>        <span class="co">// Next node in DFS preorder</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> rev_thread<span class="op">;</span>    <span class="co">// Previous in DFS preorder</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> depth<span class="op">;</span>         <span class="co">// Depth in tree</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> subtree_size<span class="op">;</span>  <span class="co">// Size of subtree</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="co">// Dual variables</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> potential<span class="op">;</span>  <span class="co">// Node potentials π[i]</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    <span class="co">// Assignment result</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> row_to_col<span class="op">;</span>    <span class="co">// row i matched to col j</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>Constants:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> STATE_LOWER <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> STATE_TREE <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> STATE_UPPER <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> ROOT_NODE <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="at">const</span> <span class="dt">double</span> BIG_M <span class="op">=</span> <span class="fl">1e12</span><span class="op">;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="part-2-ns_graphh">Part 2: ns_graph.h<a class="anchor" aria-label="anchor" href="#part-2-ns_graphh"></a></h3>
<p><strong>Functions:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">// Node indexing:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">//   0 = source</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">//   1..n = rows</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">//   n+1..n+m = columns</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">//   n+m+1 = sink</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> row_node<span class="op">(</span><span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> col_node<span class="op">(</span><span class="dt">int</span> j<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> j<span class="op">;</span> <span class="op">}</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> source_node<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> sink_node<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">+</span> m <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">// Arc indexing:</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">//   0..n-1 = source-&gt;row arcs</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">//   n..n+n*m-1 = row-&gt;col arcs (arc n + i*m + j for row i, col j)</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">//   n+n*m..n+n*m+m-1 = col-&gt;sink arcs</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="dt">void</span> build_assignment_network<span class="op">(</span>NSState<span class="op">&amp;</span> state<span class="op">,</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>                               <span class="at">const</span> <span class="dt">double</span><span class="op">*</span> cost_matrix<span class="op">,</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>                               <span class="dt">int</span> n_rows<span class="op">,</span> <span class="dt">int</span> n_cols<span class="op">);</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="part-3-ns_inith">Part 3: ns_init.h<a class="anchor" aria-label="anchor" href="#part-3-ns_inith"></a></h3>
<p><strong>Big-M Method:</strong> - Add artificial arc from each node to a super-root with cost BIG_M - Initial tree = star from super-root - Or simpler: use source as root, artificial arcs to unconnected nodes</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="dt">void</span> initialize_spanning_tree<span class="op">(</span>NSState<span class="op">&amp;</span> state<span class="op">);</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="dt">void</span> compute_initial_potentials<span class="op">(</span>NSState<span class="op">&amp;</span> state<span class="op">);</span></span></code></pre></div>
<p><strong>Potential computation:</strong> - Set π[root] = 0 - For each tree arc (u,v): π[v] = π[u] + cost[u,v] if arc points u→v in tree - Traverse in thread order</p>
</div>
<div class="section level3">
<h3 id="part-4-ns_pivoth">Part 4: ns_pivot.h<a class="anchor" aria-label="anchor" href="#part-4-ns_pivoth"></a></h3>
<p><strong>Key operations:</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">// Reduced cost of arc e</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">double</span> reduced_cost<span class="op">(</span><span class="at">const</span> NSState<span class="op">&amp;</span> state<span class="op">,</span> <span class="dt">int</span> arc<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="dt">int</span> u <span class="op">=</span> state<span class="op">.</span>arc_source<span class="op">[</span>arc<span class="op">];</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="dt">int</span> v <span class="op">=</span> state<span class="op">.</span>arc_target<span class="op">[</span>arc<span class="op">];</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="cf">return</span> state<span class="op">.</span>arc_cost<span class="op">[</span>arc<span class="op">]</span> <span class="op">-</span> state<span class="op">.</span>potential<span class="op">[</span>u<span class="op">]</span> <span class="op">+</span> state<span class="op">.</span>potential<span class="op">[</span>v<span class="op">];</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">// Find entering arc (block search)</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="dt">int</span> find_entering_arc<span class="op">(</span><span class="at">const</span> NSState<span class="op">&amp;</span> state<span class="op">);</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">// Find cycle and leaving arc when adding entering arc</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="kw">struct</span> PivotInfo <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="dt">int</span> entering_arc<span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="dt">int</span> leaving_arc<span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="dt">int</span> join_node<span class="op">;</span>      <span class="co">// LCA of arc endpoints</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    <span class="dt">int</span> delta<span class="op">;</span>          <span class="co">// Flow augmentation (0 or 1 for assignment)</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="dt">bool</span> change_root<span class="op">;</span>   <span class="co">// Whether tree structure changes</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>PivotInfo find_leaving_arc<span class="op">(</span><span class="at">const</span> NSState<span class="op">&amp;</span> state<span class="op">,</span> <span class="dt">int</span> entering_arc<span class="op">);</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">// Execute pivot</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="dt">void</span> do_pivot<span class="op">(</span>NSState<span class="op">&amp;</span> state<span class="op">,</span> <span class="at">const</span> PivotInfo<span class="op">&amp;</span> info<span class="op">);</span></span></code></pre></div>
<p><strong>Pivot steps:</strong> 1. Find join (LCA) of entering arc endpoints 2. Trace cycle from both endpoints to join 3. Find leaving arc (min residual on cycle) 4. Augment flow around cycle 5. Update tree: remove leaving arc, add entering arc 6. Update thread order for moved subtree 7. Update potentials in moved subtree</p>
</div>
<div class="section level3">
<h3 id="part-5-solve_network_simplexcpp">Part 5: solve_network_simplex.cpp<a class="anchor" aria-label="anchor" href="#part-5-solve_network_simplexcpp"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>NSResult solve_network_simplex_impl<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>NumericMatrix<span class="op">&amp;</span> cost_matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    NSState state<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> cost_matrix<span class="op">.</span>nrow<span class="op">();</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="dt">int</span> m <span class="op">=</span> cost_matrix<span class="op">.</span>ncol<span class="op">();</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="co">// Build network</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    build_assignment_network<span class="op">(</span>state<span class="op">,</span> <span class="op">&amp;</span>cost_matrix<span class="op">[</span><span class="dv">0</span><span class="op">],</span> n<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="co">// Initialize spanning tree and potentials</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    initialize_spanning_tree<span class="op">(</span>state<span class="op">);</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    compute_initial_potentials<span class="op">(</span>state<span class="op">);</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="co">// Main loop</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="dt">int</span> max_iter <span class="op">=</span> state<span class="op">.</span>num_arcs <span class="op">*</span> state<span class="op">.</span>num_nodes<span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> iter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iter <span class="op">&lt;</span> max_iter<span class="op">;</span> <span class="op">++</span>iter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>        <span class="dt">int</span> entering <span class="op">=</span> find_entering_arc<span class="op">(</span>state<span class="op">);</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>entering <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span>  <span class="co">// Optimal!</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>        PivotInfo info <span class="op">=</span> find_leaving_arc<span class="op">(</span>state<span class="op">,</span> entering<span class="op">);</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>        do_pivot<span class="op">(</span>state<span class="op">,</span> info<span class="op">);</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    <span class="co">// Extract solution</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>    <span class="cf">return</span> extract_assignment<span class="op">(</span>state<span class="op">);</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="critical-implementation-details">Critical Implementation Details<a class="anchor" aria-label="anchor" href="#critical-implementation-details"></a></h2>
<div class="section level3">
<h3 id="id_1-thread-representation">1. Thread Representation<a class="anchor" aria-label="anchor" href="#id_1-thread-representation"></a></h3>
<p>The spanning tree is stored implicitly via DFS preorder threading: - <code>thread[u]</code> = next node in DFS preorder - <code>rev_thread[u]</code> = previous node in DFS preorder - <code>subtree_size[u]</code> = nodes in subtree rooted at u</p>
<p>This enables O(subtree_size) traversal of any subtree without explicit child pointers.</p>
</div>
<div class="section level3">
<h3 id="id_2-anti-cycling-strongly-feasible-basis">2. Anti-Cycling (Strongly Feasible Basis)<a class="anchor" aria-label="anchor" href="#id_2-anti-cycling-strongly-feasible-basis"></a></h3>
<p>Use Cunningham’s leaving arc rule: - Among arcs with minimum residual, choose the one closest to join - Guarantees at most O(n) consecutive degenerate pivots</p>
</div>
<div class="section level3">
<h3 id="id_3-block-search-pricing">3. Block Search Pricing<a class="anchor" aria-label="anchor" href="#id_3-block-search-pricing"></a></h3>
<ul><li>Divide arcs into blocks of size B = ceil(sqrt(num_arcs))</li>
<li>In each block, find arc with most negative reduced cost</li>
<li>If found, use it; otherwise move to next block</li>
<li>Balances work per iteration vs number of iterations</li>
</ul></div>
<div class="section level3">
<h3 id="id_4-assignment-simplifications">4. Assignment Simplifications<a class="anchor" aria-label="anchor" href="#id_4-assignment-simplifications"></a></h3>
<p>Since all capacities = 1 and demands = 1: - Flow is always 0 or 1 - Residual capacity is 1-flow (forward) or flow (backward) - Delta (augmentation amount) is always 0 or 1 - Degenerate pivots (delta=0) are common</p>
</div>
<div class="section level3">
<h3 id="id_5-potential-updates">5. Potential Updates<a class="anchor" aria-label="anchor" href="#id_5-potential-updates"></a></h3>
<p>After pivot, only potentials in the moved subtree change:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">// sigma = new_potential - old_potential for entering arc endpoint</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="dt">double</span> sigma <span class="op">=</span> state<span class="op">.</span>potential<span class="op">[</span>u_in<span class="op">]</span> <span class="op">+</span> state<span class="op">.</span>arc_cost<span class="op">[</span>entering<span class="op">]</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>             <span class="op">-</span> state<span class="op">.</span>potential<span class="op">[</span>v_in<span class="op">];</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">// Update all nodes in moved subtree</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">=</span> moved_root<span class="op">;</span> v <span class="op">!=</span> end_of_subtree<span class="op">;</span> v <span class="op">=</span> state<span class="op">.</span>thread<span class="op">[</span>v<span class="op">])</span> <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    state<span class="op">.</span>potential<span class="op">[</span>v<span class="op">]</span> <span class="op">+=</span> sigma<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Correctness tests:</strong>
<ul><li>Compare with JV solver on random matrices</li>
<li>Test edge cases: 1×1, rectangular, ties in costs</li>
</ul></li>
<li>
<strong>Optimality verification:</strong>
<ul><li>Check all reduced costs ≥ 0 for lower-bound arcs</li>
<li>Check all reduced costs ≤ 0 for upper-bound arcs</li>
<li>Verify complementary slackness</li>
</ul></li>
<li>
<strong>Performance tests:</strong>
<ul><li>Benchmark against JV, auction, Orlin-Ahuja</li>
<li>Measure pivot count vs problem size</li>
</ul></li>
</ol></div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
<ul><li>Király &amp; Kovács (2012): “Efficient implementation of minimum-cost flow algorithms”</li>
<li>LEMON library: network_simplex.h</li>
<li>NetworkX: networksimplex.py</li>
<li>Ahuja, Magnanti, Orlin: “Network Flows: Theory, Algorithms, and Applications”</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

